!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.s3=e():t.s3=e()}(window,(function(){return function(t){var e={};function i(r){if(e[r])return e[r].exports;var s=e[r]={i:r,l:!1,exports:{}};return t[r].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(r,s,function(e){return t[e]}.bind(null,s));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=35)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});let{tan:r,sqrt:s,abs:n,max:o,min:a,atan2:l,asin:h,acos:u,sin:c,cos:d}=Math;function f(t,e,i){return o(e,a(t,i))}e.DEG2RAD=Math.PI/180,e.RAD2DEG=180/Math.PI,e.degToRad=function(t){return t*e.DEG2RAD},e.clamp=f,e.isPowerOfTwo=function(t){return 0==(t&t-1)&&0!==t};class p{constructor(t=0,e=0){this.x=t,this.y=e}set(t,e=t){return this.x=t,this.y=e,this}copy(t){return this.x=t.x,this.y=t.y,this}clone(){return(new p).copy(this)}toArray(t,e=0){return t[e]=this.x,t[e+1]=this.y,t}}e.Vec2=p;class g{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.z=i}set(t,e=t,i=t){return this.x=t,this.y=e,this.z=i,this}isZero(){return 0===this.x&&0===this.y&&0===this.z}clone(){return(new g).copy(this)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}equals(t){return this.x===t.x&&this.y===t.y&&this.z===t.z}add(t,e=this){return e.x=this.x+t.x,e.y=this.y+t.y,e.z=this.z+t.z,e}sub(t,e=this){return e.x=this.x-t.x,e.y=this.y-t.y,e.z=this.z-t.z,e}multiply(t,e=this){return e.x=this.x*t.x,e.y=this.y*t.y,e.z=this.z*t.z,e}sumOf(t,e,i=this){return i.x=t.x+e.x,i.y=t.y+e.y,i.z=t.z+e.z,i}diffOf(t,e,i=this){return i.x=t.x-e.x,i.y=t.y-e.y,i.z=t.z-e.z,i}length(){return s(this.length2())}length2(){let{x:t,y:e,z:i}=this;return t*t+e*e+i*i}normalize(t=this){return this.scale(1/this.length(),t)}scale(t,e=this){return e.x=this.x*t,e.y=this.y*t,e.z=this.z*t,e}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}cross(t,e=this){const i=this.x,r=this.y,s=this.z,n=t.x,o=t.y,a=t.z;return e.x=r*a-s*o,e.y=s*n-i*a,e.z=i*o-r*n,e}min(t){return this.x=a(this.x,t.x),this.y=a(this.y,t.y),this.z=a(this.z,t.z),this}max(t){return this.x=o(this.x,t.x),this.y=o(this.y,t.y),this.z=o(this.z,t.z),this}setFromMatrixPosition(t){let e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){let r=c(e)*t;return this.x=r*c(i),this.y=d(e)*t,this.z=r*d(i),this}transformMat4(t,e=this){let i=t.elements,r=this.x,s=this.y,n=this.z,o=i[3]*r+i[7]*s+i[11]*n+i[15]||1;return o=1/o,e.x=(i[0]*r+i[4]*s+i[8]*n+i[12])*o,e.y=(i[1]*r+i[5]*s+i[9]*n+i[13])*o,e.z=(i[2]*r+i[6]*s+i[10]*n+i[14])*o,e}transformDirection(t,e=this){let i=this.x,r=this.y,s=this.z,n=t.elements;return this.x=n[0]*i+n[4]*r+n[8]*s,this.y=n[1]*i+n[5]*r+n[9]*s,this.z=n[2]*i+n[6]*r+n[10]*s,this.normalize(e)}transformQuat(t){let e=t.x,i=t.y,r=t.z,s=t.w,n=this.x,o=this.y,a=this.z,l=i*a-r*o,h=r*n-e*a,u=e*o-i*n,c=i*u-r*h,d=r*l-e*u,f=e*h-i*l,p=2*s;return l*=p,h*=p,u*=p,c*=2,d*=2,f*=2,this.x=n+l+c,this.y=o+h+d,this.z=a+u+f,this}distance(t){return s(this.distance2(t))}distance2(t){let e=this.x-t.x,i=this.y-t.y,r=this.z-t.z;return e*e+i*i+r*r}toArray(t,e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}}e.Vec3=g;class m{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.lookAt=(()=>{let t=new g,e=new g,i=new g;return(r,s,o)=>{r.sub(s,i),i.isZero()&&(i.z=1),i.normalize(),o.cross(i,t),t.isZero()&&(1===n(o.z)?i.x+=1e-4:i.z+=1e-4,i.normalize(),o.cross(i,t)),t.normalize(),i.cross(t,e);let a=this.elements;return a[0]=t.x,a[1]=t.y,a[2]=t.z,a[4]=e.x,a[5]=e.y,a[6]=e.z,a[8]=i.x,a[9]=i.y,a[10]=i.z,this}})()}set(t,e,i,r,s,n,o,a,l,h,u,c,d,f,p,g){let m=this.elements;return m[0]=t,m[4]=e,m[8]=i,m[12]=r,m[1]=s,m[5]=n,m[9]=o,m[13]=a,m[2]=l,m[6]=h,m[10]=u,m[14]=c,m[3]=d,m[7]=f,m[11]=p,m[15]=g,this}copy(t){let e=this.elements,i=t.elements;return e[0]=i[0],e[4]=i[4],e[8]=i[8],e[12]=i[12],e[1]=i[1],e[5]=i[5],e[9]=i[9],e[13]=i[13],e[2]=i[2],e[6]=i[6],e[10]=i[10],e[14]=i[14],e[3]=i[3],e[7]=i[7],e[11]=i[11],e[15]=i[15],this}clone(){return(new m).copy(this)}perspective(t,e,i,s){const n=1/r(t/2),o=1/(i-s),a=this.elements;return a[0]=n/e,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=n,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=(s+i)*o,a[11]=-1,a[12]=0,a[13]=0,a[14]=2*s*i*o,a[15]=0,this}ortho(t,e,i,r,s,n){const o=1/(t-e),a=1/(i-r),l=1/(s-n),h=this.elements;return h[0]=-2*o,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=-2*a,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=2*l,h[11]=0,h[12]=(t+e)*o,h[13]=(r+i)*a,h[14]=(n+s)*l,h[15]=1,this}multiply(t,e=this){const i=this.elements,r=t.elements,s=e.elements,n=i[0],o=i[1],a=i[2],l=i[3],h=i[4],u=i[5],c=i[6],d=i[7],f=i[8],p=i[9],g=i[10],m=i[11],x=i[12],v=i[13],y=i[14],b=i[15];let _=r[0],T=r[1],w=r[2],M=r[3];return s[0]=_*n+T*h+w*f+M*x,s[1]=_*o+T*u+w*p+M*v,s[2]=_*a+T*c+w*g+M*y,s[3]=_*l+T*d+w*m+M*b,_=r[4],T=r[5],w=r[6],M=r[7],s[4]=_*n+T*h+w*f+M*x,s[5]=_*o+T*u+w*p+M*v,s[6]=_*a+T*c+w*g+M*y,s[7]=_*l+T*d+w*m+M*b,_=r[8],T=r[9],w=r[10],M=r[11],s[8]=_*n+T*h+w*f+M*x,s[9]=_*o+T*u+w*p+M*v,s[10]=_*a+T*c+w*g+M*y,s[11]=_*l+T*d+w*m+M*b,_=r[12],T=r[13],w=r[14],M=r[15],s[12]=_*n+T*h+w*f+M*x,s[13]=_*o+T*u+w*p+M*v,s[14]=_*a+T*c+w*g+M*y,s[15]=_*l+T*d+w*m+M*b,e}compose(t,e,i){const r=t.x,s=t.y,n=t.z,o=t.w,a=r+r,l=s+s,h=n+n,u=r*a,c=r*l,d=r*h,f=s*l,p=s*h,g=n*h,m=o*a,x=o*l,v=o*h,y=i.x,b=i.y,_=i.z,T=this.elements;return T[0]=(1-(f+g))*y,T[1]=(c+v)*y,T[2]=(d-x)*y,T[3]=0,T[4]=(c-v)*b,T[5]=(1-(u+g))*b,T[6]=(p+m)*b,T[7]=0,T[8]=(d+x)*_,T[9]=(p-m)*_,T[10]=(1-(u+f))*_,T[11]=0,T[12]=e.x,T[13]=e.y,T[14]=e.z,T[15]=1,this}invert(t=this){let e=this.elements,i=t.elements;const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],h=e[6],u=e[7],c=e[8],d=e[9],f=e[10],p=e[11],g=e[12],m=e[13],x=e[14],v=e[15],y=r*l-s*a,b=r*h-n*a,_=r*u-o*a,T=s*h-n*l,w=s*u-o*l,M=n*u-o*h,E=c*m-d*g,P=c*x-f*g,R=c*v-p*g,L=d*x-f*m,S=d*v-p*m,F=f*v-p*x;let D=y*F-b*S+_*L+T*R-w*P+M*E;if(0===D)throw Error("Mat4.invert: can't invert determinant is 0");return D=1/D,i[0]=(l*F-h*S+u*L)*D,i[1]=(n*S-s*F-o*L)*D,i[2]=(m*M-x*w+v*T)*D,i[3]=(f*w-d*M-p*T)*D,i[4]=(h*R-a*F-u*P)*D,i[5]=(r*F-n*R+o*P)*D,i[6]=(x*_-g*M-v*b)*D,i[7]=(c*M-f*_+p*b)*D,i[8]=(a*S-l*R+u*E)*D,i[9]=(s*R-r*S-o*E)*D,i[10]=(g*w-m*_+v*y)*D,i[11]=(d*_-c*w-p*y)*D,i[12]=(l*P-a*L-h*E)*D,i[13]=(r*L-s*P+n*E)*D,i[14]=(m*b-g*T-x*y)*D,i[15]=(c*T-d*b+f*y)*D,t}makeTranslation(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}makeRotationFromEuler(t){const e=t.x,i=t.y,r=t.z,s=d(e),n=c(e),o=d(i),a=c(i),l=d(r),h=c(r),u=s*l,f=s*h,p=n*l,g=n*h,m=o*l,x=p*a,v=u*a,y=o*h,b=g*a,_=f*a,T=p,w=o*n,M=s*o;return this.set(m,x-f,g+v,0,y,u+b,_-T,0,-a,w,M,0,0,0,0,1),this}translate(t,e=this){return this.tranlateFromCartesianCoords(t.x,t.y,t.z,e)}tranlateFromCartesianCoords(t,e,i,r=this){let s=r.elements;return s[12]=t,s[13]=e,s[14]=i,s[15]=1,r}getMaxScaleOnAxis(){let t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],r=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return s(o(e,i,r))}toArray(t,e=0){let i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}}e.Mat4=m;class x{constructor(){this.x=0,this.y=0,this.z=0,this.w=1}set(t,e,i,r){return this.x=t,this.y=e,this.z=i,this.w=r,this}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}clone(){return(new x).copy(this)}equals(t){return this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w}setFromRotationMatrix(t){const e=t.elements,i=e[0],r=e[4],n=e[8],o=e[1],a=e[5],l=e[9],h=e[2],u=e[6],c=e[10];let d=i+a+c;if(d>0){let t=.5/s(d+1);this.w=.25/t,this.x=(u-l)*t,this.y=(n-h)*t,this.z=(o-r)*t}else if(i>a&&i>c){let t=2*s(1+i-a-c);this.w=(u-l)/t,this.x=.25*t,this.y=(r+o)/t,this.z=(n+h)/t}else if(a>c){let t=2*s(1+a-i-c);this.w=(n-h)/t,this.x=(r+o)/t,this.y=.25*t,this.z=(l+u)/t}else{let t=2*s(1+c-i-a);this.w=(o-r)/t,this.x=(n+h)/t,this.y=(l+u)/t,this.z=.25*t}return this}setFromEuler(t){let{x:e,y:i,z:r}=t;i*=.5,r*=.5;const s=c(e*=.5),n=d(e),o=c(i),a=d(i),l=c(r),h=d(r);return this.x=s*a*h-n*o*l,this.y=n*o*h+s*a*l,this.z=n*a*l-s*o*h,this.w=n*a*h+s*o*l,this}}e.Quat=x;class v{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.z=i}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}clone(){return(new v).copy(this)}equals(t){return this.x===t.x&&this.y===t.y&&this.z===t.z}setFromQuat(t){const{x:e,y:i,z:r,w:s}=t;return this.x=l(2*(s*e+i*r),1-2*(e*e+i*i)),this.y=h(f(2*(s*i-r*e),-1,1)),this.z=l(2*(s*r+e*i),1-2*(i*i+r*r)),this}setFromRotationMatrix(t){const e=t.elements,i=e[0],r=e[4],s=(e[8],e[1]),o=e[5],a=(e[9],e[2]),u=e[6],c=e[10];return this.y=h(-f(a,-1,1)),n(a)<.99999?(this.x=l(u,c),this.z=l(s,i)):(this.x=0,this.z=l(-r,o)),this}}e.Euler=v;e.Spherical=class{constructor(t=1,e=0,i=0){this.radius=t,this.phi=e,this.theta=i}setFromVec3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,i){return this.radius=s(t*t+e*e+i*i),0===this.radius?(this.theta=0,this.phi=0):(this.theta=l(t,i),this.phi=u(f(e/this.radius,-1,1))),this}};class y{constructor(t,e){this.min=void 0!==t?t:new g(1/0,1/0,1/0),this.max=void 0!==e?e:new g(-1/0,-1/0,-1/0)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}clone(){return(new y).copy(this)}set(t,e){return this.min.copy(t),this.max.copy(e),this}containsPoint(t){return!(t.x<this.min.x||t.y<this.min.y||t.z<this.min.z||t.x>this.max.x||t.y>this.max.y||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}makeEmpty(){this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.sumOf(this.min,this.max).scale(.5)}setFromPoints(t){this.makeEmpty();for(let e=0;e<t.length;e++)this.expandByPoint(t[e]);return this}expandByPoint(t){return this.min.min(t),this.max.max(t),this}}e.Box3=y;class b{constructor(t,e){this.setFromPoints=(()=>{let t=new y;return e=>{let i=this.center,r=0;t.setFromPoints(e).getCenter(this.center);for(let t=0;t<e.length;t++)r=o(r,i.distance2(e[t]));return this.radius=s(r),this}})(),this.center=void 0!==t?t:new g,this.radius=void 0!==e?e:0}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}clone(){return(new b).copy(this)}set(t,e){return this.center.copy(t),this.radius=e,this}transformMat4(t){return this.center.transformMat4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}}e.Sphere=b;class _{constructor(t,e){this.origin=new g,this.direction=new g,this.distanceToPoint2=(()=>{let t=new g;return e=>{let i=e.sub(this.origin,t).dot(this.direction);return i<0?this.origin.distance2(e):(t.copy(this.direction).scale(i).add(this.origin),t.distance2(e))}})(),this.intersectSphere=(()=>{let t=new g;return(e,i)=>{t.sub(e.center,this.origin);let r=t.dot(this.direction),s=t.dot(t)-r*r,n=e.radius*e.radius;if(s>n)return null;let o=Math.sqrt(n-s),a=r-o,l=r+o;return a<0&&l<0?null:a<0?this.at(l,i):this.at(a,i)}})(),this.intersectTriangle=(()=>{var t=new g,e=new g,i=new g,r=new g;return(s,n,o,a,l)=>{n.sub(s,e),o.sub(s,i),e.cross(i,r);var h,u=this.direction.dot(r);if(u>0){if(a)return null;h=1}else{if(!(u<0))return null;h=-1,u=-u}this.origin.sub(s,t);var c=h*this.direction.dot(t.cross(i,i));if(c<0)return null;var d=h*this.direction.dot(e.cross(t));if(d<0)return null;if(c+d>u)return null;var f=-h*t.dot(r);return f<0?null:this.at(f/u,l)}})(),this.origin=t||this.origin,this.direction=e||this.direction}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}clone(){return(new _).copy(this)}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}transformMat4(t){return this.origin.transformMat4(t),this.direction.transformDirection(t),this}at(t,e){return e.copy(this.direction).scale(t).add(this.origin)}distanceToPlane(t){let e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;let i=-t.distanceToPoint(this.origin)/e;return i>=0?i:null}intersectPlane(t,e){let i=this.distanceToPlane(t);return null===i?null:this.at(i,e)}intersectSphereTest(t){return this.distanceToPoint2(t.center)<=t.radius*t.radius}intersectPlaneTest(t){let e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0}}e.Ray=_;e.Face=class{constructor(t,e,i){this.a=t,this.b=e,this.c=i}};class T{constructor(t,e){this.normal=void 0!==t?t:new g(1,0,0),this.constant=void 0!==e?e:0}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}clone(){return(new T).copy(this)}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,i,r){return this.normal.set(t,e,i),this.constant=r,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}normalize(){let t=1/this.normal.length();return this.normal.scale(t),this.constant*=t,this}}e.Plane=T},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(0),s=i(36);var n;!function(t){t[t.Object3D=16]="Object3D",t[t.Camera=32]="Camera",t[t.PerspectiveCamera=33]="PerspectiveCamera",t[t.OrthoCamera=34]="OrthoCamera",t[t.Light=48]="Light",t[t.DirectionalLight=49]="DirectionalLight",t[t.PointLight=50]="PointLight",t[t.Mesh=64]="Mesh"}(n=e.ObjectType||(e.ObjectType={}));let o=1;e.Object3D=class extends s.Event{constructor(){super(...arguments),this.id=o++,this.type=n.Object3D,this.visible=!0,this.children=[],this.up=new r.Vec3(0,1,0),this.position=new r.Vec3,this.scale=new r.Vec3(1,1,1),this.rotation=new r.Euler,this.quaternion=new r.Quat,this.matrix=new r.Mat4,this.modelViewMatrix=new r.Mat4,this.isModelMatrixDirty=!0,this.isInvertModelMatrixDirty=!0,this.isTransformDirty=!0,this.isWorldPositionDirty=!0,this._modelMatrix=new r.Mat4,this._invertModelMatrix=new r.Mat4,this._worldPosition=new r.Vec3,this._components=[],this.updateModelMatrix=(()=>{let t=new r.Vec3,e=new r.Vec3(1,1,1),i=new r.Euler,s=new r.Quat;return()=>{if(!1===t.equals(this.position)&&(t.copy(this.position),this.isTransformDirty=!0),!1===e.equals(this.scale)&&(e.copy(this.scale),this.isTransformDirty=!0),!1===i.equals(this.rotation)&&(i.copy(this.rotation),this.quaternion.setFromEuler(this.rotation)),!1===s.equals(this.quaternion)&&(s.copy(this.quaternion),this.isTransformDirty=!0),this.isTransformDirty&&(this.isTransformDirty=!1,this.matrix.compose(this.quaternion,this.position,this.scale),this.isModelMatrixDirty=!0),this.isModelMatrixDirty){this.isModelMatrixDirty=!1,this.parent?this.parent.modelMatrix.multiply(this.matrix,this._modelMatrix):this._modelMatrix.copy(this.matrix);for(let t=0;t<this.children.length;t++)this.children[t].isModelMatrixDirty=!0;this.isInvertModelMatrixDirty=!0,this.isWorldPositionDirty=!0}return this._modelMatrix}})(),this.lookAt=(()=>{let t=new r.Vec3,e=new r.Mat4;return i=>(t.setFromMatrixPosition(this.modelMatrix),e.lookAt(t,i,this.up),this.rotation.setFromRotationMatrix(e),this)})()}get modelMatrix(){return this.updateModelMatrix()}get invertModelMatrix(){return this.updateInvertModelMatrix()}get worldPosition(){return this.isWorldPositionDirty&&(this.isWorldPositionDirty=!1,this._worldPosition.setFromMatrixPosition(this.modelMatrix)),this._worldPosition}add(t){return t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),this}remove(t){let e=this.children.indexOf(t);return-1!=e&&(t.parent=null,this.children.splice(e,1)),this}setParent(t){return t.add(this),this}update(t){this.updateModelMatrix();for(let e of this._components)e.start&&(e.start(),e.start=void 0),e.update(t);for(let e of this.children)e.update(t);return this}updateInvertModelMatrix(){return this.isInvertModelMatrixDirty&&(this.isInvertModelMatrixDirty=!1,this.modelMatrix.invert(this._invertModelMatrix)),this._invertModelMatrix}render(t){return this}getComponent(t){return this.findComponent(t)}addComponent(t){let e=this.findComponent(t);return void 0===e&&((e=new t).object=this,e.onLoad(),this._components.push(e)),e}removeComponent(t){let e=this._components.indexOf(t);return-1!=e&&this._components.splice(e,1),this}findComponent(t){for(let e=0,i=this._components.length;e<i;e++){let i=this._components[e];if(i instanceof t)return i}}raycast(t,e){return this}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.None=0]="None",t[t.Front=1]="Front",t[t.Back=2]="Back",t[t.Double=3]="Double"}(e.SideType||(e.SideType={})),function(t){t[t.None=0]="None",t[t.UnsignedByte=1]="UnsignedByte",t[t.Byte=2]="Byte",t[t.Short=3]="Short",t[t.UnsignedShort=4]="UnsignedShort",t[t.Int=5]="Int",t[t.UnsignedInt=6]="UnsignedInt",t[t.Float=7]="Float",t[t.HalfFloat=8]="HalfFloat",t[t.UnsignedShort4444=9]="UnsignedShort4444",t[t.UnsignedShort5551=10]="UnsignedShort5551",t[t.UnsignedShort565=11]="UnsignedShort565",t[t.UnsignedInt248=12]="UnsignedInt248"}(e.DataType||(e.DataType={})),function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.RGB=2]="RGB",t[t.RGBA=3]="RGBA",t[t.Luminance=4]="Luminance",t[t.LuminanceAlpha=5]="LuminanceAlpha",t[t.RGBE=3]="RGBE",t[t.Depth=4]="Depth",t[t.DepthStencil=5]="DepthStencil",t[t.Red=6]="Red"}(e.FormatType||(e.FormatType={})),function(t){t[t.None=0]="None",t[t.Repeat=1]="Repeat",t[t.ClampToEdge=2]="ClampToEdge",t[t.MirroredRepeat=3]="MirroredRepeat"}(e.WrappingType||(e.WrappingType={})),function(t){t[t.None=0]="None",t[t.Nearest=1]="Nearest",t[t.NearestMipMapNearest=2]="NearestMipMapNearest",t[t.NearestMipMapLinear=3]="NearestMipMapLinear",t[t.Linear=4]="Linear",t[t.LinearMipMapNearest=5]="LinearMipMapNearest",t[t.LinearMipMapLinear=6]="LinearMipMapLinear"}(e.FilterType||(e.FilterType={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(e.DrawMode||(e.DrawMode={}))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(25),s=i(2),n=i(19),o=i(26),a=i(13);let l=[],h=[],u=[],c=/(?:|\n|\r)\s*\/\/.*/g,d=/\s*#include\s*<(.*)>/g;function f(t){return t=(t=t.replace(c,(t,e)=>"")).replace(d,(t,e)=>{let i=o.ShaderChunk[e];if(void 0===i)throw Error("not find "+e);return`\n\n/*${e}*/\n`+i})}let p="\nattribute vec3 position;\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 modelMatrix;\nuniform vec3 cameraPosition;\n",g=1;e.Material=class{constructor(t){this.id=g++,this.side=s.SideType.Front,this.programId=-1,this.passList=[],this.defines={NUM_DIR_LIGHTS:0},this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.vertexShader=t.vertexShader,this.fragmentShader=t.fragmentShader,this.side=t.side||this.side,this.addPass(new a.Pass({material:this}))}get pass(){return this.passList[0]}set pass(t){this.passList[0]=t}addPass(t){return this.passList.push(t),this}useProgarm(t,e){this.side===s.SideType.Double?t.disable(gl.CULL_FACE):t.enable(gl.CULL_FACE),t.setFrontFace(this.side);let i=!1;return this.defines.NUM_DIR_LIGHTS!==t.dirctionalLength&&(this.defines.NUM_DIR_LIGHTS=t.dirctionalLength,i=!0),-1===this.programId&&(i=!0),i&&this.updateProgram(t,e),function(t){let e=l[t];if(void 0===e){let i=u[t];e=l[t]=new r.Program(f(i.vertexShader),f(i.fragmentShader))}return e}(this.programId).use()}updateProgram(t,e){let i="";for(let t in this.defines)i+=`#define ${t} ${this.defines[t]}\n`;let r=e.receiveShadow&&t.shadowLights.length>0,s=e.geometry,n=["precision mediump float;",this.map?"#define USE_MAP":"",this.bumpMap?"#define USE_BUMPMAP":"",r?"#define USE_SHADOWMAP":"",s.color?"#define USE_COLOR":"",s.uv?"attribute vec2 uv;":"",s.color?"attribute vec3 color;":"",s.normal?"attribute vec3 normal;":"",p,this.vertexShader,"\n"].filter(t=>""!==t).join("\n"),o=[this.getExtensions(t),"precision mediump float;",this.map?"#define USE_MAP":"",this.bumpMap?"#define USE_BUMPMAP":"",r?"#define USE_SHADOWMAP":"",s.color?"#define USE_COLOR":"",this.fragmentShader,"\n"].filter(t=>""!==t).join("\n");return this.programId=function(t){let e=h.indexOf(t);return-1===e&&(e=h.length,h.push(t)),e}(i+n+o),u[this.programId]={vertexShader:i+n,fragmentShader:i+o},this}getExtensions(t){let e=this.extensions;return[e.derivatives&&n.Extensions.get("OES_standard_derivatives")?"#extension GL_OES_standard_derivatives : enable":"",e.fragDepth&&n.Extensions.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",e.drawBuffers&&n.Extensions.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",e.shaderTextureLOD&&n.Extensions.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(t=>""!==t).join("\n")}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});let{floor:r}=Math;class s{constructor(t,e,i){this.r=0,this.g=0,this.b=0,t instanceof s?this.copy(t):void 0!==t&&void 0!==e&&void 0!==i?this.setFromRGB(t,e,i):void 0!==t&&this.setFromHex(t)}set(t,e=t,i=t){return this.r=t,this.g=e,this.b=i,this}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}clone(){return(new s).copy(this)}scale(t,e=this){return e.r=this.r*t,e.g=this.g*t,e.b=this.b*t,e}equals(t){return this.r===t.r&&this.g===t.g&&this.b===t.b}setFromHex(t){return t=r(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this}setFromRGB(t,e,i){return this.r=t,this.g=e,this.b=i,this}toArray(t,e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}}e.Color=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(2),s=i(19);function n(t){switch(t){case void 0:return;case r.FormatType.Alpha:return gl.ALPHA;case r.FormatType.RGBA:return gl.RGBA;case r.FormatType.RGB:return gl.RGB;case r.FormatType.Depth:return gl.DEPTH_COMPONENT;default:throw Error("invalid format: "+t)}}function o(t){switch(t){case void 0:return;case r.WrappingType.ClampToEdge:return gl.CLAMP_TO_EDGE;case r.WrappingType.MirroredRepeat:return gl.MIRRORED_REPEAT;case r.WrappingType.Repeat:return gl.REPEAT;default:throw Error("invalid wrapping: "+t)}}function a(t){switch(t){case void 0:return;case r.FilterType.Linear:return gl.LINEAR;case r.FilterType.LinearMipMapLinear:return gl.LINEAR_MIPMAP_LINEAR;case r.FilterType.LinearMipMapNearest:return gl.LINEAR_MIPMAP_NEAREST;case r.FilterType.Nearest:return gl.NEAREST;case r.FilterType.NearestMipMapLinear:return gl.NEAREST_MIPMAP_LINEAR;case r.FilterType.NearestMipMapNearest:return gl.NEAREST_MIPMAP_NEAREST;default:throw Error("invalid filter: "+t)}}function l(t){switch(t){case void 0:return;case r.DataType.Byte:return gl.BYTE;case r.DataType.Float:return gl.FLOAT;case r.DataType.Int:return gl.INT;case r.DataType.Short:return gl.SHORT;case r.DataType.UnsignedByte:return gl.UNSIGNED_BYTE;case r.DataType.UnsignedShort:return gl.UNSIGNED_SHORT;default:throw Error("invalid datatype: "+t)}}e.dirname=function(t){for(let e=t.length;e>0;e--)if("/"===t[e])return t.substr(0,e+1);return t},e.getImageWebglFormat=function(t){return t.search(/jpe?g/i)>0?gl.RGB:gl.RGBA},e.getTextureWebglOption=function(t){if(t.format=n(t.format||r.FormatType.RGBA),t.dataType=l(t.dataType||r.DataType.UnsignedByte),t.magFilter=a(t.magFilter||r.FilterType.Linear),t.minFilter=a(t.minFilter)||t.magFilter,t.wrapS=o(t.wrapS||r.WrappingType.ClampToEdge),t.wrapT=o(t.wrapT)||t.wrapS,t.dataType===gl.FLOAT&&!s.Extensions.get("OES_texture_float"))throw Error("not support DataType.Float");if(t.dataType===gl.FLOAT&&(t.magFilter===gl.LINEAR||t.minFilter===gl.LINEAR)&&!s.Extensions.get("OES_texture_float_linear"))throw Error("not support (DataType.Float && FilterType.Linear)");return t},e.getWebglFormt=n,e.getWebglWrapping=o,e.getWebglFilter=a,e.getWebglDataType=l,e.getWebglDrawMode=function(t){switch(t){case void 0:return;case r.DrawMode.POINTS:return gl.POINTS;case r.DrawMode.LINES:return gl.LINES;case r.DrawMode.LINE_LOOP:return gl.LINE_LOOP;case r.DrawMode.LINE_STRIP:return gl.LINE_STRIP;case r.DrawMode.TRIANGLES:return gl.TRIANGLES;case r.DrawMode.TRIANGLE_STRIP:return gl.TRIANGLE_STRIP;case r.DrawMode.TRIANGLE_FAN:return gl.TRIANGLE_FAN;default:throw Error("invalid drawMode: "+t)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(17),s=i(10),n=i(0);e.Geometry=class{constructor(){this.groups=[],this.faces=[],this.vertices=[]}set(t){return this.setBufferView("uv",t.uv,!1,2),this.setBufferView("position",t.position,!1,3),this.setBufferView("normal",t.normal,!1,3),this.setBufferView("color",t.color,!1,3),this.setBufferView("indice",t.indice,!0,1),this.setGroups(t.groups),this.computeVeticesFaces(),this}setBufferView(t,e,i,s){return void 0!==e&&(e instanceof r.BufferView?this[t]=e:e.length>0&&(this[t]=(new r.BufferView).set({data:e,isElement:i,stride:s}))),this}setGroups(t,e){if(this.groups.length=0,t)this.groups=t;else if(this.indice)this.groups.push((new s.Group).set({bv:this.indice,start:0,count:this.indice.count}));else{if(!this.position)throw Error("set groups fail");this.groups.push((new s.Group).set({bv:this.position,start:0,count:this.position.count}))}if(e){let t=this.groups[0];for(let i=0;i<e.length;i++){let r=this.groups[i];void 0===r&&(r=this.groups[i]=t.clone()),r.materialIndex=e[i]}}return this}computeVeticesFaces(){let{vertices:t,faces:e,groups:i,position:r,indice:s}=this;if(0===t.length){let e=r.values;for(let i=0;i<e.length;i+=3)t.push(new n.Vec3(e[i],e[i+1],e[i+2]))}if(0==e.length)for(let t of i)for(let i=t.start,r=t.start+t.count;i<r;i+=3)if(s){let t=s.values;e.push(new n.Face(t[i],t[i+1],t[i+2]))}else e.push(new n.Face(i,i+1,i+2));return this}computeBoundingSphere(){return void 0===this.boundingSphere&&(this.boundingSphere=new n.Sphere),this.boundingSphere.setFromPoints(this.vertices),this}computeBoundingBox(){return void 0===this.boundingBox&&(this.boundingBox=new n.Box3),this.boundingBox.setFromPoints(this.vertices),this}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(5),s=i(8),n=i(0);let o=1;e.Texture2D=class{constructor(t={}){if(this.id=o++,this.width=1,this.height=1,r.getTextureWebglOption(t),this.width=t.width||this.width,this.height=t.height||this.width||this.height,this.webgltexture=gl.createTexture(),gl.bindTexture(gl.TEXTURE_2D,this.webgltexture),gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,1),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,t.magFilter),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,t.minFilter),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,t.wrapS),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,t.wrapT),t.url){let e=r.getImageWebglFormat(t.url);s.loadImage(t.url,t=>{gl.bindTexture(gl.TEXTURE_2D,this.webgltexture),n.isPowerOfTwo(t.width)&&n.isPowerOfTwo(t.height)||(gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE)),gl.texImage2D(gl.TEXTURE_2D,0,e,e,gl.UNSIGNED_BYTE,t)}),gl.texImage2D(gl.TEXTURE_2D,0,e,1,1,0,e,t.dataType,new Uint8Array(4))}else{let e=gl.RGBA;gl.texImage2D(gl.TEXTURE_2D,0,e,this.width,this.height,0,e,t.dataType,null)}gl.bindTexture(gl.TEXTURE_2D,null)}}},function(t,e,i){"use strict";function r(t,e,i,r){let s=new XMLHttpRequest;return s.onreadystatechange=function(t){this.readyState===XMLHttpRequest.DONE&&200===this.status?i&&i(this.response):r&&r(this.status)},s.responseType=e,s.open("GET",t,!0),s.send(),s}Object.defineProperty(e,"__esModule",{value:!0}),e.loadBlob=function(t,e,i){return r(t,"arraybuffer",e,i)},e.loadText=function(t,e,i){return r(t,"text",e,i)},e.loadImage=function(t,e,i){let r=new Image;return r.onload=function(t){e&&e(r)},r.onerror=function(t){i&&i(t.toString())},r.crossOrigin="anonymous",r.src=t,r}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(1),s=i(0);e.Camera=class extends r.Object3D{constructor(){super(...arguments),this.type=r.ObjectType.Camera,this.projectionMatrix=new s.Mat4,this.unproject=(()=>{let t=new s.Mat4;return e=>e.transformMat4(this.projectionMatrix.invert(t)).transformMat4(this.modelMatrix)})()}get viewMatrix(){return this.invertModelMatrix}project(t){return t.transformMat4(this.invertModelMatrix).transformMat4(this.projectionMatrix)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(5);class s{set(t){let{bv:e,start:i,count:r,materialIndex:s=0}=t;return this.bv=e,this.start=i,this.count=r,this.offset=i*e.bytesPer,this.materialIndex=s,this}copy(t){return this.bv=t.bv,this.start=t.start,this.count=t.count,this.offset=t.offset,this.materialIndex=t.materialIndex,this}clone(){return(new s).copy(this)}draw(t){return t=r.getWebglDrawMode(t),this.bv.isElement?(gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.bv.webglbuffer),gl.drawElements(t,this.count,gl.UNSIGNED_SHORT,this.offset)):(gl.bindBuffer(gl.ARRAY_BUFFER,this.bv.webglbuffer),gl.drawArrays(t,this.start,this.count)),this}}e.Group=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(2),s=i(1),n=i(12),o=i(0);e.Mesh=class extends s.Object3D{constructor(t,e){super(),this.type=s.ObjectType.Mesh,this.drawMode=r.DrawMode.TRIANGLES,this.materials=[],this.castShadow=!1,this.receiveShadow=!1,this.uniforms={},this.raycast=(()=>{let t=new o.Sphere,e=new o.Ray,i=new o.Vec3,r=new o.Vec3,s=(t,e,i,s,n,o)=>null===e.intersectTriangle(i,s,n,!1,o)?null:(r.copy(o),r.transformMat4(this.modelMatrix),{distance:t.ray.origin.distance(r),point:r.clone(),object:this});return(r,n)=>{if(!1===this.visible)return this;if(void 0===this.geometry.boundingSphere&&this.geometry.computeBoundingSphere(),t.copy(this.geometry.boundingSphere),t.transformMat4(this.modelMatrix),!1===r.ray.intersectSphereTest(t))return this;e.copy(r.ray).transformMat4(this.invertModelMatrix);let o,a,l,h,{vertices:u,faces:c}=this.geometry;for(let t of c)o=u[t.a],a=u[t.b],l=u[t.c],null!==(h=s(r,e,o,a,l,i))&&n.push(h);return this}})(),this.geometry=t,Array.isArray(e)?this.materials=e:this.material=e||new n.PhongMaterial}get material(){return this.materials[0]}set material(t){this.materials[0]=t}useProgram(t,e){let i=t.programUsed;return t.materiaUsed!==e&&(t.materiaUsed=e,(i=e.useProgarm(t,this)).uniforms.setValue(e),t.programUsed!==i&&(t.programUsed=i,i.attributes.setValue(this.geometry))),i}render(t,e){let i,r,{camera:s,ambient:n,directionalLights:o,directionalShadowMap:a,directionalShadowMatrix:l}=t;s.viewMatrix.multiply(this.modelMatrix,this.modelViewMatrix),this.uniforms.modelViewMatrix=this.modelViewMatrix,this.uniforms.modelViewMatrix=this.modelViewMatrix,this.uniforms.modelMatrix=this.modelMatrix,this.uniforms.viewMatrix=s.viewMatrix,this.uniforms.projectionMatrix=s.projectionMatrix,this.uniforms.cameraPosition=s.worldPosition,this.uniforms.ambient=n,this.uniforms.directionalLights=o,this.uniforms.directionalShadowMap=a,this.uniforms.directionalShadowMatrix=l;for(let s of this.geometry.groups)if(void 0!==(r=e||this.materials[s.materialIndex]))for(let e of r.passList)!1!==e.enabled&&(e.beforeRender(e,t),e.renderTarget?(t.save(),t.setRenderTarget(e.renderTarget),(i=this.useProgram(t,e.material)).uniforms.setValue(this.uniforms),s.draw(this.drawMode),t.restore()):((i=this.useProgram(t,e.material)).uniforms.setValue(this.uniforms),s.draw(this.drawMode)),e.afterRender(e,t));return this}renderDepth(t,e,i){if(!1===this.castShadow)return this;let r;e.viewMatrix.multiply(this.modelMatrix,this.modelViewMatrix);for(let s of this.geometry.groups)(r=this.useProgram(t,i)).setUniform("modelViewMatrix",this.modelViewMatrix),r.setUniform("modelMatrix",this.modelMatrix),r.setUniform("viewMatrix",e.viewMatrix),r.setUniform("projectionMatrix",e.projectionMatrix),r.setUniform("cameraPosition",e.worldPosition),s.draw(this.drawMode);return this}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(3),s=i(7),n=i(4);let o="\nvarying vec3 vNormal;\nvarying vec3 vViewDir;\n\n#ifdef USE_MAP\nvarying vec2 vUv;\n#endif\n\n#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif\n\n#if NUM_DIR_LIGHTS > 0\nuniform mat4 directionalShadowMatrix[NUM_DIR_LIGHTS];\nvarying vec4 vDirectionalShadowCoord[NUM_DIR_LIGHTS];\n#endif\n\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n    vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n\n    vViewDir = cameraPosition - worldPosition.xyz;\n    vNormal = mat3(modelMatrix) * normal;\n\n#ifdef USE_MAP\n    vUv = uv;\n#endif\n\n#ifdef USE_COLOR\n    vColor = color;\n#endif\n\n#if NUM_DIR_LIGHTS > 0\n    #pragma unroll_loop\n    for (int i = 0; i < NUM_DIR_LIGHTS; i++) {\n        vDirectionalShadowCoord[i] = directionalShadowMatrix[i] * worldPosition;\n    }\n#endif\n}\n",a="\n#define saturate(a) clamp(a, 0.0, 1.0)\n#define PI 3.14159265359\n#define RECIPROCAL_PI 0.31830988618\n\nuniform float opacity;\nuniform float shininess;\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform vec3 ambient;\n\nvarying vec3 vNormal;\nvarying vec3 vViewDir;\n\nstruct DirectionalLight {\n    vec3 color;\n    vec3 direction;\n};\n\nstruct ReflectedLight {\n    vec3 diffuse;\n    vec3 specular;\n};\n\n#ifdef USE_MAP\nuniform sampler2D map;\nvarying vec2 vUv;\n#endif\n\n#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif\n\n#if NUM_DIR_LIGHTS > 0\nuniform DirectionalLight directionalLights[NUM_DIR_LIGHTS];\nuniform sampler2D directionalShadowMap[NUM_DIR_LIGHTS];\nvarying vec4 vDirectionalShadowCoord[NUM_DIR_LIGHTS];\n#endif\n\n#ifdef USE_SHADOWMAP\nfloat getShadow(sampler2D shadowMap, vec4 shadowCoord) {\n    float shadow = 1.0;\n    if (shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0 && shadowCoord.z <= 1.0) {\n        float depth = 1.0 - texture2D(shadowMap, shadowCoord.xy).r;\n        shadow = shadowCoord.z - 0.005 > depth ? 0.0: 1.0;\n    }\n    return shadow;\n}\n#endif\n\nvec3 F_Schlick(in vec3 specularColor, in float dotLH ) {\n\t// Original approximation by Christophe Schlick '94\n\t// float fresnel = pow( 1.0 - dotLH, 5.0 );\n\n\t// Optimized variant (presented by Epic at SIGGRAPH '13)\n\t// https://cdn2.unrealengine.com/Resources/files/2013SiggraphPresentationsNotes-26915738.pdf\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\n\nfloat G_BlinnPhong_Implicit() {\n    //(n dot l)(n dot v) / 4(n dot l)(n dot v) //分子是G_Implicit，分母是brdf的分母项，这里非常数项抵消了\n    return 0.25;\n}\n\n// http://www.cs.uu.nl/docs/vakken/magr/2016-2017/slides/lecture%2013%20-%20BRDFs.pdf\nfloat D_BlinnPhong(in float shininess, in float dotNH) {\n    // (shininess + 2) / (2 * PI) * pow(cos(N,H), shininess)\n    return RECIPROCAL_PI * (shininess * 0.5 + 1.0)  * pow(dotNH, shininess);\n}\n\nvec3 BRDF_Specular_BlinnPhong(in vec3 specularColor, in float shininess, in vec3 lightDir, in vec3 viewDir, in vec3 normal) {\n    vec3 halfDir = normalize(lightDir + viewDir);\n    float dotNH = saturate(dot(normal, halfDir));\n    float dotLH = saturate(dot(lightDir, halfDir));\n    // DFG / 4(n dot l)(n dot v), 分母在G项中抵消了\n    return D_BlinnPhong(shininess, dotNH) * F_Schlick(specularColor, dotLH) * G_BlinnPhong_Implicit();\n}\n\nvec3 BRDF_Diffuse_Lambert(in vec3 diffuseColor) {\n    return RECIPROCAL_PI * diffuseColor;\n}\n\n// source: https://www.cs.utah.edu/~reinhard/cdrom/\nvec3 ReinhardToneMapping(vec3 color) {\n    // color *= toneMappingExposure;\n    return saturate(color / (vec3(1.0) + color));\n}\n\nvoid main() {\n    vec3 normal = normalize(vNormal);\n    vec3 viewDir = normalize(vViewDir);\n    ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0));\n    vec4 diffuseColor = vec4(diffuse, opacity);\n\n#ifdef USE_MAP\n    diffuseColor *= texture2D(map, vUv);\n#endif\n\n#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif\n\n#if NUM_DIR_LIGHTS > 0\n    DirectionalLight directionalLight;\n    #pragma unroll_loop\n    for (int i = 0; i < NUM_DIR_LIGHTS; i++) {\n        directionalLight = directionalLights[i];\n\n        float dotNL = saturate(dot(normal, directionalLight.direction));\n        vec3 irradiance = dotNL * directionalLight.color;\n\n        #ifndef PHYSICALLY_CORRECT_LIGHTS\n        irradiance *= PI; //精准光源，不需要积分，不需要除以PI配平，所以这里乘以PI用来消除BRDF中的1/PI\n        #endif\n\n        #ifdef USE_SHADOWMAP\n        irradiance *= getShadow(directionalShadowMap[i], vDirectionalShadowCoord[i]);\n        #endif\n\n        reflectedLight.diffuse += irradiance * BRDF_Diffuse_Lambert(diffuseColor.rgb);\n        reflectedLight.specular += irradiance * BRDF_Specular_BlinnPhong(specular, shininess, directionalLight.direction, viewDir, normal);\n    }\n#endif\n\n    vec3 ambientColor = ambient * BRDF_Diffuse_Lambert(diffuseColor.rgb);\n\n    #ifndef PHYSICALLY_CORRECT_LIGHTS\n    ambientColor *= PI;\n    #endif\n    \n    vec3 outgoingLight = reflectedLight.diffuse + reflectedLight.specular + ambientColor + emissive;\n    gl_FragColor = vec4(outgoingLight, diffuseColor.a);\n}\n";e.PhongMaterial=class extends r.Material{constructor(t={}){super({vertexShader:o,fragmentShader:a}),this.opacity=1,this.shininess=32,this.diffuse=new n.Color(16777215),this.emissive=new n.Color(0),this.specular=new n.Color(1118481),this.name=t.name,this.map=t.url instanceof s.Texture2D?t.url:t.url?new s.Texture2D({url:t.url}):null,this.opacity=t.opacity||this.opacity,this.shininess=t.shininess||this.shininess,this.diffuse=t.diffuse||this.diffuse,this.emissive=t.emissive||this.emissive,this.specular=t.specular||this.specular}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(3),s=i(2);e.Pass=class{constructor(t){this.enabled=!0,this.material=t.material||new r.Material({vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,side:s.SideType.Double}),this.setUniforms(t.uniforms),this.renderTarget=t.renderTarget,this.beforeRender=t.beforeRender||this.beforeRender,this.afterRender=t.afterRender||this.afterRender}setUniforms(t){return t&&Object.defineProperties(this.material,t),this}addTo(t){return t.addPass(this),this}setUniform(t,e){return this.material[t]=e,this}beforeRender(t,e){}afterRender(t,e){}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(7);e.RenderTarget=class{constructor(t){this.texture=new r.Texture2D(t),this.setFrameBufferTexture(),this.setRenderBufferDepth(),this.checkComplete()}setFrameBufferTexture(){return this.webglframebuffer=gl.createFramebuffer(),gl.bindFramebuffer(gl.FRAMEBUFFER,this.webglframebuffer),gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,this.texture.webgltexture,0),gl.bindFramebuffer(gl.FRAMEBUFFER,null),this}setRenderBufferDepth(){return this.webglrenderbuffer=gl.createRenderbuffer(),gl.bindFramebuffer(gl.FRAMEBUFFER,this.webglframebuffer),gl.bindRenderbuffer(gl.RENDERBUFFER,this.webglrenderbuffer),gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_COMPONENT16,this.texture.width,this.texture.height),gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.DEPTH_ATTACHMENT,gl.RENDERBUFFER,this.webglrenderbuffer),gl.bindRenderbuffer(gl.RENDERBUFFER,null),gl.bindFramebuffer(gl.FRAMEBUFFER,null),this}checkComplete(){if(gl.checkFramebufferStatus(gl.FRAMEBUFFER)!==gl.FRAMEBUFFER_COMPLETE)throw Error("RenderTarget incomplete");return this}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(9),s=i(1);e.OrthoCamera=class extends r.Camera{constructor(t=-1,e=1,i=1,r=-1,n=0,o=2e3){super(),this.type=s.ObjectType.OrthoCamera,this.projectionMatrix.ortho(t,e,r,i,n,o)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.Component=class{constructor(){this.object=null}onLoad(){}start(){}update(t){}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class r{constructor(){this.byteStride=0,this.byteOffset=0,this.bytesPer=0,this.count=0,this.isElement=!1}set(t){let{data:e,isElement:i,stride:r=0,offset:s=0}=t;return this.values=e.slice(),this.count=r>0?e.length/r:e.length,this.webglbuffer=gl.createBuffer(),i?(this.bytesPer=Uint16Array.BYTES_PER_ELEMENT,gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.webglbuffer),gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(e),gl.STATIC_DRAW),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,null)):(this.bytesPer=Float32Array.BYTES_PER_ELEMENT,gl.bindBuffer(gl.ARRAY_BUFFER,this.webglbuffer),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(e),gl.STATIC_DRAW),gl.bindBuffer(gl.ARRAY_BUFFER,null)),this.isElement=i,this.byteStride=r?r*this.bytesPer:this.byteStride,this.byteOffset=s?s*this.bytesPer:this.byteOffset,this}copy(t){return this.webglbuffer=t.webglbuffer,this.byteStride=t.byteStride,this.byteOffset=t.byteOffset,this.bytesPer=t.bytesPer,this.isElement=t.isElement,this.values=t.values,this.count=t.count,this}clone(){return(new r).copy(this)}}e.BufferView=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.Clock=class{constructor(){this.diffTime=0,this.nowTime=0,this.oldTime=0}getDelta(){return this.nowTime=Date.now(),0===this.oldTime?this.oldTime=this.nowTime:(this.diffTime=this.nowTime-this.oldTime,this.oldTime=this.nowTime),.001*this.diffTime}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Extensions=new class{constructor(){this.extensions={}}get(t){if(void 0!==this.extensions[t])return this.extensions[t];let e;switch(t){case"WEBGL_depth_texture":e=gl.getExtension("WEBGL_depth_texture")||gl.getExtension("MOZ_WEBGL_depth_texture")||gl.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":e=gl.getExtension("EXT_texture_filter_anisotropic")||gl.getExtension("MOZ_EXT_texture_filter_anisotropic")||gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":e=gl.getExtension("WEBGL_compressed_texture_s3tc")||gl.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":e=gl.getExtension("WEBGL_compressed_texture_pvrtc")||gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:e=gl.getExtension(t)}return null===e&&console.warn("Extensions: "+t+" extension not supported."),this.extensions[t]=e,e}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(1),s=i(21),n=i(29),o=i(41);e.Scene=class extends r.Object3D{constructor(){super(),canvas.addEventListener("mousedown",t=>this.emit("MouseDown",{broadcost:!0,data:t})),canvas.addEventListener("mouseup",t=>this.emit("MouseUp",{broadcost:!0,data:t})),canvas.addEventListener("mousemove",t=>this.emit("MouseMove",{broadcost:!0,data:t})),canvas.addEventListener("mousewheel",t=>this.emit("MouseWheel",{broadcost:!0,data:t})),canvas.addEventListener("touchstart",t=>this.emit("TouchStart",{broadcost:!0,data:t})),canvas.addEventListener("touchend",t=>this.emit("TouchEnd",{broadcost:!0,data:t})),canvas.addEventListener("touchmove",t=>this.emit("TouchMove",{broadcost:!0,data:t}))}get backgroundMap(){return this.backgournd?this.backgournd.material.map:null}setBackground(t){t?(this.backgournd=s.MeshBuilder.Box(),this.backgournd.material=new n.CubeMaterial({urls:t})):this.backgournd=null}beforeRender(t){return t.backgournd=this.backgournd,this}afterRender(t){return void 0===this.monitor&&(this.monitor=new o.Monitor),this.monitor.update(t),this}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(22),s=i(23),n=i(24),o=i(11),a=i(27);e.MeshBuilder=class{static Sphere(t=1,e=10){let i=new o.Mesh(new r.SphereGeometry(e));return i.scale.set(t),i}static Box(t=1,e=t,i=t){let r=new o.Mesh(new n.CubeGeometry);return r.scale.set(t,e,i),r}static Plane(t=1,e=t,i=1,r=1){let n=new o.Mesh(new s.PlaneGeometry(i,r));return n.scale.set(t,e),n}static Model(t,e,i){if(t.url.endsWith(".obj"))return a.OBJLoader.load(t,e,i);throw Error("not support now: "+t.url)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(6),s=i(0);e.SphereGeometry=class extends r.Geometry{constructor(t=10){super();let e,i,r,n=[],o=[],a=[],l=[],h=new s.Vec3,u=new s.Vec3,c=!1,d=[],f={},p=[];function g(t){let e=JSON.stringify(t);return void 0===f[e]&&(f[e]=p.length,p.push(t)),f[e]}function m(t,e=1){return t*e+(t-t*t)/2}function x(t,e,i){return c?n.push(t,e,i):n.push(t,i,e)}for(let s=0;s<8;s++){u.set(2*(1&s)-1,(2&s)-1,(4&s)/2-1),c=u.x*u.y*u.z>0,d.length=0;for(let s=0;s<=t;s++){for(let n=0;s+n<=t;n++)e=s/t,i=n/t,r=(t-s-n)/t,d.push(g({vertex:h.set(m(e),m(i),m(r)).normalize().multiply(u).toArray([]),uv:u.y>0?[1-e,r]:[r,1-e]}));if(s>0)for(let r=0;s+r<=t;r++)e=m(s-1,t+1)+r,i=m(s,t+1)+r,x(d[e],d[e+1],d[i]),s+r<t&&x(d[i],d[e+1],d[i+1])}}for(let t of p)o.push(...t.vertex),a.push(...t.vertex),l.push(...t.uv);this.set({uv:l,position:o,normal:a,indice:n})}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(6);e.PlaneGeometry=class extends r.Geometry{constructor(t=1,e=t){super();let i=[],r=[],s=[],n=[];for(let o=0;o<=e;o++){let a=o/e;for(let l=0;l<=t;l++){let h=l/t;if(r.push(2*h-1,2*a-1,0),s.push(0,0,1),n.push(h,a),l<t&&o<e){let e=l+o*(t+1);i.push(e,e+1,e+t+1),i.push(e+t+1,e+1,e+t+2)}}}this.set({uv:n,position:r,normal:s,indice:i})}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(6);let s=[[0,4,2,6,-1,0,0],[1,3,5,7,1,0,0],[0,1,4,5,0,-1,0],[2,6,3,7,0,1,0],[0,2,1,3,0,0,-1],[4,5,6,7,0,0,1]];e.CubeGeometry=class extends r.Geometry{constructor(){super();let t=[],e=[],i=[],r=[];for(let n=0;n<s.length;n++){let o=s[n],a=4*n;for(let t=0;t<4;t++){let s=o[t];e.push(2*(1&s)-1,(2&s)-1,(4&s)/2-1),i.push(o[4],o[5],o[6]),r.push(1&t,(2&t)/2)}t.push(a,a+1,a+2),t.push(a+2,a+1,a+3)}this.set({uv:r,position:e,normal:i,indice:t})}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});let r=[],s=new Float32Array(16);function n(t,e){let i=t.length,s=i*e,n=r[s];void 0===n&&(n=r[s]=new Float32Array(s));for(let r=0,s=0;r<i;++r,s+=e)t[r].toArray(n,s);return n}function o(t,e){let i=e,s=r[i];return void 0===s&&(s=r[i]=new Float32Array(i)),t.toArray(s),s}class a{constructor(t,e,i,r){this.id=t,this.addr=e,this.info=i,this.program=r}setValue(t){if(null==t)return this;const{info:e,addr:i,program:r}=this;switch(e.type){case gl.INT:gl.uniform1i(i,t);break;case gl.FLOAT:gl.uniform1f(i,t);break;case gl.FLOAT_VEC2:gl.uniform2fv(i,o(t,2));break;case gl.FLOAT_VEC3:gl.uniform3fv(i,o(t,3));break;case gl.FLOAT_MAT4:s.set(t.elements),gl.uniformMatrix4fv(i,!1,s);break;case gl.SAMPLER_2D:{let e=r.getTextureUnit(t.id);gl.activeTexture(gl.TEXTURE0+e),gl.bindTexture(gl.TEXTURE_2D,t.webgltexture),gl.uniform1i(i,e);break}case gl.SAMPLER_CUBE:{let e=r.getTextureUnit(t.id);gl.activeTexture(gl.TEXTURE0+e),gl.bindTexture(gl.TEXTURE_CUBE_MAP,t.webgltexture),gl.uniform1i(i,e);break}default:throw Error("uniform type invalid "+e.type)}return this}}class l extends a{setValue(t){if(null==t)return this;const{info:e,addr:i,program:r}=this;switch(e.type){case gl.INT:gl.uniform1iv(i,t);break;case gl.FLOAT:gl.uniform1fv(i,t);break;case gl.FLOAT_VEC2:gl.uniform2fv(i,n(t,2));break;case gl.FLOAT_VEC3:gl.uniform3fv(i,n(t,3));break;case gl.FLOAT_MAT4:gl.uniformMatrix4fv(i,!1,n(t,16));break;case gl.SAMPLER_2D:for(let e of t){let t=r.getTextureUnit(e.id);gl.activeTexture(gl.TEXTURE0+t),gl.bindTexture(gl.TEXTURE_2D,e.webgltexture),gl.uniform1i(i,t)}break;case gl.SAMPLER_CUBE:for(let e of t){let t=r.getTextureUnit(e.id);gl.activeTexture(gl.TEXTURE0+t),gl.bindTexture(gl.TEXTURE_CUBE_MAP,e.webgltexture),gl.uniform1i(i,t)}break;default:throw Error("ArrayUniform.setValue: invalid type "+e.type)}return this}}class h{constructor(t,e,i){this.id=t,this.addr=e,this.info=i}setValue(t){if(null==t)return this;const{webglbuffer:e,byteStride:i,byteOffset:r}=t,{info:s,addr:n}=this;switch(gl.bindBuffer(gl.ARRAY_BUFFER,e),s.type){case gl.INT:gl.vertexAttribPointer(n,1,gl.INT,!1,i,r);break;case gl.INT_VEC2:gl.vertexAttribPointer(n,2,gl.INT,!1,i,r);break;case gl.INT_VEC3:gl.vertexAttribPointer(n,3,gl.INT,!1,i,r);break;case gl.INT_VEC4:gl.vertexAttribPointer(n,4,gl.INT,!1,i,r);break;case gl.FLOAT:gl.vertexAttribPointer(n,1,gl.FLOAT,!1,i,r);break;case gl.FLOAT_VEC2:gl.vertexAttribPointer(n,2,gl.FLOAT,!1,i,r);break;case gl.FLOAT_VEC3:gl.vertexAttribPointer(n,3,gl.FLOAT,!1,i,r);break;case gl.FLOAT_VEC4:gl.vertexAttribPointer(n,4,gl.FLOAT,!1,i,r);break;case gl.FLOAT_MAT2:gl.vertexAttribPointer(n,2,gl.FLOAT,!1,i,r);break;case gl.FLOAT_MAT3:gl.vertexAttribPointer(n,3,gl.FLOAT,!1,i,r);break;case gl.FLOAT_MAT4:gl.vertexAttribPointer(n,4,gl.FLOAT,!1,i,r);break;default:throw Error("attribute type invalid "+s.type)}return gl.enableVertexAttribArray(n),this}}class u{constructor(t){this.seq=[],this.map={},this.id=t}add(t){return this.seq.push(t),this.map[t.id]=t,this}setValue(t){if(null==t)return this;for(let e of this.seq)e.setValue(t[e.id]);return this}}function c(t,e){let{map:i,seq:r}=t,s=i[e];return void 0===s&&(s=i[e]=new u(e),r.push(s)),s}let d=/(\w+)(\[\d+\])?(\.\w+)?/;function f(t,e,i){let r=e.name.match(d),s=r[1],n=r[2],o=r[3];if(s)if(o){let r=c(t.uniforms,s);void 0!==n&&(r=c(r,n.substr(1,n.length-2))),r.add(new a(o.substr(1),i,e,t))}else void 0!==n?t.uniforms.add(new l(s,i,e,t)):t.uniforms.add(new a(s,i,e,t));return t.uniforms}e.Program=class{constructor(t,e){function i(t,e,i="shader"){let r=gl.createShader(t);if(gl.shaderSource(r,e),gl.compileShader(r),!gl.getShaderParameter(r,gl.COMPILE_STATUS))throw Error(`${i}: \n`+gl.getShaderInfoLog(r));return r}this.attributes=new u("attributes"),this.uniforms=new u("uniforms"),this.textureUnits={},this.textureUnit=0;let r=i(gl.VERTEX_SHADER,t,"vertex shader"),s=i(gl.FRAGMENT_SHADER,e,"fragment shader"),n=gl.createProgram();if(gl.attachShader(n,r),gl.attachShader(n,s),gl.linkProgram(n),!gl.getProgramParameter(n,gl.LINK_STATUS))throw Error("shader program: \n"+gl.getProgramInfoLog(n));gl.deleteShader(r),gl.deleteShader(s);let o=gl.getProgramParameter(n,gl.ACTIVE_UNIFORMS);for(let t=0;t<o;t++){let e=gl.getActiveUniform(n,t);f(this,e,gl.getUniformLocation(n,e.name))}let a=gl.getProgramParameter(n,gl.ACTIVE_ATTRIBUTES);for(let t=0;t<a;t++){let e=gl.getActiveAttrib(n,t),i=gl.getAttribLocation(n,e.name);this.attributes.add(new h(e.name,i,e))}this.webglprogram=n}getTextureUnit(t){let e=this.textureUnits[t];if(void 0===e&&(e=this.textureUnits[t]=this.textureUnit++)>16)throw Error("texture unit larger than support");return e}use(){return gl.useProgram(this.webglprogram),this}setUniform(t,e){let i=this.uniforms.map[t];return i&&i.setValue(e),this}setAttribute(t,e){let i=this.attributes.map[t];return i&&i.setValue(e),this}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ShaderChunk={}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(1),s=i(5),n=i(10),o=i(11),a=i(8),l=i(28),h=i(6);class u{constructor(t=-1){this.vertices=[],this.colors=[],this.normals=[],this.uvs=[],this.groups=[],this.faceType=-1,this.mtllist=[],this.faceType=t}reset(){return this.vertices.length=0,this.colors.length=0,this.normals.length=0,this.uvs.length=0,this.faceType=-1,this}addGroup(){return this.groups.push(this.vertices.length/3),this}getMesh(t){let e=(new h.Geometry).set({position:this.vertices,color:this.colors,normal:this.normals,uv:this.uvs});this.addGroup();let i=[];for(let r=0;r+1<this.groups.length;r++){let s=t.findIndex(t=>t.name===this.mtllist[r]);i.push((new n.Group).set({bv:e.position,start:this.groups[r],count:this.groups[r+1]-this.groups[r],materialIndex:s}))}return e.setGroups(i),new o.Mesh(e,t)}}e.OBJLoader=new class{constructor(){this.rootPath=null,this.buffer=new u,this.output=new u,this.outputList=[],this.mtllib=""}load(t,e,i){return this.buffer.reset(),this.output.reset(),this.outputList.length=0,this.mtllib="",this.rootPath=this.rootPath||s.dirname(t.url),a.loadText(t.url,s=>{let n,o="",a=new Array(128),h=0,u=0,c=s.length;for(let t=0;t<c;t++)switch(n=s[t]){case" ":o.length>0&&(a[h++]=o),o="";break;case"/":o.length>0&&(a[h++]=o),o="",u++;break;case"\n":o.length>0&&(a[h++]=o),o="",this.processLine(a,h,u),h=0,u=0;break;case"\r":break;default:o+=n}l.MTLLoader.load({url:this.mtllib,materials:t.materials},t=>{let i=new r.Object3D;for(let e of this.outputList)i.add(e.getMesh(t));e&&e(i)},i)},i),this}processLine(t,e,i){if(0!==e)switch(t[0]){case"v":this.buffer.vertices.push(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3])),e>4&&this.buffer.colors.push(parseFloat(t[4]),parseFloat(t[5]),parseFloat(t[6]));break;case"vt":this.buffer.uvs.push(parseFloat(t[1]),parseFloat(t[2]));break;case"vn":this.buffer.normals.push(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3]));break;case"f":let r=e-1;if(0===i){this.checkFaceType(0);for(let i=2;i+1<e;i++)this.buildFace(t[1]),this.buildFace(t[i]),this.buildFace(t[i+1])}else if(r===2*i){this.checkFaceType(1);for(let i=3;i+3<e;i+=2)this.buildFace(t[1],t[2]),this.buildFace(t[i],t[i+1]),this.buildFace(t[i+2],t[i+3])}else if(2*r==3*i){this.checkFaceType(2);for(let i=4;i+5<e;i+=3)this.buildFace(t[1],t[2],t[3]),this.buildFace(t[i],t[i+1],t[i+2]),this.buildFace(t[i+3],t[i+4],t[i+5])}else{this.checkFaceType(3);for(let i=3;i+3<e;i+=2)this.buildFace(t[1],null,t[2]),this.buildFace(t[i],null,t[i+1]),this.buildFace(t[i+2],null,t[i+3])}break;case"l":case"p":case"s":case"g":case"o":break;case"mtllib":this.mtllib=this.rootPath+t[1];break;case"usemtl":this.output.addGroup(),this.output.mtllist.push(t[1])}}checkFaceType(t){-1===this.output.faceType?(this.output.faceType=t,this.outputList.push(this.output)):this.output.faceType!==t&&(this.output=new u(t),this.outputList.push(this.output))}buildFace(t,e,i){let r=parseInt(t),s=3*(r>0?r-1:r+this.buffer.vertices.length/3),n=this.buffer.colors.length>0?s:null,o=this.buffer.vertices;if(this.output.vertices.push(o[s++],o[s++],o[s]),null!==n){let t=this.buffer.colors;this.output.colors.push(t[n++],t[n++],t[n])}if(e){let t=parseInt(e),i=2*(t>0?t-1:t+this.buffer.uvs.length/2),r=this.buffer.uvs;this.output.uvs.push(r[i++],r[i])}if(i){let t=parseInt(i),e=3*(t>0?t-1:t+this.buffer.normals.length/3),r=this.buffer.normals;this.output.normals.push(r[e++],r[e++],r[e])}}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(8),s=i(5),n=i(4),o=i(12),a=i(40),l=i(7),h=i(2);class u{constructor(){this.shininess=0,this.emissive=new n.Color,this.diffuse=new n.Color,this.specular=new n.Color}reset(){return this.url=null,this.name=null,this.shininess=0,this.emissive.set(0),this.diffuse.set(0),this.specular.set(0),this}}e.MTLLoader=new class{constructor(){this.rootPath=null,this.output=new u,this.outputList=[]}load(t,e,i){return this.output.reset(),this.outputList.length=0,this.rootPath=this.rootPath||s.dirname(t.url),r.loadText(t.url,i=>{let r,s="",n=new Array(128),u=0,c=i.length;for(let t=0;t<c;t++)switch(r=i[t]){case" ":s.length>0&&(n[u++]=s),s="";break;case"\n":s.length>0&&(n[u++]=s),s="",this.processLine(n,u),u=0;break;case"\r":break;default:s+=r}let d=[];for(let e=0;e<this.outputList.length;e++){let i=this.outputList[e];switch(i.url&&(i.url=new l.Texture2D({url:i.url,wrapS:h.WrappingType.Repeat})),i.urlBump&&(i.urlBump=new l.Texture2D({url:i.urlBump,wrapS:h.WrappingType.Repeat})),t.materials&&t.materials[e]){case"skin":d.push(new a.SkinMaterial(i));break;default:d.push(new o.PhongMaterial(i))}}e&&e(d)},i),this}processLine(t,e){if(0!==e)switch(t[0].toLowerCase()){case"newmtl":this.output=new u,this.output.name=t[1],this.outputList.push(this.output);break;case"ns":this.output.shininess=parseFloat(t[1]);break;case"ka":this.output.emissive.set(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3]));break;case"kd":this.output.diffuse.set(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3]));break;case"ks":this.output.specular.set(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3]));break;case"map_kd":this.output.url=this.rootPath+t[1];break;case"map_bump":this.output.urlBump=this.rootPath+t[1]}}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(3),s=i(30),n=i(2);let o="\nvarying vec3 vWorldDirection;\n\nvoid main() {\n    vWorldDirection = normalize(position);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    gl_Position.z = gl_Position.w; //令 z/w = 1.0, 这样可以欺骗深度测试认为天空盒的深度为最大深度1.0，用于通过深度测试，将天空盒放最后渲染，可以得到轻微的性能提升，避免覆盖渲染。\n}\n",a="\nuniform samplerCube map;\nvarying vec3 vWorldDirection;\n\nvoid main() {\n    gl_FragColor = textureCube(map, vWorldDirection);\n}\n";e.CubeMaterial=class extends r.Material{constructor(t={}){super({vertexShader:o,fragmentShader:a}),this.side=n.SideType.Back,this.map=t.urls instanceof s.TextureCube?t.urls:new s.TextureCube({urls:t.urls})}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(5),s=i(8),n=i(0);let o=1e4;e.TextureCube=class{constructor(t={}){if(this.id=o++,this.width=1,this.height=1,r.getTextureWebglOption(t),this.width=t.width||this.width,this.height=t.height||this.height,this.webgltexture=gl.createTexture(),gl.bindTexture(gl.TEXTURE_CUBE_MAP,this.webgltexture),gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,0),gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_MAG_FILTER,t.magFilter),gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_MIN_FILTER,t.minFilter),gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_WRAP_S,t.wrapS),gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_WRAP_T,t.wrapT),t.urls){if(6!==t.urls.length)throw Error("TextureCube: urls.length should be 6");for(let e=0;e<6;e++){let i=t.urls[e],o=r.getImageWebglFormat(i);s.loadImage(i,t=>{gl.bindTexture(gl.TEXTURE_CUBE_MAP,this.webgltexture),n.isPowerOfTwo(t.width)&&n.isPowerOfTwo(t.height)||(gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE)),gl.texImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,o,o,gl.UNSIGNED_BYTE,t)}),gl.texImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,o,this.width,this.height,0,o,t.dataType,new Uint8Array(4))}}else for(let e=0;e<6;e++){let i=gl.RGBA;gl.texImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,i,this.width,this.height,0,i,t.dataType,null)}gl.bindTexture(gl.TEXTURE_CUBE_MAP,null)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(32);e.ShadowMap=class{render(t){let e=t.shadowLights;if(0===e.length)return this;t.save();for(let i of e)t.setRenderTarget(i.shadow.renderTarget),this.renderObjects(i,t);return t.restore(),this}renderObjects(t,e){let i=t.shadow,s=i.matrix,n=i.camera;if(void 0===n)return console.error("ShadowMap.renderLight",t,"dont`t has camera"),this;n.position.copy(t.worldPosition),n.lookAt(t.target.worldPosition),s.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),s.multiply(n.projectionMatrix),s.multiply(n.viewMatrix),void 0===this.depthMaterial&&(this.depthMaterial=new r.DepthMaterial);for(let t of e.renderList)t.renderDepth(e,n,this.depthMaterial);return this}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(3);let s="\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n",n="\nvoid main() {\n    gl_FragColor = vec4(vec3(1.0 - gl_FragCoord.z), 1.0); // gl_FragCoord.z的坐标范围是[0, 1]，这里用1.0减去z的原因是，纹理默认是值是0，\n}\n";e.DepthMaterial=class extends r.Material{constructor(){super({vertexShader:s,fragmentShader:n})}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(0);e.Shadow=class{constructor(){this.mapSize=new r.Vec2(512,512),this.matrix=new r.Mat4}onInit(t){}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(1),s=i(33),n=i(4),o=i(0),a=i(14);e.Light=class extends r.Object3D{constructor(t,e){super(),this.type=r.ObjectType.Light,this.color=new n.Color(1,1,1),this.intensity=1,this.shadow=new s.Shadow,this.castShadow=!1,this.target=new r.Object3D,this._direction=new o.Vec3,this.color=new n.Color(t||this.color),this.intensity=e||this.intensity}get direction(){return this.worldPosition.sub(this.target.worldPosition,this._direction),this._direction.normalize()}update(t){return this.castShadow&&void 0===this.shadow.renderTarget&&(this.shadow.renderTarget=new a.RenderTarget({width:this.shadow.mapSize.x,height:this.shadow.mapSize.y}),this.shadow.onInit(this.shadow.renderTarget)),super.update(t),this}}},function(t,e,i){"use strict";function r(t){for(var i in t)e.hasOwnProperty(i)||(e[i]=t[i])}Object.defineProperty(e,"__esModule",{value:!0});const s=window.canvas=document.getElementById("canvas");window.gl=s.getContext("webgl")||s.getContext("experimental-webgl"),r(i(9)),r(i(15)),r(i(37)),r(i(16)),r(i(38)),r(i(0)),r(i(17)),r(i(18)),r(i(4)),r(i(10)),r(i(39)),r(i(2)),r(i(0)),r(i(11)),r(i(1)),r(i(13)),r(i(25)),r(i(42)),r(i(43)),r(i(14)),r(i(20)),r(i(33)),r(i(31)),r(i(7)),r(i(30)),r(i(6)),r(i(23)),r(i(24)),r(i(22)),r(i(34)),r(i(44)),r(i(8)),r(i(28)),r(i(27)),r(i(3)),r(i(29)),r(i(32)),r(i(12)),r(i(45)),r(i(21)),r(i(26))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.Event=class{constructor(){this.children=[],this.listeners={}}on(t,e){let i=this.listeners[t];return void 0===i&&(i=this.listeners[t]=[]),-1===i.indexOf(e)&&i.push(e),this}off(t,e){let i=this.listeners[t];if(void 0!==i){if(e){let t=i.indexOf(e);-1!==t&&i.splice(t,1)}else delete this.listeners[t];return this}}emit(t,e){let i=this.listeners[t];if(i)for(let t of i)t(e.data);if(e.bubble&&this.parent&&this.parent.emit(t,e),e.broadcost&&this.children)for(let i of this.children)i.emit(t,e);return this}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(9),s=i(1),n=i(0);e.PerspectiveCamera=class extends r.Camera{constructor(t=50,e=1,i=.1,r=1e3){super(),this.type=s.ObjectType.PerspectiveCamera,this.projectionMatrix.perspective(n.degToRad(t),e,i,r)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(16),s=i(0);let{pow:n}=Math;e.OrbitControl=class extends r.Component{constructor(){super(...arguments),this.target=new s.Vec3,this.zoomSpeed=1,this.isDragging=!1,this.isDirty=!1,this.offset=new s.Vec2,this.offsetOld=new s.Vec2,this.dollyScale=1}onLoad(){this.spherical=(new s.Spherical).setFromVec3(this.object.position),this.object.on("MouseDown",t=>{this.isDragging=!0}),this.object.on("MouseUp",t=>{this.isDragging=!1,this.offset.set(0),this.offsetOld.set(0)}),this.object.on("MouseMove",t=>{!1!==this.isDragging&&(this.offset.set(t.offsetX,t.offsetY),0===this.offsetOld.x&&0===this.offsetOld.y?this.offsetOld.copy(this.offset):this.isDirty=!0)}),this.object.on("MouseWheel",t=>{t.deltaY>0?(this.dollyScale/=this.getZoomScale(),this.isDirty=!0):t.deltaY<0&&(this.dollyScale*=this.getZoomScale(),this.isDirty=!0)})}update(){this.isDirty&&(this.isDirty=!1,this.spherical.theta-=s.degToRad(.5*(this.offset.x-this.offsetOld.x)),this.spherical.phi-=s.degToRad(.5*(this.offset.y-this.offsetOld.y)),this.spherical.phi=Math.max(1e-5,Math.min(Math.PI-1e-5,this.spherical.phi)),this.spherical.radius*=this.dollyScale,this.object.position.setFromSpherical(this.spherical),this.object.lookAt(this.target),this.offsetOld.copy(this.offset),this.dollyScale=1)}getZoomScale(){return n(.95,this.zoomSpeed)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(15),s=i(20);e.GUI=class extends s.Scene{constructor(){super(),this.camera=new r.OrthoCamera(-500,500,500,-500,1,10),this.camera.position.set(0,0,2),this.add(this.camera)}beforeRender(t){return t.autoClear=!1,this}afterRender(t){return t.autoClear=!0,this}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(3),s=i(4),n=i(7),o=i(0),a=i(13),l=i(14);let h="\nvarying vec3 vNormal;\nvarying vec3 vViewDir;\n\n#ifdef USE_MAP\nvarying vec2 vUv;\n#endif\n\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n    vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n\n    vViewDir = cameraPosition - worldPosition.xyz;\n    vNormal = mat3(modelMatrix) * normal;\n\n#ifdef USE_MAP\n    vUv = uv;\n#endif\n}\n",u="\n#define saturate(a) clamp(a, 0.0, 1.0)\n\nvarying vec3 vNormal;\nvarying vec3 vViewDir;\n\n#ifdef USE_MAP\nuniform sampler2D map;\nvarying vec2 vUv;\n#endif\n\nuniform sampler2D beckmannMap;\n\nuniform vec3 diffuse;\nuniform vec3 specular;\nuniform vec3 ambient;\nuniform vec3 wrapRGB;\n\nuniform float opacity;\nuniform float roughness;\nuniform float brightness;\n\nstruct DirectionalLight {\n    vec3 color;\n    vec3 direction;\n};\n\nstruct ReflectedLight {\n    vec3 diffuse;\n    vec3 specular;\n};\n\n#if NUM_DIR_LIGHTS > 0\nuniform DirectionalLight directionalLights[NUM_DIR_LIGHTS];\n#endif\n\n#ifdef USE_BUMPMAP\nuniform sampler2D bumpMap;\nuniform float bumpScale;\n\n// Bump Mapping Unparametrized Surfaces on the GPU by Morten S. Mikkelsen\n// http://api.unrealengine.com/attachments/Engine/Rendering/LightingAndShadows/BumpMappingWithoutTangentSpace/mm_sfgrad_bump.pdf\n\n// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\nvec2 dHdxy_fwd() {\n    vec2 dSTdx = dFdx( vUv );\n    vec2 dSTdy = dFdy( vUv );\n\n    float Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n    float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n    float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n    \n    return vec2( dBx, dBy );\n}\n\nvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n    // Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\n\n    vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n    vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n    vec3 vN = surf_norm;\t\t// normalized\n\n    vec3 R1 = cross( vSigmaY, vN );\n    vec3 R2 = cross( vN, vSigmaX );\n\n    float fDet = dot( vSigmaX, R1 );\n\n    fDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n    vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n    return normalize( abs( fDet ) * surf_norm - vGrad );\n}\n#endif\n\nfloat fresnelReflectance(vec3 H, vec3 V, float F0) {\n    float base = 1.0 - dot(V, H);\n    float exponential = pow(base, 5.0);\n    return exponential + F0 * (1.0 - exponential);\n}\n\n// Kelemen/Szirmay-Kalos specular BRDF\nfloat KS_Skin_Specular(\n    vec3 N, \t\t// Bumped surface normal\n    vec3 L, \t\t// Points to light\n    vec3 V,\t\t    // Points to eye\n    float m, \t    // Roughness\n    float rho_s \t// Specular brightness\n) {\n    float result = 0.0;\n    float ndotl = dot(N, L);\n\n    if (ndotl > 0.0) {\n        vec3 h = L + V; // Unnormalized half-way vector\n        vec3 H = normalize(h);\n\n        float ndoth = dot(N, H);\n\n        float PH = pow(2.0 * texture2D(beckmannMap, vec2(ndoth, m)).x, 10.0);\n\n        float F = fresnelReflectance(H, V, 0.028);\n        float frSpec = max(PH * F / dot(h, h), 0.0);\n\n        result = ndotl * rho_s * frSpec; // BRDF * dot(N,L) * rho_s\n    }\n    return result;\n}\n\nvoid main() {\n    vec3 normal = normalize(vNormal);\n    vec3 viewDir = normalize(vViewDir);\n    ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0));\n    vec4 diffuseColor = vec4(diffuse, opacity);\n\n#ifdef USE_MAP\n    vec4 texelColor = texture2D(map, vUv);\n    diffuseColor.rgb *= texelColor.rgb * texelColor.rgb;\n#endif\n\n#ifdef USE_BUMPMAP\n    normal = perturbNormalArb(vViewDir, normal, dHdxy_fwd());\n#endif \n\n#if NUM_DIR_LIGHTS > 0\n    DirectionalLight directionalLight;\n    #pragma unroll_loop\n    for (int i = 0; i < NUM_DIR_LIGHTS; i++) {\n        directionalLight = directionalLights[i];\n        vec3 irradiance = directionalLight.color;\n\n        float dotNL = saturate(dot(normal, directionalLight.direction));\n        vec3 weight = mix(vec3(dotNL), vec3(dotNL * 0.5 + 0.5), wrapRGB);\n\n        vec3 specularColor = specular * KS_Skin_Specular(normal, directionalLight.direction, viewDir, roughness, brightness);\n\n        reflectedLight.diffuse += irradiance * diffuseColor.rgb * weight;\n        reflectedLight.specular += irradiance * specularColor;\n    }\n#endif\n\n    vec3 ambientColor = ambient * diffuseColor.rgb;\n    vec3 outgoingLight = reflectedLight.diffuse + reflectedLight.specular + ambientColor;\n    gl_FragColor = vec4(outgoingLight, diffuseColor.a);\n}\n",c="\nvarying vec2 vUv;\n\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    vUv = uv;\n}\n",d="\nvarying vec2 vUv;\n\nfloat PHBeckmann(float ndoth, float m) {\n    float alpha = acos(ndoth);\n    float ta = tan(alpha);\n\n    float val = 1.0 / (m * m * pow(ndoth, 4.0)) * exp(-(ta * ta) / (m * m));\n    return val;\n}\n\nfloat KSTextureCompute(vec2 tex) {\n    // Scale the value to fit within [0,1]  invert upon lookup.\n    return 0.5 * pow(PHBeckmann(tex.x, tex.y), 0.1);\n}\n\nvoid main() {\n    float x = KSTextureCompute(vUv);\n    gl_FragColor = vec4(x, x, x, 1.0);\n}\n";e.SkinMaterial=class extends r.Material{constructor(t){super({vertexShader:h,fragmentShader:u}),this.diffuse=new s.Color(15658734),this.specular=new s.Color(1118481),this.opacity=1,this.roughness=.15,this.brightness=.75,this.wrapRGB=new o.Vec3(.75,.375,.1875);let e=new l.RenderTarget({width:512});this.name=t.name,this.map=t.url instanceof n.Texture2D?t.url:t.url?new n.Texture2D({url:t.url}):null,this.bumpMap=t.urlBump instanceof n.Texture2D?t.urlBump:t.urlBump?new n.Texture2D({url:t.urlBump}):null,this.beckmannMap=e.texture,this.extensions.derivatives=!0,this.addPass(new a.Pass({vertexShader:c,fragmentShader:d,renderTarget:e,afterRender:t=>t.enabled=!1}))}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});let{round:r,min:s,max:n}=Math,o=r(devicePixelRatio||1),a=80*o,l=48*o,h=3*o,u=2*o,c=3*o,d=15*o,f=74*o,p=30*o;class g{constructor(t,e,i,r){this.minValue=1/0,this.maxValue=0,this.name="",this.frontColor=null,this.backgroundColor=null,this.type=t,this.name=e,this.frontColor=i,this.backgroundColor=r;let s=document.createElement("canvas");s.width=a,s.height=l,s.style.cssText="width:80px;height:48px",this.dom=s,this.context=s.getContext("2d"),this.context.font="bold "+9*o+"px Helvetica,Arial,sans-serif",this.context.textBaseline="top",this.context.fillStyle=r,this.context.fillRect(0,0,a,l),this.context.fillStyle=i,this.context.fillText(this.name,h,u),this.context.fillRect(c,d,f,p),this.context.fillStyle=r,this.context.globalAlpha=.9,this.context.fillRect(c,d,f,p)}update(t,e){this.minValue=s(this.minValue,t),this.maxValue=n(this.maxValue,t),this.context.fillStyle=this.backgroundColor,this.context.globalAlpha=1,this.context.fillRect(0,0,a,d),this.context.fillStyle=this.frontColor,this.context.fillText(r(t)+" "+this.name+" ("+r(this.minValue)+"-"+r(this.maxValue)+")",h,u),this.context.drawImage(this.dom,c+o,d,f-o,p,c,d,f-o,p),this.context.fillRect(c+f-o,d,o,p),this.context.fillStyle=this.backgroundColor,this.context.globalAlpha=.9,this.context.fillRect(c+f-o,d,o,r((1-t/e)*p))}show(t){return this.dom.style.display=t?"block":"none",this}}class m{constructor(){this.mode=-1,this.panels=[],this.container=document.createElement("div"),this.container.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",document.body.appendChild(this.container),this.addPanel(new g(1,"FPS","#0ff","#002")),performance&&performance.memory&&this.addPanel(new g(2,"MB","#f08","#201")),this.addPanel(new g(4,"MS","#0f0","#020"))}showPanel(t){if(this.mode!==t){this.mode=t;for(let e of this.panels)e.show((e.type&t)>0)}return this}addPanel(t){return this.panels.push(t),this.container.appendChild(t.dom),this}update(t,e,i){for(let e of this.panels)if(1===e.type&&e.update(t,100),4===e.type&&e.update(i,200),2===e.type){let t=performance.memory;e.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return this}}e.Monitor=class{constructor(){this.face=0,this.memory=0,this.fps=0,this.stats=new m,this.statsMode=7,this.total=0,this.frame=0}update(t){let{renderList:e,clock:i}=t;this.face=0;for(let t of e)this.face+=t.geometry.faces.length;return this.total+=.001*i.diffTime,this.frame++,this.total>=1&&(this.total=0,this.fps=this.frame,this.frame=0,this.stats.update(this.fps,this.face,i.diffTime)),this.stats.showPanel(this.statsMode),this}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(0);function s(t,e){return t.distance-e.distance}e.Raycaster=class{constructor(){this.ray=new r.Ray}setFromCamera(t,e){return this.ray.origin.setFromMatrixPosition(e.modelMatrix),e.unproject(this.ray.direction.set(t.x,t.y,-1)).sub(this.ray.origin).normalize(),this}intersectObject(t,e,i=!0){return e.length=0,t.raycast(this,e),e.sort(s),e}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(1),s=i(0),n=i(4),o=i(31),a=i(18),l=i(2);let h={};function u(t){let e=h[t.id];if(void 0!==e)return e;switch(t.type){case r.ObjectType.Light:e={color:new n.Color};break;case r.ObjectType.DirectionalLight:e={color:new n.Color,direction:new s.Vec3}}return h[t.id]=e,e}e.Renderer=class{constructor(){this.camera=null,this.backgournd=null,this.renderList=[],this.lights=[],this.shadowLights=[],this.directionalLights=[],this.directionalShadowMap=[],this.directionalShadowMatrix=[],this.dirctionalLength=0,this.clock=new a.Clock,this.clearColor=new n.Color,this.autoClear=!0,this.ambient=null,this.enabledCapabilities={},this.renderTarget=null,this.saveContents=[],this.shadowMap=new o.ShadowMap,gl.clearColor(0,0,0,1),gl.enable(gl.DEPTH_TEST),gl.depthFunc(gl.LEQUAL),gl.enable(gl.CULL_FACE)}reset(){return this.renderList.length=0,this.lights.length=0,this.shadowLights.length=0,this}save(){return this.saveContents.push(this.renderTarget),this}restore(){return this.setRenderTarget(this.saveContents.pop(),!1),this}setRenderTarget(t,e=!0){return this.renderTarget!==t&&(this.renderTarget=t,t?(gl.bindFramebuffer(gl.FRAMEBUFFER,t.webglframebuffer),gl.viewport(0,0,t.texture.width,t.texture.height)):(gl.bindFramebuffer(gl.FRAMEBUFFER,null),gl.viewport(0,0,canvas.width,canvas.height)),e&&this.clear()),this}pushLight(t){return this.lights.push(t),t.castShadow&&this.shadowLights.push(t),this}pushMesh(t){return this.renderList.push(t),this}updateLights(){this.dirctionalLength=0;for(let t of this.lights){let e=t.shadow,i=u(t);switch(t.type){case r.ObjectType.Light:this.ambient=i.color.copy(t.color).scale(t.intensity);break;case r.ObjectType.DirectionalLight:(i=i).color.copy(t.color).scale(t.intensity),i.direction.copy(t.direction),this.directionalLights[this.dirctionalLength]=i,this.directionalShadowMap[this.dirctionalLength]=e.renderTarget&&e.renderTarget.texture||null,this.directionalShadowMatrix[this.dirctionalLength]=e.matrix||null,this.dirctionalLength++}}return this}projectObject(t){if(!1===t.visible)return this;switch(240&t.type){case r.ObjectType.Light:this.pushLight(t);break;case r.ObjectType.Camera:this.camera=t;break;case r.ObjectType.Mesh:this.pushMesh(t)}for(let e of t.children)this.projectObject(e);return this}render(t){t.update(this.clock.getDelta()),t.beforeRender(this),this.reset(),this.projectObject(t),this.updateLights(),this.shadowMap.render(this),this.autoClear&&this.clear();for(let t of this.renderList)t.render(this);return this.backgournd&&(this.backgournd.position.copy(this.camera.position),this.backgournd.render(this)),t.afterRender(this),this}clear(t=!0,e=!0){let i=0;return t&&(i|=gl.COLOR_BUFFER_BIT),e&&(i|=gl.DEPTH_BUFFER_BIT),i&&gl.clear(i),this}setClearColor(t){return!1===this.clearColor.equals(t)&&(this.clearColor.copy(t),gl.clearColor(t.r,t.g,t.b,1)),this}setFrontFace(t){return gl.frontFace(t===l.SideType.Back?gl.CW:gl.CCW),this}enable(t){return!0!==this.enabledCapabilities[t]&&(this.enabledCapabilities[t]=!0,gl.enable(t)),this}disable(t){return!1!==this.enabledCapabilities[t]&&(this.enabledCapabilities[t]=!1,gl.disable(t)),this}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(34),s=i(1);e.DirectionalLight=class extends r.Light{constructor(t,e){super(t,e),this.type=s.ObjectType.DirectionalLight,this.position.copy(this.up)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(3);let s="\nvarying vec2 vUv;\n\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n    vUv = uv;\n}\n",n="\nuniform sampler2D map;\nvarying vec2 vUv;\n\nvoid main() {\n    gl_FragColor = texture2D(map, vUv);\n}\n";e.UnpackDepthMaterial=class extends r.Material{constructor(t){super({vertexShader:s,fragmentShader:n}),this.map=t.map||this.map}}}])}));