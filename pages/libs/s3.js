!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.s3=e():t.s3=e()}(window,(function(){return function(t){var e={};function i(r){if(e[r])return e[r].exports;var s=e[r]={i:r,l:!1,exports:{}};return t[r].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(r,s,function(e){return t[e]}.bind(null,s));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=34)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});let{tan:r,sqrt:s,abs:n,max:o,min:a,atan2:h,asin:l,acos:u,sin:c,cos:d}=Math;function p(t,e,i){return o(e,a(t,i))}e.DEG2RAD=Math.PI/180,e.RAD2DEG=180/Math.PI,e.degToRad=function(t){return t*e.DEG2RAD},e.clamp=p,e.isPowerOfTwo=function(t){return 0==(t&t-1)&&0!==t};class f{constructor(t=0,e=0){this.x=t,this.y=e}set(t,e=t){return this.x=t,this.y=e,this}copy(t){return this.x=t.x,this.y=t.y,this}clone(){return(new f).copy(this)}sub(t,e=this){return e.x=this.x-t.x,e.y=this.y-t.y,e}scale(t,e=this){return e.x=this.x*t,e.y=this.y*t,e}toArray(t,e=0){return t[e]=this.x,t[e+1]=this.y,t}}e.Vec2=f;class m{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.z=i}set(t,e=t,i=t){return this.x=t,this.y=e,this.z=i,this}isZero(){return 0===this.x&&0===this.y&&0===this.z}clone(){return(new m).copy(this)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}equals(t){return this.x===t.x&&this.y===t.y&&this.z===t.z}add(t,e=this){return e.x=this.x+t.x,e.y=this.y+t.y,e.z=this.z+t.z,e}sub(t,e=this){return e.x=this.x-t.x,e.y=this.y-t.y,e.z=this.z-t.z,e}multiply(t,e=this){return e.x=this.x*t.x,e.y=this.y*t.y,e.z=this.z*t.z,e}sumOf(t,e,i=this){return i.x=t.x+e.x,i.y=t.y+e.y,i.z=t.z+e.z,i}diffOf(t,e,i=this){return i.x=t.x-e.x,i.y=t.y-e.y,i.z=t.z-e.z,i}length(){return s(this.length2())}length2(){let{x:t,y:e,z:i}=this;return t*t+e*e+i*i}normalize(t=this){return this.scale(1/this.length(),t)}scale(t,e=this){return e.x=this.x*t,e.y=this.y*t,e.z=this.z*t,e}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}cross(t,e=this){const i=this.x,r=this.y,s=this.z,n=t.x,o=t.y,a=t.z;return e.x=r*a-s*o,e.y=s*n-i*a,e.z=i*o-r*n,e}min(t){return this.x=a(this.x,t.x),this.y=a(this.y,t.y),this.z=a(this.z,t.z),this}max(t){return this.x=o(this.x,t.x),this.y=o(this.y,t.y),this.z=o(this.z,t.z),this}setFromMatrixPosition(t){let e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixColumn(t,e){let i=t.elements,r=4*e;return this.x=i[r],this.y=i[r+1],this.z=i[r+2],this}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){let r=c(e)*t;return this.x=r*c(i),this.y=d(e)*t,this.z=r*d(i),this}transformMat4(t,e=this){let i=t.elements,r=this.x,s=this.y,n=this.z,o=i[3]*r+i[7]*s+i[11]*n+i[15]||1;return o=1/o,e.x=(i[0]*r+i[4]*s+i[8]*n+i[12])*o,e.y=(i[1]*r+i[5]*s+i[9]*n+i[13])*o,e.z=(i[2]*r+i[6]*s+i[10]*n+i[14])*o,e}transformDirection(t,e=this){let i=this.x,r=this.y,s=this.z,n=t.elements;return this.x=n[0]*i+n[4]*r+n[8]*s,this.y=n[1]*i+n[5]*r+n[9]*s,this.z=n[2]*i+n[6]*r+n[10]*s,this.normalize(e)}transformQuat(t){let e=t.x,i=t.y,r=t.z,s=t.w,n=this.x,o=this.y,a=this.z,h=i*a-r*o,l=r*n-e*a,u=e*o-i*n,c=i*u-r*l,d=r*h-e*u,p=e*l-i*h,f=2*s;return h*=f,l*=f,u*=f,c*=2,d*=2,p*=2,this.x=n+h+c,this.y=o+l+d,this.z=a+u+p,this}distance(t){return s(this.distance2(t))}distance2(t){let e=this.x-t.x,i=this.y-t.y,r=this.z-t.z;return e*e+i*i+r*r}toArray(t,e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}}e.Vec3=m;class g{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.lookAt=(()=>{let t=new m,e=new m,i=new m;return(r,s,o)=>{r.sub(s,i),i.isZero()&&(i.z=1),i.normalize(),o.cross(i,t),t.isZero()&&(1===n(o.z)?i.x+=1e-4:i.z+=1e-4,i.normalize(),o.cross(i,t)),t.normalize(),i.cross(t,e);let a=this.elements;return a[0]=t.x,a[1]=t.y,a[2]=t.z,a[4]=e.x,a[5]=e.y,a[6]=e.z,a[8]=i.x,a[9]=i.y,a[10]=i.z,this}})()}set(t,e,i,r,s,n,o,a,h,l,u,c,d,p,f,m){let g=this.elements;return g[0]=t,g[4]=e,g[8]=i,g[12]=r,g[1]=s,g[5]=n,g[9]=o,g[13]=a,g[2]=h,g[6]=l,g[10]=u,g[14]=c,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}copy(t){let e=this.elements,i=t.elements;return e[0]=i[0],e[4]=i[4],e[8]=i[8],e[12]=i[12],e[1]=i[1],e[5]=i[5],e[9]=i[9],e[13]=i[13],e[2]=i[2],e[6]=i[6],e[10]=i[10],e[14]=i[14],e[3]=i[3],e[7]=i[7],e[11]=i[11],e[15]=i[15],this}clone(){return(new g).copy(this)}perspective(t,e,i,s){const n=1/r(t/2),o=1/(i-s),a=this.elements;return a[0]=n/e,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=n,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=(s+i)*o,a[11]=-1,a[12]=0,a[13]=0,a[14]=2*s*i*o,a[15]=0,this}ortho(t,e,i,r,s,n){const o=1/(t-e),a=1/(i-r),h=1/(s-n),l=this.elements;return l[0]=-2*o,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=-2*a,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=2*h,l[11]=0,l[12]=(t+e)*o,l[13]=(r+i)*a,l[14]=(n+s)*h,l[15]=1,this}multiply(t,e=this){const i=this.elements,r=t.elements,s=e.elements,n=i[0],o=i[1],a=i[2],h=i[3],l=i[4],u=i[5],c=i[6],d=i[7],p=i[8],f=i[9],m=i[10],g=i[11],x=i[12],y=i[13],b=i[14],v=i[15];let w=r[0],T=r[1],_=r[2],M=r[3];return s[0]=w*n+T*l+_*p+M*x,s[1]=w*o+T*u+_*f+M*y,s[2]=w*a+T*c+_*m+M*b,s[3]=w*h+T*d+_*g+M*v,w=r[4],T=r[5],_=r[6],M=r[7],s[4]=w*n+T*l+_*p+M*x,s[5]=w*o+T*u+_*f+M*y,s[6]=w*a+T*c+_*m+M*b,s[7]=w*h+T*d+_*g+M*v,w=r[8],T=r[9],_=r[10],M=r[11],s[8]=w*n+T*l+_*p+M*x,s[9]=w*o+T*u+_*f+M*y,s[10]=w*a+T*c+_*m+M*b,s[11]=w*h+T*d+_*g+M*v,w=r[12],T=r[13],_=r[14],M=r[15],s[12]=w*n+T*l+_*p+M*x,s[13]=w*o+T*u+_*f+M*y,s[14]=w*a+T*c+_*m+M*b,s[15]=w*h+T*d+_*g+M*v,e}compose(t,e,i){const r=t.x,s=t.y,n=t.z,o=t.w,a=r+r,h=s+s,l=n+n,u=r*a,c=r*h,d=r*l,p=s*h,f=s*l,m=n*l,g=o*a,x=o*h,y=o*l,b=i.x,v=i.y,w=i.z,T=this.elements;return T[0]=(1-(p+m))*b,T[1]=(c+y)*b,T[2]=(d-x)*b,T[3]=0,T[4]=(c-y)*v,T[5]=(1-(u+m))*v,T[6]=(f+g)*v,T[7]=0,T[8]=(d+x)*w,T[9]=(f-g)*w,T[10]=(1-(u+p))*w,T[11]=0,T[12]=e.x,T[13]=e.y,T[14]=e.z,T[15]=1,this}invert(t=this){let e=this.elements,i=t.elements;const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],h=e[5],l=e[6],u=e[7],c=e[8],d=e[9],p=e[10],f=e[11],m=e[12],g=e[13],x=e[14],y=e[15],b=r*h-s*a,v=r*l-n*a,w=r*u-o*a,T=s*l-n*h,_=s*u-o*h,M=n*u-o*l,E=c*g-d*m,P=c*x-p*m,S=c*y-f*m,R=d*x-p*g,L=d*y-f*g,F=p*y-f*x;let D=b*F-v*L+w*R+T*S-_*P+M*E;if(0===D)throw Error("Mat4.invert: can't invert determinant is 0");return D=1/D,i[0]=(h*F-l*L+u*R)*D,i[1]=(n*L-s*F-o*R)*D,i[2]=(g*M-x*_+y*T)*D,i[3]=(p*_-d*M-f*T)*D,i[4]=(l*S-a*F-u*P)*D,i[5]=(r*F-n*S+o*P)*D,i[6]=(x*w-m*M-y*v)*D,i[7]=(c*M-p*w+f*v)*D,i[8]=(a*L-h*S+u*E)*D,i[9]=(s*S-r*L-o*E)*D,i[10]=(m*_-g*w+y*b)*D,i[11]=(d*w-c*_-f*b)*D,i[12]=(h*P-a*R-l*E)*D,i[13]=(r*R-s*P+n*E)*D,i[14]=(g*v-m*T-x*b)*D,i[15]=(c*T-d*v+p*b)*D,t}makeTranslation(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}makeRotationFromEuler(t){const e=t.x,i=t.y,r=t.z,s=d(e),n=c(e),o=d(i),a=c(i),h=d(r),l=c(r),u=s*h,p=s*l,f=n*h,m=n*l,g=o*h,x=f*a,y=u*a,b=o*l,v=m*a,w=p*a,T=f,_=o*n,M=s*o;return this.set(g,x-p,m+y,0,b,u+v,w-T,0,-a,_,M,0,0,0,0,1),this}translate(t,e=this){return this.tranlateFromCartesianCoords(t.x,t.y,t.z,e)}tranlateFromCartesianCoords(t,e,i,r=this){let s=r.elements;return s[12]=t,s[13]=e,s[14]=i,s[15]=1,r}getMaxScaleOnAxis(){let t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],r=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return s(o(e,i,r))}toArray(t,e=0){let i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}}e.Mat4=g;class x{constructor(){this.x=0,this.y=0,this.z=0,this.w=1}set(t,e,i,r){return this.x=t,this.y=e,this.z=i,this.w=r,this}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}clone(){return(new x).copy(this)}equals(t){return this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w}setFromRotationMatrix(t){const e=t.elements,i=e[0],r=e[4],n=e[8],o=e[1],a=e[5],h=e[9],l=e[2],u=e[6],c=e[10];let d=i+a+c;if(d>0){let t=.5/s(d+1);this.w=.25/t,this.x=(u-h)*t,this.y=(n-l)*t,this.z=(o-r)*t}else if(i>a&&i>c){let t=2*s(1+i-a-c);this.w=(u-h)/t,this.x=.25*t,this.y=(r+o)/t,this.z=(n+l)/t}else if(a>c){let t=2*s(1+a-i-c);this.w=(n-l)/t,this.x=(r+o)/t,this.y=.25*t,this.z=(h+u)/t}else{let t=2*s(1+c-i-a);this.w=(o-r)/t,this.x=(n+l)/t,this.y=(h+u)/t,this.z=.25*t}return this}setFromEuler(t){let{x:e,y:i,z:r}=t;i*=.5,r*=.5;const s=c(e*=.5),n=d(e),o=c(i),a=d(i),h=c(r),l=d(r);return this.x=s*a*l-n*o*h,this.y=n*o*l+s*a*h,this.z=n*a*h-s*o*l,this.w=n*a*l+s*o*h,this}}e.Quat=x;class y{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.z=i}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}clone(){return(new y).copy(this)}equals(t){return this.x===t.x&&this.y===t.y&&this.z===t.z}setFromQuat(t){const{x:e,y:i,z:r,w:s}=t;return this.x=h(2*(s*e+i*r),1-2*(e*e+i*i)),this.y=l(p(2*(s*i-r*e),-1,1)),this.z=h(2*(s*r+e*i),1-2*(i*i+r*r)),this}setFromRotationMatrix(t){const e=t.elements,i=e[0],r=e[4],s=(e[8],e[1]),o=e[5],a=(e[9],e[2]),u=e[6],c=e[10];return this.y=l(-p(a,-1,1)),n(a)<.99999?(this.x=h(u,c),this.z=h(s,i)):(this.x=0,this.z=h(-r,o)),this}}e.Euler=y;e.Spherical=class{constructor(t=1,e=0,i=0){this.radius=t,this.phi=e,this.theta=i}setFromVec3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,i){return this.radius=s(t*t+e*e+i*i),0===this.radius?(this.theta=0,this.phi=0):(this.theta=h(t,i),this.phi=u(p(e/this.radius,-1,1))),this}};class b{constructor(t,e){this.min=void 0!==t?t:new m(1/0,1/0,1/0),this.max=void 0!==e?e:new m(-1/0,-1/0,-1/0)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}clone(){return(new b).copy(this)}set(t,e){return this.min.copy(t),this.max.copy(e),this}containsPoint(t){return!(t.x<this.min.x||t.y<this.min.y||t.z<this.min.z||t.x>this.max.x||t.y>this.max.y||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}makeEmpty(){this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.sumOf(this.min,this.max).scale(.5)}setFromPoints(t){this.makeEmpty();for(let e=0;e<t.length;e++)this.expandByPoint(t[e]);return this}expandByPoint(t){return this.min.min(t),this.max.max(t),this}}e.Box3=b;class v{constructor(t,e){this.setFromPoints=(()=>{let t=new b;return e=>{let i=this.center,r=0;t.setFromPoints(e).getCenter(this.center);for(let t=0;t<e.length;t++)r=o(r,i.distance2(e[t]));return this.radius=s(r),this}})(),this.center=void 0!==t?t:new m,this.radius=void 0!==e?e:0}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}clone(){return(new v).copy(this)}set(t,e){return this.center.copy(t),this.radius=e,this}transformMat4(t){return this.center.transformMat4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}}e.Sphere=v;class w{constructor(t,e){this.origin=new m,this.direction=new m,this.distanceToPoint2=(()=>{let t=new m;return e=>{let i=e.sub(this.origin,t).dot(this.direction);return i<0?this.origin.distance2(e):(t.copy(this.direction).scale(i).add(this.origin),t.distance2(e))}})(),this.intersectSphere=(()=>{let t=new m;return(e,i)=>{t.sub(e.center,this.origin);let r=t.dot(this.direction),s=t.dot(t)-r*r,n=e.radius*e.radius;if(s>n)return null;let o=Math.sqrt(n-s),a=r-o,h=r+o;return a<0&&h<0?null:a<0?this.at(h,i):this.at(a,i)}})(),this.intersectTriangle=(()=>{var t=new m,e=new m,i=new m,r=new m;return(s,n,o,a,h)=>{n.sub(s,e),o.sub(s,i),e.cross(i,r);var l,u=this.direction.dot(r);if(u>0){if(a)return null;l=1}else{if(!(u<0))return null;l=-1,u=-u}this.origin.sub(s,t);var c=l*this.direction.dot(t.cross(i,i));if(c<0)return null;var d=l*this.direction.dot(e.cross(t));if(d<0)return null;if(c+d>u)return null;var p=-l*t.dot(r);return p<0?null:this.at(p/u,h)}})(),this.origin=t||this.origin,this.direction=e||this.direction}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}clone(){return(new w).copy(this)}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}transformMat4(t){return this.origin.transformMat4(t),this.direction.transformDirection(t),this}at(t,e){return e.copy(this.direction).scale(t).add(this.origin)}distanceToPlane(t){let e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;let i=-t.distanceToPoint(this.origin)/e;return i>=0?i:null}intersectPlane(t,e){let i=this.distanceToPlane(t);return null===i?null:this.at(i,e)}intersectSphereTest(t){return this.distanceToPoint2(t.center)<=t.radius*t.radius}intersectPlaneTest(t){let e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0}}e.Ray=w;e.Face=class{constructor(t,e,i){this.a=t,this.b=e,this.c=i}};class T{constructor(t,e){this.normal=void 0!==t?t:new m(1,0,0),this.constant=void 0!==e?e:0}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}clone(){return(new T).copy(this)}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,i,r){return this.normal.set(t,e,i),this.constant=r,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}normalize(){let t=1/this.normal.length();return this.normal.scale(t),this.constant*=t,this}}e.Plane=T},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(0),s=i(35);var n;!function(t){t[t.Object3D=16]="Object3D",t[t.Camera=32]="Camera",t[t.PerspectiveCamera=33]="PerspectiveCamera",t[t.OrthoCamera=34]="OrthoCamera",t[t.Light=48]="Light",t[t.DirectionalLight=49]="DirectionalLight",t[t.PointLight=50]="PointLight",t[t.Mesh=64]="Mesh"}(n=e.ObjectType||(e.ObjectType={}));let o=1;e.Object3D=class extends s.Event{constructor(){super(...arguments),this.id=o++,this.type=n.Object3D,this.visible=!0,this.children=[],this.up=new r.Vec3(0,1,0),this.position=new r.Vec3,this.scale=new r.Vec3(1,1,1),this.rotation=new r.Euler,this.quaternion=new r.Quat,this.matrix=new r.Mat4,this.modelViewMatrix=new r.Mat4,this.isModelMatrixDirty=!0,this.isInvertModelMatrixDirty=!0,this.isTransformDirty=!0,this.isWorldPositionDirty=!0,this._modelMatrix=new r.Mat4,this._invertModelMatrix=new r.Mat4,this._worldPosition=new r.Vec3,this._components=[],this.updateModelMatrix=(()=>{let t=new r.Vec3,e=new r.Vec3(1,1,1),i=new r.Euler,s=new r.Quat;return()=>{if(!1===t.equals(this.position)&&(t.copy(this.position),this.isTransformDirty=!0),!1===e.equals(this.scale)&&(e.copy(this.scale),this.isTransformDirty=!0),!1===i.equals(this.rotation)&&(i.copy(this.rotation),this.quaternion.setFromEuler(this.rotation)),!1===s.equals(this.quaternion)&&(s.copy(this.quaternion),this.isTransformDirty=!0),this.isTransformDirty&&(this.isTransformDirty=!1,this.matrix.compose(this.quaternion,this.position,this.scale),this.isModelMatrixDirty=!0),this.isModelMatrixDirty){this.isModelMatrixDirty=!1,this.parent?this.parent.modelMatrix.multiply(this.matrix,this._modelMatrix):this._modelMatrix.copy(this.matrix);for(let t=0;t<this.children.length;t++)this.children[t].isModelMatrixDirty=!0;this.isInvertModelMatrixDirty=!0,this.isWorldPositionDirty=!0}return this._modelMatrix}})(),this.lookAt=(()=>{let t=new r.Vec3,e=new r.Mat4;return i=>(t.setFromMatrixPosition(this.modelMatrix),e.lookAt(t,i,this.up),this.rotation.setFromRotationMatrix(e),this)})()}get modelMatrix(){return this.updateModelMatrix()}get invertModelMatrix(){return this.updateInvertModelMatrix()}get worldPosition(){return this.isWorldPositionDirty&&(this.isWorldPositionDirty=!1,this._worldPosition.setFromMatrixPosition(this.modelMatrix)),this._worldPosition}add(t){return t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),this}remove(t){let e=this.children.indexOf(t);return-1!=e&&(t.parent=null,this.children.splice(e,1)),this}setParent(t){return t.add(this),this}update(t){this.updateModelMatrix();for(let e of this._components)e.start&&(e.start(),e.start=void 0),e.update(t);for(let e of this.children)e.update(t);return this}updateInvertModelMatrix(){return this.isInvertModelMatrixDirty&&(this.isInvertModelMatrixDirty=!1,this.modelMatrix.invert(this._invertModelMatrix)),this._invertModelMatrix}render(t){return this}getComponent(t){return this.findComponent(t)}addComponent(t){let e=this.findComponent(t);return void 0===e&&((e=new t).object=this,e.onLoad(),this._components.push(e)),e}removeComponent(t){let e=this._components.indexOf(t);return-1!=e&&this._components.splice(e,1),this}findComponent(t){for(let e=0,i=this._components.length;e<i;e++){let i=this._components[e];if(i instanceof t)return i}}raycast(t,e){return this}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.None=0]="None",t[t.Front=1]="Front",t[t.Back=2]="Back",t[t.Double=3]="Double"}(e.SideType||(e.SideType={})),function(t){t[t.None=0]="None",t[t.UnsignedByte=1]="UnsignedByte",t[t.Byte=2]="Byte",t[t.Short=3]="Short",t[t.UnsignedShort=4]="UnsignedShort",t[t.Int=5]="Int",t[t.UnsignedInt=6]="UnsignedInt",t[t.Float=7]="Float",t[t.HalfFloat=8]="HalfFloat",t[t.UnsignedShort4444=9]="UnsignedShort4444",t[t.UnsignedShort5551=10]="UnsignedShort5551",t[t.UnsignedShort565=11]="UnsignedShort565",t[t.UnsignedInt248=12]="UnsignedInt248"}(e.DataType||(e.DataType={})),function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.RGB=2]="RGB",t[t.RGBA=3]="RGBA",t[t.Luminance=4]="Luminance",t[t.LuminanceAlpha=5]="LuminanceAlpha",t[t.RGBE=3]="RGBE",t[t.Depth=4]="Depth",t[t.DepthStencil=5]="DepthStencil",t[t.Red=6]="Red"}(e.FormatType||(e.FormatType={})),function(t){t[t.None=0]="None",t[t.Repeat=1]="Repeat",t[t.ClampToEdge=2]="ClampToEdge",t[t.MirroredRepeat=3]="MirroredRepeat"}(e.WrappingType||(e.WrappingType={})),function(t){t[t.None=0]="None",t[t.Nearest=1]="Nearest",t[t.NearestMipMapNearest=2]="NearestMipMapNearest",t[t.NearestMipMapLinear=3]="NearestMipMapLinear",t[t.Linear=4]="Linear",t[t.LinearMipMapNearest=5]="LinearMipMapNearest",t[t.LinearMipMapLinear=6]="LinearMipMapLinear"}(e.FilterType||(e.FilterType={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(e.DrawMode||(e.DrawMode={}))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(2),s=i(13);let n=1;e.Material=class{constructor(t){this.id=n++,this.side=r.SideType.Front,this.programId=-1,this.passList=[],this.defines={NUM_DIR_LIGHTS:0},this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.vertexShader=t.vertexShader,this.fragmentShader=t.fragmentShader,this.side=t.side||this.side,this.addPass(new s.Pass({material:this}))}get pass(){return this.passList[0]}set pass(t){this.passList[0]=t}addPass(t){return this.passList.push(t),this}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});let{floor:r}=Math;class s{constructor(t,e,i){this.r=0,this.g=0,this.b=0,t instanceof s?this.copy(t):void 0!==t&&void 0!==e&&void 0!==i?this.setFromRGB(t,e,i):void 0!==t&&this.setFromHex(t)}set(t,e=t,i=t){return this.r=t,this.g=e,this.b=i,this}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}clone(){return(new s).copy(this)}scale(t,e=this){return e.r=this.r*t,e.g=this.g*t,e.b=this.b*t,e}equals(t){return this.r===t.r&&this.g===t.g&&this.b===t.b}setFromHex(t){return t=r(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this}setFromRGB(t,e,i){return this.r=t,this.g=e,this.b=i,this}toArray(t,e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}}e.Color=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(17),s=i(10),n=i(0);e.Geometry=class{constructor(){this.groups=[],this.faces=[],this.vertices=[]}set(t){return this.setBufferView("uv",t.uv,!1,2),this.setBufferView("position",t.position,!1,3),this.setBufferView("normal",t.normal,!1,3),this.setBufferView("color",t.color,!1,3),this.setBufferView("indice",t.indice,!0,1),this.setGroups(t.groups),this.computeVeticesFaces(),this}setBufferView(t,e,i,s){return void 0!==e&&(e instanceof r.BufferView?this[t]=e:e.length>0&&(this[t]=(new r.BufferView).set({data:e,isElement:i,stride:s}))),this}setGroups(t,e){if(this.groups.length=0,t)this.groups=t;else if(this.indice)this.groups.push((new s.Group).set({bv:this.indice,start:0,count:this.indice.count}));else{if(!this.position)throw Error("set groups fail");this.groups.push((new s.Group).set({bv:this.position,start:0,count:this.position.count}))}if(e){let t=this.groups[0];for(let i=0;i<e.length;i++){let r=this.groups[i];void 0===r&&(r=this.groups[i]=t.clone()),r.materialIndex=e[i]}}return this}computeVeticesFaces(){let{vertices:t,faces:e,groups:i,position:r,indice:s}=this;if(0===t.length){let e=r.values;for(let i=0;i<e.length;i+=3)t.push(new n.Vec3(e[i],e[i+1],e[i+2]))}if(0==e.length)for(let t of i)for(let i=t.start,r=t.start+t.count;i<r;i+=3)if(s){let t=s.values;e.push(new n.Face(t[i],t[i+1],t[i+2]))}else e.push(new n.Face(i,i+1,i+2));return this}computeBoundingSphere(){return void 0===this.boundingSphere&&(this.boundingSphere=new n.Sphere),this.boundingSphere.setFromPoints(this.vertices),this}computeBoundingBox(){return void 0===this.boundingBox&&(this.boundingBox=new n.Box3),this.boundingBox.setFromPoints(this.vertices),this}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(2),s=i(7),n=i(8);let o=1;e.Texture2D=class{constructor(t={}){this.id=o++,this.url=null,this.image=null,this.width=1,this.height=1,this.format=r.FormatType.RGBA,this.dataType=r.DataType.UnsignedByte,this.magFilter=r.FilterType.Linear,this.minFilter=r.FilterType.Linear,this.wrapS=r.WrappingType.ClampToEdge,this.wrapT=r.WrappingType.ClampToEdge,this.needUpdate=!1,this.url=t.url||this.url,this.width=t.width||this.width,this.height=t.height||this.width||this.height,this.format=t.format||s.getImageFormat(this.url)||this.format,this.dataType=t.dataType||this.dataType,this.magFilter=t.magFilter||this.magFilter,this.minFilter=t.minFilter||this.magFilter,this.wrapS=t.wrapS||this.wrapS,this.wrapT=t.wrapT||this.wrapS,this.url&&n.loadImage(this.url,t=>{this.image=t,this.needUpdate=!0})}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(2);e.dirname=function(t){for(let e=t.length;e>0;e--)if("/"===t[e])return t.substr(0,e+1);return t},e.getImageFormat=function(t){return t?t.search(/jpe?g/i)>0?r.FormatType.RGB:r.FormatType.RGBA:null},e.getWebglFormt=function(t,e){switch(e){case void 0:return;case r.FormatType.Alpha:return t.ALPHA;case r.FormatType.RGBA:return t.RGBA;case r.FormatType.RGB:return t.RGB;case r.FormatType.Depth:return t.DEPTH_COMPONENT;default:throw Error("invalid format: "+e)}},e.getWebglWrapping=function(t,e){switch(e){case void 0:return;case r.WrappingType.ClampToEdge:return t.CLAMP_TO_EDGE;case r.WrappingType.MirroredRepeat:return t.MIRRORED_REPEAT;case r.WrappingType.Repeat:return t.REPEAT;default:throw Error("invalid wrapping: "+e)}},e.getWebglFilter=function(t,e){switch(e){case void 0:return;case r.FilterType.Linear:return t.LINEAR;case r.FilterType.LinearMipMapLinear:return t.LINEAR_MIPMAP_LINEAR;case r.FilterType.LinearMipMapNearest:return t.LINEAR_MIPMAP_NEAREST;case r.FilterType.Nearest:return t.NEAREST;case r.FilterType.NearestMipMapLinear:return t.NEAREST_MIPMAP_LINEAR;case r.FilterType.NearestMipMapNearest:return t.NEAREST_MIPMAP_NEAREST;default:throw Error("invalid filter: "+e)}},e.getWebglDataType=function(t,e){switch(e){case void 0:return;case r.DataType.Byte:return t.BYTE;case r.DataType.Float:return t.FLOAT;case r.DataType.Int:return t.INT;case r.DataType.Short:return t.SHORT;case r.DataType.UnsignedByte:return t.UNSIGNED_BYTE;case r.DataType.UnsignedShort:return t.UNSIGNED_SHORT;default:throw Error("invalid datatype: "+e)}},e.getWebglDrawMode=function(t,e){switch(e){case void 0:return;case r.DrawMode.POINTS:return t.POINTS;case r.DrawMode.LINES:return t.LINES;case r.DrawMode.LINE_LOOP:return t.LINE_LOOP;case r.DrawMode.LINE_STRIP:return t.LINE_STRIP;case r.DrawMode.TRIANGLES:return t.TRIANGLES;case r.DrawMode.TRIANGLE_STRIP:return t.TRIANGLE_STRIP;case r.DrawMode.TRIANGLE_FAN:return t.TRIANGLE_FAN;default:throw Error("invalid drawMode: "+e)}}},function(t,e,i){"use strict";function r(t,e,i,r){let s=new XMLHttpRequest;return s.onreadystatechange=function(t){this.readyState===XMLHttpRequest.DONE&&200===this.status?i&&i(this.response):r&&r(this.status)},s.responseType=e,s.open("GET",t,!0),s.send(),s}Object.defineProperty(e,"__esModule",{value:!0}),e.loadBlob=function(t,e,i){return r(t,"arraybuffer",e,i)},e.loadText=function(t,e,i){return r(t,"text",e,i)},e.loadImage=function(t,e,i){let r=new Image;return r.onload=function(t){e&&e(r)},r.onerror=function(t){i&&i(t.toString())},r.crossOrigin="anonymous",r.src=t,r}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(1),s=i(0);e.Camera=class extends r.Object3D{constructor(){super(...arguments),this.type=r.ObjectType.Camera,this.projectionMatrix=new s.Mat4,this.unproject=(()=>{let t=new s.Mat4;return e=>e.transformMat4(this.projectionMatrix.invert(t)).transformMat4(this.modelMatrix)})()}get viewMatrix(){return this.invertModelMatrix}project(t){return t.transformMat4(this.invertModelMatrix).transformMat4(this.projectionMatrix)}updateProjectionMatrix(){return this}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class r{set(t){let{bv:e,start:i,count:r,materialIndex:s=0}=t;return this.bv=e,this.start=i,this.count=r,this.offset=i*e.bytesPer,this.materialIndex=s,this}copy(t){return this.bv=t.bv,this.start=t.start,this.count=t.count,this.offset=t.offset,this.materialIndex=t.materialIndex,this}clone(){return(new r).copy(this)}}e.Group=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(2),s=i(1),n=i(12),o=i(0);e.Mesh=class extends s.Object3D{constructor(t,e){super(),this.type=s.ObjectType.Mesh,this.drawMode=r.DrawMode.TRIANGLES,this.materials=[],this.castShadow=!1,this.receiveShadow=!1,this.raycast=(()=>{let t=new o.Sphere,e=new o.Ray,i=new o.Vec3,r=new o.Vec3,s=(t,e,i,s,n,o)=>null===e.intersectTriangle(i,s,n,!1,o)?null:(r.copy(o),r.transformMat4(this.modelMatrix),{distance:t.ray.origin.distance(r),point:r.clone(),object:this});return(r,n)=>{if(!1===this.visible)return this;if(void 0===this.geometry.boundingSphere&&this.geometry.computeBoundingSphere(),t.copy(this.geometry.boundingSphere),t.transformMat4(this.modelMatrix),!1===r.ray.intersectSphereTest(t))return this;e.copy(r.ray).transformMat4(this.invertModelMatrix);let o,a,h,l,{vertices:u,faces:c}=this.geometry;for(let t of c)o=u[t.a],a=u[t.b],h=u[t.c],null!==(l=s(r,e,o,a,h,i))&&n.push(l);return this}})(),this.geometry=t,Array.isArray(e)?this.materials=e:this.material=e||new n.PhongMaterial}get material(){return this.materials[0]}set material(t){this.materials[0]=t}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(3),s=i(6),n=i(4);let o="\nvarying vec3 vNormal;\nvarying vec3 vViewDir;\n\n#ifdef USE_MAP\nvarying vec2 vUv;\n#endif\n\n#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif\n\n#if NUM_DIR_LIGHTS > 0\nuniform mat4 directionalShadowMatrix[NUM_DIR_LIGHTS];\nvarying vec4 vDirectionalShadowCoord[NUM_DIR_LIGHTS];\n#endif\n\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n    vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n\n    vViewDir = cameraPosition - worldPosition.xyz;\n    vNormal = mat3(modelMatrix) * normal;\n\n#ifdef USE_MAP\n    vUv = uv;\n#endif\n\n#ifdef USE_COLOR\n    vColor = color;\n#endif\n\n#if NUM_DIR_LIGHTS > 0\n    #pragma unroll_loop\n    for (int i = 0; i < NUM_DIR_LIGHTS; i++) {\n        vDirectionalShadowCoord[i] = directionalShadowMatrix[i] * worldPosition;\n    }\n#endif\n}\n",a="\n#define saturate(a) clamp(a, 0.0, 1.0)\n#define PI 3.14159265359\n#define RECIPROCAL_PI 0.31830988618\n\nuniform float opacity;\nuniform float shininess;\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform vec3 ambient;\n\nvarying vec3 vNormal;\nvarying vec3 vViewDir;\n\nstruct DirectionalLight {\n    vec3 color;\n    vec3 direction;\n};\n\nstruct ReflectedLight {\n    vec3 diffuse;\n    vec3 specular;\n};\n\n#ifdef USE_MAP\nuniform sampler2D map;\nvarying vec2 vUv;\n#endif\n\n#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif\n\n#if NUM_DIR_LIGHTS > 0\nuniform DirectionalLight directionalLights[NUM_DIR_LIGHTS];\nuniform sampler2D directionalShadowMap[NUM_DIR_LIGHTS];\nvarying vec4 vDirectionalShadowCoord[NUM_DIR_LIGHTS];\n#endif\n\n#ifdef USE_SHADOWMAP\nfloat getShadow(sampler2D shadowMap, vec4 shadowCoord) {\n    float shadow = 1.0;\n    if (shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0 && shadowCoord.z <= 1.0) {\n        float depth = 1.0 - texture2D(shadowMap, shadowCoord.xy).r;\n        shadow = shadowCoord.z - 0.005 > depth ? 0.0: 1.0;\n    }\n    return shadow;\n}\n#endif\n\nvec3 F_Schlick(in vec3 specularColor, in float dotLH ) {\n\t// Original approximation by Christophe Schlick '94\n\t// float fresnel = pow( 1.0 - dotLH, 5.0 );\n\n\t// Optimized variant (presented by Epic at SIGGRAPH '13)\n\t// https://cdn2.unrealengine.com/Resources/files/2013SiggraphPresentationsNotes-26915738.pdf\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\n\nfloat G_BlinnPhong_Implicit() {\n    //(n dot l)(n dot v) / 4(n dot l)(n dot v) //分子是G_Implicit，分母是brdf的分母项，这里非常数项抵消了\n    return 0.25;\n}\n\n// http://www.cs.uu.nl/docs/vakken/magr/2016-2017/slides/lecture%2013%20-%20BRDFs.pdf\nfloat D_BlinnPhong(in float shininess, in float dotNH) {\n    // (shininess + 2) / (2 * PI) * pow(cos(N,H), shininess)\n    return RECIPROCAL_PI * (shininess * 0.5 + 1.0)  * pow(dotNH, shininess);\n}\n\nvec3 BRDF_Specular_BlinnPhong(in vec3 specularColor, in float shininess, in vec3 lightDir, in vec3 viewDir, in vec3 normal) {\n    vec3 halfDir = normalize(lightDir + viewDir);\n    float dotNH = saturate(dot(normal, halfDir));\n    float dotLH = saturate(dot(lightDir, halfDir));\n    // DFG / 4(n dot l)(n dot v), 分母在G项中抵消了\n    return D_BlinnPhong(shininess, dotNH) * F_Schlick(specularColor, dotLH) * G_BlinnPhong_Implicit();\n}\n\nvec3 BRDF_Diffuse_Lambert(in vec3 diffuseColor) {\n    return RECIPROCAL_PI * diffuseColor;\n}\n\n// source: https://www.cs.utah.edu/~reinhard/cdrom/\nvec3 ReinhardToneMapping(vec3 color) {\n    // color *= toneMappingExposure;\n    return saturate(color / (vec3(1.0) + color));\n}\n\nvoid main() {\n    vec3 normal = normalize(vNormal);\n    vec3 viewDir = normalize(vViewDir);\n    ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0));\n    vec4 diffuseColor = vec4(diffuse, opacity);\n\n#ifdef USE_MAP\n    diffuseColor *= texture2D(map, vUv);\n#endif\n\n#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif\n\n#if NUM_DIR_LIGHTS > 0\n    DirectionalLight directionalLight;\n    #pragma unroll_loop\n    for (int i = 0; i < NUM_DIR_LIGHTS; i++) {\n        directionalLight = directionalLights[i];\n\n        float dotNL = saturate(dot(normal, directionalLight.direction));\n        vec3 irradiance = dotNL * directionalLight.color;\n\n        #ifndef PHYSICALLY_CORRECT_LIGHTS\n        irradiance *= PI; //精准光源，不需要积分，不需要除以PI配平，所以这里乘以PI用来消除BRDF中的1/PI\n        #endif\n\n        #ifdef USE_SHADOWMAP\n        irradiance *= getShadow(directionalShadowMap[i], vDirectionalShadowCoord[i]);\n        #endif\n\n        reflectedLight.diffuse += irradiance * BRDF_Diffuse_Lambert(diffuseColor.rgb);\n        reflectedLight.specular += irradiance * BRDF_Specular_BlinnPhong(specular, shininess, directionalLight.direction, viewDir, normal);\n    }\n#endif\n\n    vec3 ambientColor = ambient * BRDF_Diffuse_Lambert(diffuseColor.rgb);\n\n    #ifndef PHYSICALLY_CORRECT_LIGHTS\n    ambientColor *= PI;\n    #endif\n    \n    vec3 outgoingLight = reflectedLight.diffuse + reflectedLight.specular + ambientColor + emissive;\n    gl_FragColor = vec4(outgoingLight, diffuseColor.a);\n}\n";e.PhongMaterial=class extends r.Material{constructor(t={}){super({vertexShader:o,fragmentShader:a}),this.opacity=1,this.shininess=32,this.diffuse=new n.Color(16777215),this.emissive=new n.Color(0),this.specular=new n.Color(1118481),this.name=t.name,this.map=t.url instanceof s.Texture2D?t.url:t.url?new s.Texture2D({url:t.url}):null,this.opacity=t.opacity||this.opacity,this.shininess=t.shininess||this.shininess,this.diffuse=t.diffuse||this.diffuse,this.emissive=t.emissive||this.emissive,this.specular=t.specular||this.specular}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(3),s=i(2);e.Pass=class{constructor(t){this.enabled=!0,this.material=t.material||new r.Material({vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,side:s.SideType.Double}),this.setUniforms(t.uniforms),this.renderTarget=t.renderTarget,this.beforeRender=t.beforeRender||this.beforeRender,this.afterRender=t.afterRender||this.afterRender}setUniforms(t){return t&&Object.defineProperties(this.material,t),this}addTo(t){return t.addPass(this),this}setUniform(t,e){return this.material[t]=e,this}beforeRender(t,e){}afterRender(t,e){}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(6);e.RenderTarget=class{constructor(t){this.texture=new r.Texture2D(t)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(9),s=i(1);e.OrthoCamera=class extends r.Camera{constructor(t,e,i,r,n,o){super(),this.type=s.ObjectType.OrthoCamera,this.left=-1,this.right=1,this.top=1,this.bottom=-1,this.near=0,this.far=2e3,this.left=t||this.left,this.right=e||this.right,this.top=i||this.top,this.bottom=r||this.bottom,this.near=n||this.near,this.far=o||this.far,this.updateProjectionMatrix()}updateProjectionMatrix(){return this.projectionMatrix.ortho(this.left,this.right,this.bottom,this.top,this.near,this.far),this}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.Component=class{constructor(){this.object=null}onLoad(){}start(){}update(t){}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class r{constructor(){this.byteStride=0,this.byteOffset=0,this.bytesPer=0,this.count=0,this.isElement=!1}set(t){let{data:e,isElement:i,stride:r=0,offset:s=0}=t;return this.values=e.slice(),this.count=r>0?e.length/r:e.length,this.isElement=i,this.bytesPer=i?Uint16Array.BYTES_PER_ELEMENT:Float32Array.BYTES_PER_ELEMENT,this.byteStride=r?r*this.bytesPer:this.byteStride,this.byteOffset=s?s*this.bytesPer:this.byteOffset,this}copy(t){return this.byteStride=t.byteStride,this.byteOffset=t.byteOffset,this.bytesPer=t.bytesPer,this.isElement=t.isElement,this.values=t.values,this.count=t.count,this}clone(){return(new r).copy(this)}}e.BufferView=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.Clock=class{constructor(){this.diffTime=0,this.nowTime=0,this.oldTime=0}getDelta(){return this.nowTime=Date.now(),0===this.oldTime?this.oldTime=this.nowTime:(this.diffTime=this.nowTime-this.oldTime,this.oldTime=this.nowTime),.001*this.diffTime}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(1),s=i(20),n=i(26),o=i(40);e.Scene=class extends r.Object3D{start(t){return t.addEventListener("mousedown",t=>this.dispatch("MouseDown",t),!1),t.addEventListener("mouseup",t=>this.dispatch("MouseUp",t),!1),t.addEventListener("mousemove",t=>this.dispatch("MouseMove",t),!1),t.addEventListener("mousewheel",t=>this.dispatch("MouseWheel",t),!1),t.addEventListener("touchstart",t=>this.dispatch("TouchStart",t),!1),t.addEventListener("touchend",t=>this.dispatch("TouchEnd",t),!1),t.addEventListener("touchmove",t=>this.dispatch("TouchMove",t),!1),this}dispatch(t,e){return e.preventDefault(),this.emit(t,{broadcost:!0,data:e}),this}setBackground(t){t?(this.backgournd=s.MeshBuilder.Box(),this.backgournd.material=new n.CubeMaterial({urls:t})):this.backgournd=null}beforeRender(t){return t.backgournd=this.backgournd,this}afterRender(t){return void 0===this.monitor&&(this.monitor=new o.Monitor),this.monitor.update(t),this}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(21),s=i(22),n=i(23),o=i(11),a=i(24);e.MeshBuilder=class{static Sphere(t=1,e=10){let i=new o.Mesh(new r.SphereGeometry(e));return i.scale.set(t),i}static Box(t=1,e=t,i=t){let r=new o.Mesh(new n.CubeGeometry);return r.scale.set(t,e,i),r}static Plane(t=1,e=t,i=1,r=1){let n=new o.Mesh(new s.PlaneGeometry(i,r));return n.scale.set(t,e),n}static Model(t,e,i){if(t.url.endsWith(".obj"))return a.OBJLoader.load(t,e,i);throw Error("not support now: "+t.url)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(5),s=i(0);e.SphereGeometry=class extends r.Geometry{constructor(t=10){super();let e,i,r,n=[],o=[],a=[],h=[],l=new s.Vec3,u=new s.Vec3,c=!1,d=[],p={},f=[];function m(t){let e=JSON.stringify(t);return void 0===p[e]&&(p[e]=f.length,f.push(t)),p[e]}function g(t,e=1){return t*e+(t-t*t)/2}function x(t,e,i){return c?n.push(t,e,i):n.push(t,i,e)}for(let s=0;s<8;s++){u.set(2*(1&s)-1,(2&s)-1,(4&s)/2-1),c=u.x*u.y*u.z>0,d.length=0;for(let s=0;s<=t;s++){for(let n=0;s+n<=t;n++)e=s/t,i=n/t,r=(t-s-n)/t,d.push(m({vertex:l.set(g(e),g(i),g(r)).normalize().multiply(u).toArray([]),uv:u.y>0?[1-e,r]:[r,1-e]}));if(s>0)for(let r=0;s+r<=t;r++)e=g(s-1,t+1)+r,i=g(s,t+1)+r,x(d[e],d[e+1],d[i]),s+r<t&&x(d[i],d[e+1],d[i+1])}}for(let t of f)o.push(...t.vertex),a.push(...t.vertex),h.push(...t.uv);this.set({uv:h,position:o,normal:a,indice:n})}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(5);e.PlaneGeometry=class extends r.Geometry{constructor(t=1,e=t){super();let i=[],r=[],s=[],n=[];for(let o=0;o<=e;o++){let a=o/e;for(let h=0;h<=t;h++){let l=h/t;if(r.push(2*l-1,2*a-1,0),s.push(0,0,1),n.push(l,a),h<t&&o<e){let e=h+o*(t+1);i.push(e,e+1,e+t+1),i.push(e+t+1,e+1,e+t+2)}}}this.set({uv:n,position:r,normal:s,indice:i})}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(5);let s=[[0,4,2,6,-1,0,0],[1,3,5,7,1,0,0],[0,1,4,5,0,-1,0],[2,6,3,7,0,1,0],[0,2,1,3,0,0,-1],[4,5,6,7,0,0,1]];e.CubeGeometry=class extends r.Geometry{constructor(){super();let t=[],e=[],i=[],r=[];for(let n=0;n<s.length;n++){let o=s[n],a=4*n;for(let t=0;t<4;t++){let s=o[t];e.push(2*(1&s)-1,(2&s)-1,(4&s)/2-1),i.push(o[4],o[5],o[6]),r.push(1&t,(2&t)/2)}t.push(a,a+1,a+2),t.push(a+2,a+1,a+3)}this.set({uv:r,position:e,normal:i,indice:t})}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(1),s=i(7),n=i(10),o=i(11),a=i(8),h=i(25),l=i(5);class u{constructor(t=-1){this.vertices=[],this.colors=[],this.normals=[],this.uvs=[],this.groups=[],this.faceType=-1,this.mtllist=[],this.faceType=t}reset(){return this.vertices.length=0,this.colors.length=0,this.normals.length=0,this.uvs.length=0,this.faceType=-1,this}addGroup(){return this.groups.push(this.vertices.length/3),this}getMesh(t){let e=(new l.Geometry).set({position:this.vertices,color:this.colors,normal:this.normals,uv:this.uvs});this.addGroup();let i=[];for(let r=0;r+1<this.groups.length;r++){let s=t.findIndex(t=>t.name===this.mtllist[r]);i.push((new n.Group).set({bv:e.position,start:this.groups[r],count:this.groups[r+1]-this.groups[r],materialIndex:s}))}return e.setGroups(i),new o.Mesh(e,t)}}e.OBJLoader=new class{constructor(){this.rootPath=null,this.buffer=new u,this.output=new u,this.outputList=[],this.mtllib=""}load(t,e,i){return this.buffer.reset(),this.output.reset(),this.outputList.length=0,this.mtllib="",this.rootPath=this.rootPath||s.dirname(t.url),a.loadText(t.url,s=>{let n,o="",a=new Array(128),l=0,u=0,c=s.length;for(let t=0;t<c;t++)switch(n=s[t]){case" ":o.length>0&&(a[l++]=o),o="";break;case"/":o.length>0&&(a[l++]=o),o="",u++;break;case"\n":o.length>0&&(a[l++]=o),o="",this.processLine(a,l,u),l=0,u=0;break;case"\r":break;default:o+=n}h.MTLLoader.load({url:this.mtllib,materials:t.materials},t=>{let i=new r.Object3D;for(let e of this.outputList)i.add(e.getMesh(t));e&&e(i)},i)},i),this}processLine(t,e,i){if(0!==e)switch(t[0]){case"v":this.buffer.vertices.push(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3])),e>4&&this.buffer.colors.push(parseFloat(t[4]),parseFloat(t[5]),parseFloat(t[6]));break;case"vt":this.buffer.uvs.push(parseFloat(t[1]),parseFloat(t[2]));break;case"vn":this.buffer.normals.push(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3]));break;case"f":let r=e-1;if(0===i){this.checkFaceType(0);for(let i=2;i+1<e;i++)this.buildFace(t[1]),this.buildFace(t[i]),this.buildFace(t[i+1])}else if(r===2*i){this.checkFaceType(1);for(let i=3;i+3<e;i+=2)this.buildFace(t[1],t[2]),this.buildFace(t[i],t[i+1]),this.buildFace(t[i+2],t[i+3])}else if(2*r==3*i){this.checkFaceType(2);for(let i=4;i+5<e;i+=3)this.buildFace(t[1],t[2],t[3]),this.buildFace(t[i],t[i+1],t[i+2]),this.buildFace(t[i+3],t[i+4],t[i+5])}else{this.checkFaceType(3);for(let i=3;i+3<e;i+=2)this.buildFace(t[1],null,t[2]),this.buildFace(t[i],null,t[i+1]),this.buildFace(t[i+2],null,t[i+3])}break;case"l":case"p":case"s":case"g":case"o":break;case"mtllib":this.mtllib=this.rootPath+t[1];break;case"usemtl":this.output.addGroup(),this.output.mtllist.push(t[1])}}checkFaceType(t){-1===this.output.faceType?(this.output.faceType=t,this.outputList.push(this.output)):this.output.faceType!==t&&(this.output=new u(t),this.outputList.push(this.output))}buildFace(t,e,i){let r=parseInt(t),s=3*(r>0?r-1:r+this.buffer.vertices.length/3),n=this.buffer.colors.length>0?s:null,o=this.buffer.vertices;if(this.output.vertices.push(o[s++],o[s++],o[s]),null!==n){let t=this.buffer.colors;this.output.colors.push(t[n++],t[n++],t[n])}if(e){let t=parseInt(e),i=2*(t>0?t-1:t+this.buffer.uvs.length/2),r=this.buffer.uvs;this.output.uvs.push(r[i++],r[i])}if(i){let t=parseInt(i),e=3*(t>0?t-1:t+this.buffer.normals.length/3),r=this.buffer.normals;this.output.normals.push(r[e++],r[e++],r[e])}}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(8),s=i(7),n=i(4),o=i(12),a=i(39),h=i(6),l=i(2);class u{constructor(){this.shininess=0,this.emissive=new n.Color,this.diffuse=new n.Color,this.specular=new n.Color}reset(){return this.url=null,this.name=null,this.shininess=0,this.emissive.set(0),this.diffuse.set(0),this.specular.set(0),this}}e.MTLLoader=new class{constructor(){this.rootPath=null,this.output=new u,this.outputList=[]}load(t,e,i){return this.output.reset(),this.outputList.length=0,this.rootPath=this.rootPath||s.dirname(t.url),r.loadText(t.url,i=>{let r,s="",n=new Array(128),u=0,c=i.length;for(let t=0;t<c;t++)switch(r=i[t]){case" ":s.length>0&&(n[u++]=s),s="";break;case"\n":s.length>0&&(n[u++]=s),s="",this.processLine(n,u),u=0;break;case"\r":break;default:s+=r}let d=[];for(let e=0;e<this.outputList.length;e++){let i=this.outputList[e];switch(i.url&&(i.url=new h.Texture2D({url:i.url,wrapS:l.WrappingType.Repeat})),i.urlBump&&(i.urlBump=new h.Texture2D({url:i.urlBump,wrapS:l.WrappingType.Repeat})),t.materials&&t.materials[e]){case"skin":d.push(new a.SkinMaterial(i));break;default:d.push(new o.PhongMaterial(i))}}e&&e(d)},i),this}processLine(t,e){if(0!==e)switch(t[0].toLowerCase()){case"newmtl":this.output=new u,this.output.name=t[1],this.outputList.push(this.output);break;case"ns":this.output.shininess=parseFloat(t[1]);break;case"ka":this.output.emissive.set(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3]));break;case"kd":this.output.diffuse.set(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3]));break;case"ks":this.output.specular.set(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3]));break;case"map_kd":this.output.url=this.rootPath+t[1];break;case"map_bump":this.output.urlBump=this.rootPath+t[1]}}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(3),s=i(27),n=i(2);let o="\nvarying vec3 vWorldDirection;\n\nvoid main() {\n    vWorldDirection = normalize(position);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    gl_Position.z = gl_Position.w; //令 z/w = 1.0, 这样可以欺骗深度测试认为天空盒的深度为最大深度1.0，用于通过深度测试，将天空盒放最后渲染，可以得到轻微的性能提升，避免覆盖渲染。\n}\n",a="\nuniform samplerCube map;\nvarying vec3 vWorldDirection;\n\nvoid main() {\n    gl_FragColor = textureCube(map, vWorldDirection);\n}\n";e.CubeMaterial=class extends r.Material{constructor(t={}){super({vertexShader:o,fragmentShader:a}),this.side=n.SideType.Back,this.map=t.urls instanceof s.TextureCube?t.urls:t.urls?new s.TextureCube({urls:t.urls}):null}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(2),s=i(7),n=i(8);let o=1e4;e.TextureCube=class{constructor(t={}){this.id=o++,this.urls=[],this.formats=[],this.width=1,this.height=1,this.dataType=r.DataType.UnsignedByte,this.magFilter=r.FilterType.Linear,this.minFilter=r.FilterType.Linear,this.wrapS=r.WrappingType.ClampToEdge,this.wrapT=r.WrappingType.ClampToEdge,this.images=[],this.needUpdate=!1,this.urls=t.urls||this.urls,this.width=t.width||this.width,this.height=t.height||this.height,this.dataType=t.dataType||this.dataType,this.magFilter=t.magFilter||this.magFilter,this.minFilter=t.minFilter||this.magFilter,this.wrapS=t.wrapS||this.wrapS,this.wrapT=t.wrapT||this.wrapS;for(let e=0;e<this.urls.length;e++){let i=this.urls[e];this.formats[e]=t.formats&&t.formats[e]||s.getImageFormat(i),n.loadImage(i,t=>{this.images[e]=t,this.needUpdate=e+1>=this.urls.length})}}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});let r=[],s=new Float32Array(16);function n(t,e){let i=t.length,s=i*e,n=r[s];void 0===n&&(n=r[s]=new Float32Array(s));for(let r=0,s=0;r<i;++r,s+=e)t[r].toArray(n,s);return n}function o(t,e){let i=e,s=r[i];return void 0===s&&(s=r[i]=new Float32Array(i)),t.toArray(s),s}class a{constructor(t,e,i,r){this.id=t,this.addr=e,this.info=i,this.program=r}setValue(t,e,i){if(null==i)return this;const{info:r,addr:n,program:a}=this;switch(r.type){case t.INT:t.uniform1i(n,i);break;case t.FLOAT:t.uniform1f(n,i);break;case t.FLOAT_VEC2:t.uniform2fv(n,o(i,2));break;case t.FLOAT_VEC3:t.uniform3fv(n,o(i,3));break;case t.FLOAT_MAT4:s.set(i.elements),t.uniformMatrix4fv(n,!1,s);break;case t.SAMPLER_2D:{let r=a.getTextureUnit(i.id);t.activeTexture(t.TEXTURE0+r);let s=e.properties.get(i);void 0===s.webgltexture&&(s.webgltexture=t.createTexture(),e.setTexture2D(s.webgltexture,i)),e.updateTexture2D(s.webgltexture,i),t.bindTexture(t.TEXTURE_2D,s.webgltexture),t.uniform1i(n,r);break}case t.SAMPLER_CUBE:{let r=a.getTextureUnit(i.id);t.activeTexture(t.TEXTURE0+r);let s=e.properties.get(i);void 0===s.webgltexture&&(s.webgltexture=t.createTexture(),e.setTextureCube(s.webgltexture,i)),e.updateTextureCube(s.webgltexture,i),t.bindTexture(t.TEXTURE_CUBE_MAP,s.webgltexture),t.uniform1i(n,r);break}default:throw Error("uniform type invalid "+r.type)}return this}}class h extends a{setValue(t,e,i){if(null==i)return this;const{info:r,addr:s,program:o}=this;switch(r.type){case t.INT:t.uniform1iv(s,i);break;case t.FLOAT:t.uniform1fv(s,i);break;case t.FLOAT_VEC2:t.uniform2fv(s,n(i,2));break;case t.FLOAT_VEC3:t.uniform3fv(s,n(i,3));break;case t.FLOAT_MAT4:t.uniformMatrix4fv(s,!1,n(i,16));break;case t.SAMPLER_2D:for(let r of i){let i=o.getTextureUnit(r.id);t.activeTexture(t.TEXTURE0+i);let n=e.properties.get(r);void 0===n.webgltexture&&(n.webgltexture=t.createTexture(),e.setTexture2D(n.webgltexture,r)),e.updateTexture2D(n.webgltexture,r),t.bindTexture(t.TEXTURE_2D,n.webgltexture),t.uniform1i(s,i)}break;case t.SAMPLER_CUBE:for(let r of i){let i=o.getTextureUnit(r.id);t.activeTexture(t.TEXTURE0+i);let n=e.properties.get(r);void 0===n.webgltexture&&(n.webgltexture=t.createTexture(),e.setTextureCube(n.webgltexture,r)),e.updateTextureCube(n.webgltexture,r),t.bindTexture(t.TEXTURE_CUBE_MAP,n.webgltexture),t.uniform1i(s,i)}break;default:throw Error("ArrayUniform.setValue: invalid type "+r.type)}return this}}class l{constructor(t,e,i){this.id=t,this.addr=e,this.info=i}setValue(t,e,i){if(null==i)return this;const{byteStride:r,byteOffset:s}=i,{info:n,addr:o}=this;let a=e.properties.get(i);switch(void 0===a.webglbuffer&&(a.webglbuffer=t.createBuffer(),e.setBufferView(a.webglbuffer,i)),t.bindBuffer(t.ARRAY_BUFFER,a.webglbuffer),n.type){case t.INT:t.vertexAttribPointer(o,1,t.INT,!1,r,s);break;case t.INT_VEC2:t.vertexAttribPointer(o,2,t.INT,!1,r,s);break;case t.INT_VEC3:t.vertexAttribPointer(o,3,t.INT,!1,r,s);break;case t.INT_VEC4:t.vertexAttribPointer(o,4,t.INT,!1,r,s);break;case t.FLOAT:t.vertexAttribPointer(o,1,t.FLOAT,!1,r,s);break;case t.FLOAT_VEC2:t.vertexAttribPointer(o,2,t.FLOAT,!1,r,s);break;case t.FLOAT_VEC3:t.vertexAttribPointer(o,3,t.FLOAT,!1,r,s);break;case t.FLOAT_VEC4:t.vertexAttribPointer(o,4,t.FLOAT,!1,r,s);break;case t.FLOAT_MAT2:t.vertexAttribPointer(o,2,t.FLOAT,!1,r,s);break;case t.FLOAT_MAT3:t.vertexAttribPointer(o,3,t.FLOAT,!1,r,s);break;case t.FLOAT_MAT4:t.vertexAttribPointer(o,4,t.FLOAT,!1,r,s);break;default:throw Error("attribute type invalid "+n.type)}return t.enableVertexAttribArray(o),this}}class u{constructor(t){this.seq=[],this.map={},this.id=t}add(t){return this.seq.push(t),this.map[t.id]=t,this}setValue(t,e,i){if(null==i)return this;for(let r of this.seq)r.setValue(t,e,i[r.id]);return this}}function c(t,e){let{map:i,seq:r}=t,s=i[e];return void 0===s&&(s=i[e]=new u(e),r.push(s)),s}let d=/(\w+)(\[\d+\])?(\.\w+)?/;function p(t,e,i){let r=e.name.match(d),s=r[1],n=r[2],o=r[3];if(s)if(o){let r=c(t.uniforms,s);void 0!==n&&(r=c(r,n.substr(1,n.length-2))),r.add(new a(o.substr(1),i,e,t))}else void 0!==n?t.uniforms.add(new h(s,i,e,t)):t.uniforms.add(new a(s,i,e,t));return t.uniforms}e.Program=class{constructor(t,e,i){function r(e,i,r="shader"){let s=t.createShader(e);if(t.shaderSource(s,i),t.compileShader(s),!t.getShaderParameter(s,t.COMPILE_STATUS))throw Error(`${r}: \n`+t.getShaderInfoLog(s));return s}this.attributes=new u("attributes"),this.uniforms=new u("uniforms"),this.textureUnits={},this.textureUnit=0;let s=r(t.VERTEX_SHADER,e,"vertex shader"),n=r(t.FRAGMENT_SHADER,i,"fragment shader"),o=t.createProgram();if(t.attachShader(o,s),t.attachShader(o,n),t.linkProgram(o),!t.getProgramParameter(o,t.LINK_STATUS))throw Error("shader program: \n"+t.getProgramInfoLog(o));t.deleteShader(s),t.deleteShader(n);let a=t.getProgramParameter(o,t.ACTIVE_UNIFORMS);for(let e=0;e<a;e++){let i=t.getActiveUniform(o,e);p(this,i,t.getUniformLocation(o,i.name))}let h=t.getProgramParameter(o,t.ACTIVE_ATTRIBUTES);for(let e=0;e<h;e++){let i=t.getActiveAttrib(o,e),r=t.getAttribLocation(o,i.name);this.attributes.add(new l(i.name,r,i))}this.webglprogram=o}getTextureUnit(t){let e=this.textureUnits[t];if(void 0===e&&(e=this.textureUnits[t]=this.textureUnit++)>16)throw Error("texture unit larger than support");return e}use(t){return t.useProgram(this.webglprogram),this}setUniform(t,e,i,r){let s=this.uniforms.map[i];return s&&s.setValue(t,e,r),this}setAttribute(t,e,i,r){let s=this.attributes.map[i];return s&&s.setValue(t,e,r),this}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(30);e.ShadowMap=class{render(t){let e=t.shadowLights;if(0===e.length)return this;t.save();for(let i of e)t.setRenderTarget(i.shadow.renderTarget),this.renderObjects(i,t);return t.restore(),this}renderObjects(t,e){let i=t.shadow,s=i.matrix,n=i.camera;if(void 0===n)return console.error("ShadowMap.renderLight",t,"dont`t has camera"),this;n.position.copy(t.worldPosition),n.lookAt(t.target.worldPosition),s.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),s.multiply(n.projectionMatrix),s.multiply(n.viewMatrix),void 0===this.depthMaterial&&(this.depthMaterial=new r.DepthMaterial);for(let t of e.renderList)e.renderDepth(t,n,this.depthMaterial);return this}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(3);let s="\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n",n="\nvoid main() {\n    gl_FragColor = vec4(vec3(1.0 - gl_FragCoord.z), 1.0); // gl_FragCoord.z的坐标范围是[0, 1]，这里用1.0减去z的原因是，纹理默认是值是0，\n}\n";e.DepthMaterial=class extends r.Material{constructor(){super({vertexShader:s,fragmentShader:n})}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ShaderChunk={}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(0);e.Shadow=class{constructor(){this.mapSize=new r.Vec2(512,512),this.matrix=new r.Mat4}onInit(t){}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(1),s=i(32),n=i(4),o=i(0),a=i(14);e.Light=class extends r.Object3D{constructor(t,e){super(),this.type=r.ObjectType.Light,this.color=new n.Color(1,1,1),this.intensity=1,this.shadow=new s.Shadow,this.castShadow=!1,this.target=new r.Object3D,this._direction=new o.Vec3,this.color=new n.Color(t||this.color),this.intensity=e||this.intensity}get direction(){return this.worldPosition.sub(this.target.worldPosition,this._direction),this._direction.normalize()}update(t){return this.castShadow&&void 0===this.shadow.renderTarget&&(this.shadow.renderTarget=new a.RenderTarget({width:this.shadow.mapSize.x,height:this.shadow.mapSize.y}),this.shadow.onInit(this.shadow.renderTarget)),super.update(t),this}}},function(t,e,i){"use strict";function r(t){for(var i in t)e.hasOwnProperty(i)||(e[i]=t[i])}Object.defineProperty(e,"__esModule",{value:!0}),r(i(9)),r(i(15)),r(i(36)),r(i(16)),r(i(37)),r(i(0)),r(i(17)),r(i(18)),r(i(4)),r(i(10)),r(i(38)),r(i(2)),r(i(0)),r(i(11)),r(i(1)),r(i(13)),r(i(28)),r(i(41)),r(i(42)),r(i(14)),r(i(19)),r(i(32)),r(i(29)),r(i(6)),r(i(27)),r(i(5)),r(i(22)),r(i(23)),r(i(21)),r(i(33)),r(i(45)),r(i(8)),r(i(25)),r(i(24)),r(i(3)),r(i(26)),r(i(30)),r(i(12)),r(i(46)),r(i(20)),r(i(31))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.Event=class{constructor(){this.children=[],this.listeners={}}on(t,e){let i=this.listeners[t];return void 0===i&&(i=this.listeners[t]=[]),-1===i.indexOf(e)&&i.push(e),this}off(t,e){let i=this.listeners[t];if(void 0!==i){if(e){let t=i.indexOf(e);-1!==t&&i.splice(t,1)}else delete this.listeners[t];return this}}emit(t,e){let i=this.listeners[t];if(i)for(let t of i)t(e.data);if(e.bubble&&this.parent&&this.parent.emit(t,e),e.broadcost&&this.children)for(let i of this.children)i.emit(t,e);return this}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(9),s=i(1),n=i(0);e.PerspectiveCamera=class extends r.Camera{constructor(t,e,i,r){super(),this.type=s.ObjectType.PerspectiveCamera,this.fov=50,this.aspect=1,this.near=.1,this.far=1e3,this.fov=t||this.fov,this.aspect=e||this.aspect,this.near=i||this.near,this.far=r||this.far,this.updateProjectionMatrix()}updateProjectionMatrix(){return this.projectionMatrix.perspective(n.degToRad(this.fov),this.aspect,this.near,this.far),this}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(16),s=i(0),n=i(1);let{pow:o,tan:a,max:h,min:l,abs:u,PI:c}=Math;e.OrbitControl=class extends r.Component{constructor(){super(...arguments),this.target=new s.Vec3,this.zoomSpeed=1,this.dampScale=.8,this.enableDamping=!0,this.mode=0,this.isDragDirty=!1,this.isPanDirty=!1,this.offsetStart=new s.Vec2,this.offsetEnd=new s.Vec2,this.offsetDelta=new s.Vec2,this.spherical=new s.Spherical,this.dollyScale=1,this.update=(()=>{let t=new s.Vec3;return()=>{if(this.isDragDirty&&(this.isDragDirty=u(this.offsetDelta.x)>.001,this.object.position.sub(this.target,t),this.spherical.setFromVec3(t),this.spherical.theta-=s.degToRad(.5*this.offsetDelta.x),this.spherical.phi-=s.degToRad(.5*this.offsetDelta.y),this.spherical.phi=h(1e-5,l(c-1e-5,this.spherical.phi)),this.spherical.radius*=this.dollyScale,t.setFromSpherical(this.spherical),this.target.add(t,this.object.position),this.object.lookAt(this.target),this.dollyScale=1,this.enableDamping?this.offsetDelta.scale(this.dampScale):this.offsetDelta.set(0)),this.isPanDirty){if(this.isPanDirty=u(this.offsetDelta.x)>.001,this.object.position.sub(this.target,t),this.object.type===n.ObjectType.PerspectiveCamera){let e=2*t.length()*a(s.degToRad(.5*this.object.fov));this.pan(-this.offsetDelta.x*e/800,0),this.pan(this.offsetDelta.y*e/800,1)}else this.object.type===n.ObjectType.OrthoCamera&&(this.pan(-this.offsetDelta.x/(this.object.right-this.object.left),0),this.pan(this.offsetDelta.y/(this.object.top-this.object.bottom),1));this.target.add(t,this.object.position),this.enableDamping?this.offsetDelta.scale(this.dampScale):this.offsetDelta.set(0)}}})(),this.pan=(()=>{let t=new s.Vec3;return(e,i)=>{t.setFromMatrixColumn(this.object.matrix,i),t.scale(e),this.target.add(t)}})()}onLoad(){this.object.on("MouseDown",t=>{switch(t.preventDefault(),t.button){case 0:this.mode=1;break;case 2:this.mode=2}}),this.object.on("MouseUp",t=>{t.preventDefault(),this.mode=0,this.offsetStart.set(0),this.offsetEnd.set(0)}),this.object.on("MouseMove",t=>{0!==this.mode&&(this.offsetStart.set(t.offsetX,t.offsetY),0===this.offsetEnd.x&&0===this.offsetEnd.y&&this.offsetEnd.copy(this.offsetStart),this.offsetStart.sub(this.offsetEnd,this.offsetDelta),this.offsetEnd.copy(this.offsetStart),this.isDragDirty=1===this.mode,this.isPanDirty=2===this.mode)}),this.object.on("MouseWheel",t=>{t.deltaY>0?(this.dollyScale/=this.getZoomScale(),this.isDragDirty=!0):t.deltaY<0&&(this.dollyScale*=this.getZoomScale(),this.isDragDirty=!0)})}getZoomScale(){return o(.95,this.zoomSpeed)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(15),s=i(19);e.GUI=class extends s.Scene{constructor(){super(),this.camera=new r.OrthoCamera(-500,500,500,-500,1,10),this.camera.position.set(0,0,2),this.add(this.camera)}beforeRender(t){return t.autoClear=!1,this}afterRender(t){return t.autoClear=!0,this}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(3),s=i(4),n=i(6),o=i(0),a=i(13),h=i(14);let l="\nvarying vec3 vNormal;\nvarying vec3 vViewDir;\n\n#ifdef USE_MAP\nvarying vec2 vUv;\n#endif\n\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n    vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n\n    vViewDir = cameraPosition - worldPosition.xyz;\n    vNormal = mat3(modelMatrix) * normal;\n\n#ifdef USE_MAP\n    vUv = uv;\n#endif\n}\n",u="\n#define saturate(a) clamp(a, 0.0, 1.0)\n\nvarying vec3 vNormal;\nvarying vec3 vViewDir;\n\n#ifdef USE_MAP\nuniform sampler2D map;\nvarying vec2 vUv;\n#endif\n\nuniform sampler2D beckmannMap;\n\nuniform vec3 diffuse;\nuniform vec3 specular;\nuniform vec3 ambient;\nuniform vec3 wrapRGB;\n\nuniform float opacity;\nuniform float roughness;\nuniform float brightness;\n\nstruct DirectionalLight {\n    vec3 color;\n    vec3 direction;\n};\n\nstruct ReflectedLight {\n    vec3 diffuse;\n    vec3 specular;\n};\n\n#if NUM_DIR_LIGHTS > 0\nuniform DirectionalLight directionalLights[NUM_DIR_LIGHTS];\n#endif\n\n#ifdef USE_BUMPMAP\nuniform sampler2D bumpMap;\nuniform float bumpScale;\n\n// Bump Mapping Unparametrized Surfaces on the GPU by Morten S. Mikkelsen\n// http://api.unrealengine.com/attachments/Engine/Rendering/LightingAndShadows/BumpMappingWithoutTangentSpace/mm_sfgrad_bump.pdf\n\n// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\nvec2 dHdxy_fwd() {\n    vec2 dSTdx = dFdx( vUv );\n    vec2 dSTdy = dFdy( vUv );\n\n    float Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n    float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n    float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n    \n    return vec2( dBx, dBy );\n}\n\nvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n    // Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\n\n    vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n    vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n    vec3 vN = surf_norm;\t\t// normalized\n\n    vec3 R1 = cross( vSigmaY, vN );\n    vec3 R2 = cross( vN, vSigmaX );\n\n    float fDet = dot( vSigmaX, R1 );\n\n    fDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n    vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n    return normalize( abs( fDet ) * surf_norm - vGrad );\n}\n#endif\n\nfloat fresnelReflectance(vec3 H, vec3 V, float F0) {\n    float base = 1.0 - dot(V, H);\n    float exponential = pow(base, 5.0);\n    return exponential + F0 * (1.0 - exponential);\n}\n\n// Kelemen/Szirmay-Kalos specular BRDF\nfloat KS_Skin_Specular(\n    vec3 N, \t\t// Bumped surface normal\n    vec3 L, \t\t// Points to light\n    vec3 V,\t\t    // Points to eye\n    float m, \t    // Roughness\n    float rho_s \t// Specular brightness\n) {\n    float result = 0.0;\n    float ndotl = dot(N, L);\n\n    if (ndotl > 0.0) {\n        vec3 h = L + V; // Unnormalized half-way vector\n        vec3 H = normalize(h);\n\n        float ndoth = dot(N, H);\n\n        float PH = pow(2.0 * texture2D(beckmannMap, vec2(ndoth, m)).x, 10.0);\n\n        float F = fresnelReflectance(H, V, 0.028);\n        float frSpec = max(PH * F / dot(h, h), 0.0);\n\n        result = ndotl * rho_s * frSpec; // BRDF * dot(N,L) * rho_s\n    }\n    return result;\n}\n\nvoid main() {\n    vec3 normal = normalize(vNormal);\n    vec3 viewDir = normalize(vViewDir);\n    ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0));\n    vec4 diffuseColor = vec4(diffuse, opacity);\n\n#ifdef USE_MAP\n    vec4 texelColor = texture2D(map, vUv);\n    diffuseColor.rgb *= texelColor.rgb * texelColor.rgb;\n#endif\n\n#ifdef USE_BUMPMAP\n    normal = perturbNormalArb(vViewDir, normal, dHdxy_fwd());\n#endif \n\n#if NUM_DIR_LIGHTS > 0\n    DirectionalLight directionalLight;\n    #pragma unroll_loop\n    for (int i = 0; i < NUM_DIR_LIGHTS; i++) {\n        directionalLight = directionalLights[i];\n        vec3 irradiance = directionalLight.color;\n\n        float dotNL = saturate(dot(normal, directionalLight.direction));\n        vec3 weight = mix(vec3(dotNL), vec3(dotNL * 0.5 + 0.5), wrapRGB);\n\n        vec3 specularColor = specular * KS_Skin_Specular(normal, directionalLight.direction, viewDir, roughness, brightness);\n\n        reflectedLight.diffuse += irradiance * diffuseColor.rgb * weight;\n        reflectedLight.specular += irradiance * specularColor;\n    }\n#endif\n\n    vec3 ambientColor = ambient * diffuseColor.rgb;\n    vec3 outgoingLight = reflectedLight.diffuse + reflectedLight.specular + ambientColor;\n    gl_FragColor = vec4(outgoingLight, diffuseColor.a);\n}\n",c="\nvarying vec2 vUv;\n\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    vUv = uv;\n}\n",d="\nvarying vec2 vUv;\n\nfloat PHBeckmann(float ndoth, float m) {\n    float alpha = acos(ndoth);\n    float ta = tan(alpha);\n\n    float val = 1.0 / (m * m * pow(ndoth, 4.0)) * exp(-(ta * ta) / (m * m));\n    return val;\n}\n\nfloat KSTextureCompute(vec2 tex) {\n    // Scale the value to fit within [0,1]  invert upon lookup.\n    return 0.5 * pow(PHBeckmann(tex.x, tex.y), 0.1);\n}\n\nvoid main() {\n    float x = KSTextureCompute(vUv);\n    gl_FragColor = vec4(x, x, x, 1.0);\n}\n";e.SkinMaterial=class extends r.Material{constructor(t){super({vertexShader:l,fragmentShader:u}),this.diffuse=new s.Color(15658734),this.specular=new s.Color(1118481),this.opacity=1,this.roughness=.15,this.brightness=.75,this.wrapRGB=new o.Vec3(.75,.375,.1875);let e=new h.RenderTarget({width:512});this.name=t.name,this.map=t.url instanceof n.Texture2D?t.url:t.url?new n.Texture2D({url:t.url}):null,this.bumpMap=t.urlBump instanceof n.Texture2D?t.urlBump:t.urlBump?new n.Texture2D({url:t.urlBump}):null,this.beckmannMap=e.texture,this.extensions.derivatives=!0,this.addPass(new a.Pass({vertexShader:c,fragmentShader:d,renderTarget:e,afterRender:t=>t.enabled=!1}))}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});let{round:r,min:s,max:n}=Math,o=r(devicePixelRatio||1),a=80*o,h=48*o,l=3*o,u=2*o,c=3*o,d=15*o,p=74*o,f=30*o;class m{constructor(t,e,i,r){this.minValue=1/0,this.maxValue=0,this.name="",this.frontColor=null,this.backgroundColor=null,this.type=t,this.name=e,this.frontColor=i,this.backgroundColor=r;let s=document.createElement("canvas");s.width=a,s.height=h,s.style.cssText="width:80px;height:48px",this.dom=s,this.context=s.getContext("2d"),this.context.font="bold "+9*o+"px Helvetica,Arial,sans-serif",this.context.textBaseline="top",this.context.fillStyle=r,this.context.fillRect(0,0,a,h),this.context.fillStyle=i,this.context.fillText(this.name,l,u),this.context.fillRect(c,d,p,f),this.context.fillStyle=r,this.context.globalAlpha=.9,this.context.fillRect(c,d,p,f)}update(t,e){this.minValue=s(this.minValue,t),this.maxValue=n(this.maxValue,t),this.context.fillStyle=this.backgroundColor,this.context.globalAlpha=1,this.context.fillRect(0,0,a,d),this.context.fillStyle=this.frontColor,this.context.fillText(r(t)+" "+this.name+" ("+r(this.minValue)+"-"+r(this.maxValue)+")",l,u),this.context.drawImage(this.dom,c+o,d,p-o,f,c,d,p-o,f),this.context.fillRect(c+p-o,d,o,f),this.context.fillStyle=this.backgroundColor,this.context.globalAlpha=.9,this.context.fillRect(c+p-o,d,o,r((1-t/e)*f))}show(t){return this.dom.style.display=t?"block":"none",this}}class g{constructor(){this.mode=-1,this.panels=[],this.container=document.createElement("div"),this.container.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",document.body.appendChild(this.container),this.addPanel(new m(1,"FPS","#0ff","#002")),performance&&performance.memory&&this.addPanel(new m(2,"MB","#f08","#201")),this.addPanel(new m(4,"MS","#0f0","#020"))}showPanel(t){if(this.mode!==t){this.mode=t;for(let e of this.panels)e.show((e.type&t)>0)}return this}addPanel(t){return this.panels.push(t),this.container.appendChild(t.dom),this}update(t,e,i){for(let e of this.panels)if(1===e.type&&e.update(t,100),4===e.type&&e.update(i,200),2===e.type){let t=performance.memory;e.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return this}}e.Monitor=class{constructor(){this.face=0,this.memory=0,this.fps=0,this.stats=new g,this.statsMode=7,this.total=0,this.frame=0}update(t){let{renderList:e,clock:i}=t;this.face=0;for(let t of e)this.face+=t.geometry.faces.length;return this.total+=.001*i.diffTime,this.frame++,this.total>=1&&(this.total=0,this.fps=this.frame,this.frame=0,this.stats.update(this.fps,this.face,i.diffTime)),this.stats.showPanel(this.statsMode),this}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(0);function s(t,e){return t.distance-e.distance}e.Raycaster=class{constructor(){this.ray=new r.Ray}setFromCamera(t,e){return this.ray.origin.setFromMatrixPosition(e.modelMatrix),e.unproject(this.ray.direction.set(t.x,t.y,-1)).sub(this.ray.origin).normalize(),this}intersectObject(t,e,i=!0){return e.length=0,t.raycast(this,e),e.sort(s),e}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(2),s=i(7),n=i(1),o=i(0),a=i(4),h=i(29),l=i(18),u=i(28),c=i(43),d=i(31),p=i(44);let f={},m=[],g=[],x=[];function y(t){let e=f[t.id];if(void 0!==e)return e;switch(t.type){case n.ObjectType.Light:e={color:new a.Color};break;case n.ObjectType.DirectionalLight:e={color:new a.Color,direction:new o.Vec3}}return f[t.id]=e,e}let b=/(?:|\n|\r)\s*\/\/.*/g,v=/\s*#include\s*<(.*)>/g;function w(t){return t=(t=t.replace(b,(t,e)=>"")).replace(v,(t,e)=>{let i=d.ShaderChunk[e];if(void 0===i)throw Error("not find "+e);return`\n\n/*${e}*/\n`+i})}let T,_,M="\nattribute vec3 position;\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 modelMatrix;\nuniform vec3 cameraPosition;\n";e.Renderer=class{constructor(){this.width=1,this.height=1,this.aspect=1,this.pixelRatio=1,this.uniforms={},this.camera=null,this.backgournd=null,this.renderList=[],this.lights=[],this.shadowLights=[],this.directionalLights=[],this.directionalShadowMap=[],this.directionalShadowMatrix=[],this.dirctionalLength=0,this.clock=new l.Clock,this.clearColor=new a.Color,this.autoClear=!0,this.ambient=null,this.programUsed=null,this.materiaUsed=null,this.properties=new c.Properties,this.enabledCapabilities={},this.renderTarget=null,this.saveContents=[],this.shadowMap=new h.ShadowMap,this.fullScreen_=!0,_=document.getElementById("canvas"),T=_.getContext("webgl")||_.getContext("experimental-webgl"),_.style.width="100%",_.style.height="100%",this.width=_.width,this.height=_.height,this.pixelRatio=window.devicePixelRatio,this.resize(),window.addEventListener("resize",this.resize.bind(this),!1),T.clearColor(0,0,0,1),T.enable(T.DEPTH_TEST),T.depthFunc(T.LEQUAL),T.enable(T.CULL_FACE)}get fullScreen(){return this.fullScreen_}set fullScreen(t){this.fullScreen_!==t&&(this.fullScreen_=t,this.resize())}resize(){return this.fullScreen_?this.setSize(window.innerWidth,window.innerHeight):this.setSize(this.width,this.height),this}setSize(t,e=t){return this.width=t,this.height=e,this.aspect=t/e,_.width=this.pixelRatio*this.width,_.height=this.pixelRatio*this.height,T.viewport(0,0,_.width,_.height),this}getProgram(t,e){this.setFrontFace(t.side);let i=!1,r=t.defines;r.NUM_DIR_LIGHTS!==this.dirctionalLength&&(r.NUM_DIR_LIGHTS=this.dirctionalLength,i=!0),-1===t.programId&&(i=!0),i&&this.updateProgram(t,e);let s=m[t.programId];if(void 0===s){let e=x[t.programId];s=m[t.programId]=new u.Program(T,w(e.vertexShader),w(e.fragmentShader))}return s}useProgram(t,e){let i=this.programUsed;return this.materiaUsed!==e&&(this.materiaUsed=e,(i=this.getProgram(e,t).use(T)).uniforms.setValue(T,this,e),this.programUsed!==i&&(this.programUsed=i,i.attributes.setValue(T,this,t.geometry))),i}updateProgram(t,e){let i="";for(let e in t.defines)i+=`#define ${e} ${t.defines[e]}\n`;let r=e.receiveShadow&&this.shadowLights.length>0,s=e.geometry,n=["precision mediump float;",t.map?"#define USE_MAP":"",t.bumpMap?"#define USE_BUMPMAP":"",r?"#define USE_SHADOWMAP":"",s.color?"#define USE_COLOR":"",s.uv?"attribute vec2 uv;":"",s.color?"attribute vec3 color;":"",s.normal?"attribute vec3 normal;":"",M,t.vertexShader,"\n"].filter(t=>""!==t).join("\n"),o=[this.getExtensions(t),"precision mediump float;",t.map?"#define USE_MAP":"",t.bumpMap?"#define USE_BUMPMAP":"",r?"#define USE_SHADOWMAP":"",s.color?"#define USE_COLOR":"",t.fragmentShader,"\n"].filter(t=>""!==t).join("\n");return t.programId=function(t){let e=g.indexOf(t);return-1===e&&(e=g.length,g.push(t)),e}(i+n+o),x[t.programId]={vertexShader:i+n,fragmentShader:i+o},this}getExtensions(t){let e=t.extensions;return[e.derivatives&&p.Extensions.get(T,"OES_standard_derivatives")?"#extension GL_OES_standard_derivatives : enable":"",e.fragDepth&&p.Extensions.get(T,"EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",e.drawBuffers&&p.Extensions.get(T,"WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",e.shaderTextureLOD&&p.Extensions.get(T,"EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(t=>""!==t).join("\n")}setTexture2D(t,e){if(e.dataType===r.DataType.Float&&!p.Extensions.get(T,"OES_texture_float"))throw Error("not support DataType.Float");if(e.dataType===r.DataType.Float&&(e.magFilter===r.FilterType.Linear||e.minFilter===r.FilterType.Linear)&&!p.Extensions.get(T,"OES_texture_float_linear"))throw Error("not support (DataType.Float && FilterType.Linear)");return T.bindTexture(T.TEXTURE_2D,t),T.pixelStorei(T.UNPACK_FLIP_Y_WEBGL,1),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MAG_FILTER,s.getWebglFilter(T,e.magFilter)),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MIN_FILTER,s.getWebglFilter(T,e.minFilter)),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_S,s.getWebglWrapping(T,e.wrapS)),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_T,s.getWebglWrapping(T,e.wrapT)),e.url?T.texImage2D(T.TEXTURE_2D,0,T.RGBA,1,1,0,T.RGBA,s.getWebglDataType(T,e.dataType),new Uint8Array(4)):T.texImage2D(T.TEXTURE_2D,0,T.RGBA,e.width,e.height,0,T.RGBA,s.getWebglDataType(T,e.dataType),null),T.bindTexture(T.TEXTURE_2D,null),this}updateTexture2D(t,e){if(e.needUpdate){e.needUpdate=!1;let i=e.image,r=s.getWebglFormt(T,e.format);T.bindTexture(T.TEXTURE_2D,t),o.isPowerOfTwo(i.width)&&o.isPowerOfTwo(i.height)||(console.warn("Texture2D: size is not power of two "+e.url),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_S,T.CLAMP_TO_EDGE),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_T,T.CLAMP_TO_EDGE)),T.texImage2D(T.TEXTURE_2D,0,r,r,s.getWebglDataType(T,e.dataType),i),T.bindTexture(T.TEXTURE_2D,null)}return this}setTextureCube(t,e){T.bindTexture(T.TEXTURE_CUBE_MAP,t),T.pixelStorei(T.UNPACK_FLIP_Y_WEBGL,0),T.texParameteri(T.TEXTURE_CUBE_MAP,T.TEXTURE_MAG_FILTER,s.getWebglFilter(T,e.magFilter)),T.texParameteri(T.TEXTURE_CUBE_MAP,T.TEXTURE_MIN_FILTER,s.getWebglFilter(T,e.minFilter)),T.texParameteri(T.TEXTURE_CUBE_MAP,T.TEXTURE_WRAP_S,s.getWebglWrapping(T,e.wrapS)),T.texParameteri(T.TEXTURE_CUBE_MAP,T.TEXTURE_WRAP_T,s.getWebglWrapping(T,e.wrapT));for(let t=0;t<6;t++)e.urls?T.texImage2D(T.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,T.RGBA,1,1,0,T.RGBA,s.getWebglDataType(T,e.dataType),new Uint8Array(4)):T.texImage2D(T.TEXTURE_2D,0,T.RGBA,e.width,e.height,0,T.RGBA,s.getWebglDataType(T,e.dataType),null);return T.bindTexture(T.TEXTURE_CUBE_MAP,null),this}updateTextureCube(t,e){if(e.needUpdate){if(e.needUpdate=!1,e.images.length<6)throw Error("TextureCube: urls.length should be 6");T.bindTexture(T.TEXTURE_CUBE_MAP,t);for(let t=0;t<6;t++){let i=e.images[t],r=s.getWebglFormt(T,e.formats[t]);o.isPowerOfTwo(i.width)&&o.isPowerOfTwo(i.height)||(console.warn("TextureCube: size is not power of two "+i.baseURI),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_S,T.CLAMP_TO_EDGE),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_T,T.CLAMP_TO_EDGE)),T.texImage2D(T.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,r,r,s.getWebglDataType(T,e.dataType),i)}T.bindTexture(T.TEXTURE_CUBE_MAP,null)}return this}setRenderTarget(t,e=!0){if(this.renderTarget!==t){if(this.renderTarget=t,t){let e=this.properties.get(t);if(void 0===e.webglframebuffer){e.webglframebuffer=T.createFramebuffer();let i=this.properties.get(t.texture);void 0===i.webgltexture&&(i.webgltexture=T.createTexture(),this.setTexture2D(i.webgltexture,t.texture)),T.bindFramebuffer(T.FRAMEBUFFER,e.webglframebuffer),T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.TEXTURE_2D,i.webgltexture,0),T.bindFramebuffer(T.FRAMEBUFFER,null)}if(void 0===e.webglrenderbuffer&&(e.webglrenderbuffer=T.createRenderbuffer(),T.bindFramebuffer(T.FRAMEBUFFER,e.webglframebuffer),T.bindRenderbuffer(T.RENDERBUFFER,e.webglrenderbuffer),T.renderbufferStorage(T.RENDERBUFFER,T.DEPTH_COMPONENT16,t.texture.width,t.texture.height),T.framebufferRenderbuffer(T.FRAMEBUFFER,T.DEPTH_ATTACHMENT,T.RENDERBUFFER,e.webglrenderbuffer),T.bindRenderbuffer(T.RENDERBUFFER,null),T.bindFramebuffer(T.FRAMEBUFFER,null),T.checkFramebufferStatus(T.FRAMEBUFFER)!==T.FRAMEBUFFER_COMPLETE))throw Error("RenderTarget incomplete");T.bindFramebuffer(T.FRAMEBUFFER,e.webglframebuffer),T.viewport(0,0,t.texture.width,t.texture.height)}else T.bindFramebuffer(T.FRAMEBUFFER,null),T.viewport(0,0,_.width,_.height);e&&this.clear()}return this}setBufferView(t,e){return e.isElement?(T.bindBuffer(T.ELEMENT_ARRAY_BUFFER,t),T.bufferData(T.ELEMENT_ARRAY_BUFFER,new Uint16Array(e.values),T.STATIC_DRAW),T.bindBuffer(T.ELEMENT_ARRAY_BUFFER,null)):(T.bindBuffer(T.ARRAY_BUFFER,t),T.bufferData(T.ARRAY_BUFFER,new Float32Array(e.values),T.STATIC_DRAW),T.bindBuffer(T.ARRAY_BUFFER,null)),this}reset(){return this.renderList.length=0,this.lights.length=0,this.shadowLights.length=0,this}save(){return this.saveContents.push(this.renderTarget),this}restore(){return this.setRenderTarget(this.saveContents.pop(),!1),this}pushLight(t){return this.lights.push(t),t.castShadow&&this.shadowLights.push(t),this}pushMesh(t){return this.renderList.push(t),this}updateLights(){this.dirctionalLength=0;for(let t of this.lights){let e=t.shadow,i=y(t);switch(t.type){case n.ObjectType.Light:this.ambient=i.color.copy(t.color).scale(t.intensity);break;case n.ObjectType.DirectionalLight:(i=i).color.copy(t.color).scale(t.intensity),i.direction.copy(t.direction),this.directionalLights[this.dirctionalLength]=i,this.directionalShadowMap[this.dirctionalLength]=e.renderTarget&&e.renderTarget.texture||null,this.directionalShadowMatrix[this.dirctionalLength]=e.matrix||null,this.dirctionalLength++}}return this}updateCamera(){return this.camera&&this.camera.type===n.ObjectType.PerspectiveCamera&&this.camera.aspect!==this.aspect&&(this.camera.aspect=this.aspect,this.camera.updateProjectionMatrix()),this}projectObject(t){if(!1===t.visible)return this;switch(240&t.type){case n.ObjectType.Light:this.pushLight(t);break;case n.ObjectType.Camera:this.camera=t;break;case n.ObjectType.Mesh:this.pushMesh(t)}for(let e of t.children)this.projectObject(e);return this}render(t){t.start&&(t.start(_),t.start=null),t.update(this.clock.getDelta()),t.beforeRender(this),this.reset(),this.projectObject(t),this.updateLights(),this.updateCamera(),this.shadowMap.render(this),this.autoClear&&this.clear();for(let t of this.renderList)this.renderMesh(t);return this.backgournd&&(this.backgournd.position.copy(this.camera.position),this.renderMesh(this.backgournd)),t.afterRender(this),this}renderMesh(t,e){let i,r,{camera:s,ambient:n,directionalLights:o,directionalShadowMap:a,directionalShadowMatrix:h}=this;s.viewMatrix.multiply(t.modelMatrix,t.modelViewMatrix),this.uniforms.modelViewMatrix=t.modelViewMatrix,this.uniforms.modelViewMatrix=t.modelViewMatrix,this.uniforms.modelMatrix=t.modelMatrix,this.uniforms.viewMatrix=s.viewMatrix,this.uniforms.projectionMatrix=s.projectionMatrix,this.uniforms.cameraPosition=s.worldPosition,this.uniforms.ambient=n,this.uniforms.directionalLights=o,this.uniforms.directionalShadowMap=a,this.uniforms.directionalShadowMatrix=h;for(let s of t.geometry.groups)if(void 0!==(r=e||t.materials[s.materialIndex]))for(let e of r.passList)!1!==e.enabled&&(e.beforeRender(e,this),e.renderTarget?(this.save(),this.setRenderTarget(e.renderTarget),(i=this.useProgram(t,e.material)).uniforms.setValue(T,this,this.uniforms),this.draw(s,t.drawMode),this.restore()):((i=this.useProgram(t,e.material)).uniforms.setValue(T,this,this.uniforms),this.draw(s,t.drawMode)),e.afterRender(e,this));return this}renderDepth(t,e,i){if(!1===t.castShadow)return this;let r;e.viewMatrix.multiply(t.modelMatrix,t.modelViewMatrix);for(let s of t.geometry.groups)(r=this.useProgram(t,i)).setUniform(T,this,"modelViewMatrix",t.modelViewMatrix),r.setUniform(T,this,"modelMatrix",t.modelMatrix),r.setUniform(T,this,"viewMatrix",e.viewMatrix),r.setUniform(T,this,"projectionMatrix",e.projectionMatrix),r.setUniform(T,this,"cameraPosition",e.worldPosition),this.draw(s,t.drawMode);return this}draw(t,e){e=s.getWebglDrawMode(T,e);let i=this.properties.get(t.bv);return void 0===i.webglbuffer&&(i.webglbuffer=T.createBuffer(),this.setBufferView(i.webglbuffer,t.bv)),t.bv.isElement?(T.bindBuffer(T.ELEMENT_ARRAY_BUFFER,i.webglbuffer),T.drawElements(e,t.count,T.UNSIGNED_SHORT,t.offset)):(T.bindBuffer(T.ARRAY_BUFFER,i.webglbuffer),T.drawArrays(e,t.start,t.count)),this}clear(t=!0,e=!0){let i=0;return t&&(i|=T.COLOR_BUFFER_BIT),e&&(i|=T.DEPTH_BUFFER_BIT),i&&T.clear(i),this}setClearColor(t){return!1===this.clearColor.equals(t)&&(this.clearColor.copy(t),T.clearColor(t.r,t.g,t.b,1)),this}setFrontFace(t){return t===r.SideType.Double?this.disable(T.CULL_FACE):this.enable(T.CULL_FACE),T.frontFace(t===r.SideType.Back?T.CW:T.CCW),this}enable(t){return!0!==this.enabledCapabilities[t]&&(this.enabledCapabilities[t]=!0,T.enable(t)),this}disable(t){return!1!==this.enabledCapabilities[t]&&(this.enabledCapabilities[t]=!1,T.disable(t)),this}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.Properties=class{constructor(){this._properties=new WeakMap}get(t){let e=this._properties.get(t);return void 0===e&&(e={},this._properties.set(t,e)),e}remove(t){return this._properties.delete(t),this}destroy(){return this._properties=new WeakMap,this}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Extensions=new class{constructor(){this.extensions={}}get(t,e){if(void 0!==this.extensions[e])return this.extensions[e];let i;switch(e){case"WEBGL_depth_texture":i=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=t.getExtension(e)}return null===i&&console.warn("Extensions: "+e+" extension not supported."),this.extensions[e]=i,i}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(33),s=i(1);e.DirectionalLight=class extends r.Light{constructor(t,e){super(t,e),this.type=s.ObjectType.DirectionalLight,this.position.copy(this.up)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i(3);let s="\nvarying vec2 vUv;\n\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n    vUv = uv;\n}\n",n="\nuniform sampler2D map;\nvarying vec2 vUv;\n\nvoid main() {\n    gl_FragColor = texture2D(map, vUv);\n}\n";e.UnpackDepthMaterial=class extends r.Material{constructor(t){super({vertexShader:s,fragmentShader:n}),this.map=t.map||this.map}}}])}));