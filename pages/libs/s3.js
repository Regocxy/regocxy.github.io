!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.s3=t():e.s3=t()}(window,(function(){return function(e){var t={};function i(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(r,s,function(t){return e[t]}.bind(null,s));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=35)}([function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let{tan:r,sqrt:s,abs:n,max:o,min:a,atan2:h,asin:l,acos:d,sin:c,cos:u}=Math;function p(e,t,i){return o(t,a(e,i))}t.DEG2RAD=Math.PI/180,t.RAD2DEG=180/Math.PI,t.degToRad=function(e){return e*t.DEG2RAD},t.clamp=p,t.isPowerOfTwo=function(e){return 0==(e&e-1)&&0!==e};class f{constructor(e=0,t=0){this.x=e,this.y=t}set(e,t=e){return this.x=e,this.y=t,this}copy(e){return this.x=e.x,this.y=e.y,this}clone(){return(new f).copy(this)}sub(e,t=this){return t.x=this.x-e.x,t.y=this.y-e.y,t}scale(e,t=this){return t.x=this.x*e,t.y=this.y*e,t}toArray(e,t=0){return e[t]=this.x,e[t+1]=this.y,e}}t.Vec2=f;class m{constructor(e=0,t=0,i=0){this.x=e,this.y=t,this.z=i}set(e,t=e,i=e){return this.x=e,this.y=t,this.z=i,this}isZero(){return 0===this.x&&0===this.y&&0===this.z}clone(){return(new m).copy(this)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}equals(e){return this.x===e.x&&this.y===e.y&&this.z===e.z}add(e,t=this){return t.x=this.x+e.x,t.y=this.y+e.y,t.z=this.z+e.z,t}sub(e,t=this){return t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z,t}multiply(e,t=this){return t.x=this.x*e.x,t.y=this.y*e.y,t.z=this.z*e.z,t}sumOf(e,t,i=this){return i.x=e.x+t.x,i.y=e.y+t.y,i.z=e.z+t.z,i}diffOf(e,t,i=this){return i.x=e.x-t.x,i.y=e.y-t.y,i.z=e.z-t.z,i}length(){return s(this.length2())}length2(){let{x:e,y:t,z:i}=this;return e*e+t*t+i*i}normalize(e=this){return this.scale(1/this.length(),e)}scale(e,t=this){return t.x=this.x*e,t.y=this.y*e,t.z=this.z*e,t}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}cross(e,t=this){const i=this.x,r=this.y,s=this.z,n=e.x,o=e.y,a=e.z;return t.x=r*a-s*o,t.y=s*n-i*a,t.z=i*o-r*n,t}min(e){return this.x=a(this.x,e.x),this.y=a(this.y,e.y),this.z=a(this.z,e.z),this}max(e){return this.x=o(this.x,e.x),this.y=o(this.y,e.y),this.z=o(this.z,e.z),this}setFromMatrixPosition(e){let t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixColumn(e,t){let i=e.elements,r=4*t;return this.x=i[r],this.y=i[r+1],this.z=i[r+2],this}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){let r=c(t)*e;return this.x=r*c(i),this.y=u(t)*e,this.z=r*u(i),this}transformMat4(e,t=this){let i=e.elements,r=this.x,s=this.y,n=this.z,o=i[3]*r+i[7]*s+i[11]*n+i[15]||1;return o=1/o,t.x=(i[0]*r+i[4]*s+i[8]*n+i[12])*o,t.y=(i[1]*r+i[5]*s+i[9]*n+i[13])*o,t.z=(i[2]*r+i[6]*s+i[10]*n+i[14])*o,t}transformDirection(e,t=this){let i=this.x,r=this.y,s=this.z,n=e.elements;return this.x=n[0]*i+n[4]*r+n[8]*s,this.y=n[1]*i+n[5]*r+n[9]*s,this.z=n[2]*i+n[6]*r+n[10]*s,this.normalize(t)}transformQuat(e){let t=e.x,i=e.y,r=e.z,s=e.w,n=this.x,o=this.y,a=this.z,h=i*a-r*o,l=r*n-t*a,d=t*o-i*n,c=i*d-r*l,u=r*h-t*d,p=t*l-i*h,f=2*s;return h*=f,l*=f,d*=f,c*=2,u*=2,p*=2,this.x=n+h+c,this.y=o+l+u,this.z=a+d+p,this}distance(e){return s(this.distance2(e))}distance2(e){let t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r}toArray(e,t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}}t.Vec3=m;t.Vec4=class{constructor(e=0,t=0,i=0,r=0){this.x=e,this.y=t,this.z=i,this.w=r}set(e,t=e,i=e,r=e){return this.x=e,this.y=t,this.z=i,this.w=r,this}toArray(e,t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}};class g{constructor(){this.elements=[1,0,0,0,1,0,0,0,1]}copy(e){let t=this.elements,i=e.elements;return t[0]=i[0],t[4]=i[4],t[8]=i[8],t[1]=i[1],t[5]=i[5],t[9]=i[9],t[2]=i[2],t[6]=i[6],t[10]=i[10],this}clone(){return(new g).copy(this)}set(e,t,i,r,s,n,o,a,h){let l=this.elements;return l[0]=e,l[3]=t,l[6]=i,l[1]=r,l[4]=s,l[7]=n,l[2]=o,l[5]=a,l[8]=h,this}equals(e){let t=this.elements,i=e.elements;for(let e=0;e<9;e++)if(t[e]!==i[e])return!1;return!0}transpose(e=this){const t=e.elements,i=this.elements,r=i[1],s=i[2],n=i[5];return t[1]=i[3],t[2]=i[6],t[3]=r,t[5]=i[7],t[6]=s,t[7]=n,e}invert(e=this){const t=e.elements,i=this.elements,r=i[0],s=i[1],n=i[2],o=i[3],a=i[4],h=i[5],l=i[6],d=i[7],c=i[8],u=c*a-h*d,p=-c*o+h*l,f=d*o-a*l;let m=r*u+s*p+n*f;if(0===m)throw Error("Mat3.invert: can't invert determinant is 0");return m=1/m,t[0]=u*m,t[1]=(-c*s+n*d)*m,t[2]=(h*s-n*a)*m,t[3]=p*m,t[4]=(c*r-n*l)*m,t[5]=(-h*r+n*o)*m,t[6]=f*m,t[7]=(-d*r+s*l)*m,t[8]=(a*r-s*o)*m,e}toArray(e,t=0){let i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}setFromMat4(e){let t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10])}getNormalMatrix(e){return this.setFromMat4(e).invert().transpose()}}t.Mat3=g;class _{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.lookAt=(()=>{let e=new m,t=new m,i=new m;return(r,s,o)=>{r.sub(s,i),i.isZero()&&(i.z=1),i.normalize(),o.cross(i,e),e.isZero()&&(1===n(o.z)?i.x+=1e-4:i.z+=1e-4,i.normalize(),o.cross(i,e)),e.normalize(),i.cross(e,t);let a=this.elements;return a[0]=e.x,a[1]=e.y,a[2]=e.z,a[4]=t.x,a[5]=t.y,a[6]=t.z,a[8]=i.x,a[9]=i.y,a[10]=i.z,this}})(),this.getRatationMatrix=(()=>{let e=new m;return(t=this)=>{const i=this.elements,r=t.elements,s=1/e.set(i[0],i[1],i[2]).length(),n=1/e.set(i[4],i[5],i[6]).length(),o=1/e.set(i[8],i[9],i[10]).length();return r[0]=i[0]*s,r[1]=i[1]*s,r[2]=i[2]*s,r[3]=0,r[4]=i[4]*n,r[5]=i[5]*n,r[6]=i[6]*n,r[7]=0,r[8]=i[8]*o,r[9]=i[9]*o,r[10]=i[10]*o,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,t}})()}set(e,t,i,r,s,n,o,a,h,l,d,c,u,p,f,m){let g=this.elements;return g[0]=e,g[4]=t,g[8]=i,g[12]=r,g[1]=s,g[5]=n,g[9]=o,g[13]=a,g[2]=h,g[6]=l,g[10]=d,g[14]=c,g[3]=u,g[7]=p,g[11]=f,g[15]=m,this}copy(e){let t=this.elements,i=e.elements;return t[0]=i[0],t[4]=i[4],t[8]=i[8],t[12]=i[12],t[1]=i[1],t[5]=i[5],t[9]=i[9],t[13]=i[13],t[2]=i[2],t[6]=i[6],t[10]=i[10],t[14]=i[14],t[3]=i[3],t[7]=i[7],t[11]=i[11],t[15]=i[15],this}clone(){return(new _).copy(this)}perspective(e,t,i,s){const n=1/r(e/2),o=1/(i-s),a=this.elements;return a[0]=n/t,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=n,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=(s+i)*o,a[11]=-1,a[12]=0,a[13]=0,a[14]=2*s*i*o,a[15]=0,this}ortho(e,t,i,r,s,n){const o=1/(e-t),a=1/(i-r),h=1/(s-n),l=this.elements;return l[0]=-2*o,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=-2*a,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=2*h,l[11]=0,l[12]=(e+t)*o,l[13]=(r+i)*a,l[14]=(n+s)*h,l[15]=1,this}multiply(e,t=this){const i=this.elements,r=e.elements,s=t.elements,n=i[0],o=i[1],a=i[2],h=i[3],l=i[4],d=i[5],c=i[6],u=i[7],p=i[8],f=i[9],m=i[10],g=i[11],_=i[12],v=i[13],y=i[14],x=i[15];let M=r[0],w=r[1],b=r[2],T=r[3];return s[0]=M*n+w*l+b*p+T*_,s[1]=M*o+w*d+b*f+T*v,s[2]=M*a+w*c+b*m+T*y,s[3]=M*h+w*u+b*g+T*x,M=r[4],w=r[5],b=r[6],T=r[7],s[4]=M*n+w*l+b*p+T*_,s[5]=M*o+w*d+b*f+T*v,s[6]=M*a+w*c+b*m+T*y,s[7]=M*h+w*u+b*g+T*x,M=r[8],w=r[9],b=r[10],T=r[11],s[8]=M*n+w*l+b*p+T*_,s[9]=M*o+w*d+b*f+T*v,s[10]=M*a+w*c+b*m+T*y,s[11]=M*h+w*u+b*g+T*x,M=r[12],w=r[13],b=r[14],T=r[15],s[12]=M*n+w*l+b*p+T*_,s[13]=M*o+w*d+b*f+T*v,s[14]=M*a+w*c+b*m+T*y,s[15]=M*h+w*u+b*g+T*x,t}compose(e,t,i){const r=e.x,s=e.y,n=e.z,o=e.w,a=r+r,h=s+s,l=n+n,d=r*a,c=r*h,u=r*l,p=s*h,f=s*l,m=n*l,g=o*a,_=o*h,v=o*l,y=i.x,x=i.y,M=i.z,w=this.elements;return w[0]=(1-(p+m))*y,w[1]=(c+v)*y,w[2]=(u-_)*y,w[3]=0,w[4]=(c-v)*x,w[5]=(1-(d+m))*x,w[6]=(f+g)*x,w[7]=0,w[8]=(u+_)*M,w[9]=(f-g)*M,w[10]=(1-(d+p))*M,w[11]=0,w[12]=t.x,w[13]=t.y,w[14]=t.z,w[15]=1,this}invert(e=this){let t=this.elements,i=e.elements;const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],h=t[5],l=t[6],d=t[7],c=t[8],u=t[9],p=t[10],f=t[11],m=t[12],g=t[13],_=t[14],v=t[15],y=r*h-s*a,x=r*l-n*a,M=r*d-o*a,w=s*l-n*h,b=s*d-o*h,T=n*d-o*l,E=c*g-u*m,S=c*_-p*m,D=c*v-f*m,P=u*_-p*g,R=u*v-f*g,L=p*v-f*_;let A=y*L-x*R+M*P+w*D-b*S+T*E;if(0===A)throw Error("Mat4.invert: can't invert determinant is 0");return A=1/A,i[0]=(h*L-l*R+d*P)*A,i[1]=(n*R-s*L-o*P)*A,i[2]=(g*T-_*b+v*w)*A,i[3]=(p*b-u*T-f*w)*A,i[4]=(l*D-a*L-d*S)*A,i[5]=(r*L-n*D+o*S)*A,i[6]=(_*M-m*T-v*x)*A,i[7]=(c*T-p*M+f*x)*A,i[8]=(a*R-h*D+d*E)*A,i[9]=(s*D-r*R-o*E)*A,i[10]=(m*b-g*M+v*y)*A,i[11]=(u*M-c*b-f*y)*A,i[12]=(h*S-a*P-l*E)*A,i[13]=(r*P-s*S+n*E)*A,i[14]=(g*x-m*w-_*y)*A,i[15]=(c*w-u*x+p*y)*A,e}makeTranslation(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationFromEuler(e){const t=e.x,i=e.y,r=e.z,s=u(t),n=c(t),o=u(i),a=c(i),h=u(r),l=c(r),d=s*h,p=s*l,f=n*h,m=n*l,g=o*h,_=f*a,v=d*a,y=o*l,x=m*a,M=p*a,w=f,b=o*n,T=s*o;return this.set(g,_-p,m+v,0,y,d+x,M-w,0,-a,b,T,0,0,0,0,1),this}translate(e,t=this){return this.tranlateFromCartesianCoords(e.x,e.y,e.z,t)}tranlateFromCartesianCoords(e,t,i,r=this){let s=r.elements;return s[12]=e,s[13]=t,s[14]=i,s[15]=1,r}getMaxScaleOnAxis(){let e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return s(o(t,i,r))}toArray(e,t=0){let i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}t.Mat4=_;class v{constructor(){this.x=0,this.y=0,this.z=0,this.w=1}set(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}clone(){return(new v).copy(this)}equals(e){return this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w}multiply(e,t=this){const i=this.x,r=this.y,s=this.z,n=this.w,o=e.x,a=e.y,h=e.z,l=e.w;return t.x=i*l+n*o+r*h-s*a,t.y=r*l+n*a+s*o-i*h,t.z=s*l+n*h+i*a-r*o,t.w=n*l-i*o-r*a-s*h,t}setFromRotationMatrix(e){const t=e.elements,i=t[0],r=t[4],n=t[8],o=t[1],a=t[5],h=t[9],l=t[2],d=t[6],c=t[10];let u=i+a+c;if(u>0){let e=.5/s(u+1);this.w=.25/e,this.x=(d-h)*e,this.y=(n-l)*e,this.z=(o-r)*e}else if(i>a&&i>c){let e=2*s(1+i-a-c);this.w=(d-h)/e,this.x=.25*e,this.y=(r+o)/e,this.z=(n+l)/e}else if(a>c){let e=2*s(1+a-i-c);this.w=(n-l)/e,this.x=(r+o)/e,this.y=.25*e,this.z=(h+d)/e}else{let e=2*s(1+c-i-a);this.w=(o-r)/e,this.x=(n+l)/e,this.y=(h+d)/e,this.z=.25*e}return this}setFromEuler(e){let{x:t,y:i,z:r}=e;i*=.5,r*=.5;const s=c(t*=.5),n=u(t),o=c(i),a=u(i),h=c(r),l=u(r);return this.x=s*a*l-n*o*h,this.y=n*o*l+s*a*h,this.z=n*a*h-s*o*l,this.w=n*a*l+s*o*h,this}invert(e=this){return e.x=-this.x,e.y=-this.y,e.z=-this.z,e.w=this.w,e}}t.Quat=v;class y{constructor(e=0,t=0,i=0){this.x=e,this.y=t,this.z=i}set(e,t,i){return this.x=e,this.y=t,this.z=i,this}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}clone(){return(new y).copy(this)}equals(e){return this.x===e.x&&this.y===e.y&&this.z===e.z}setFromQuat(e){const{x:t,y:i,z:r,w:s}=e;return this.x=h(2*(s*t+i*r),1-2*(t*t+i*i)),this.y=l(p(2*(s*i-r*t),-1,1)),this.z=h(2*(s*r+t*i),1-2*(i*i+r*r)),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],r=t[4],s=(t[8],t[1]),o=t[5],a=(t[9],t[2]),d=t[6],c=t[10];return this.y=l(-p(a,-1,1)),n(a)<.99999?(this.x=h(d,c),this.z=h(s,i)):(this.x=0,this.z=h(-r,o)),this}}t.Euler=y;t.Spherical=class{constructor(e=1,t=0,i=0){this.radius=e,this.phi=t,this.theta=i}setFromVec3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=s(e*e+t*t+i*i),0===this.radius?(this.theta=0,this.phi=0):(this.theta=h(e,i),this.phi=d(p(t/this.radius,-1,1))),this}};class x{constructor(e,t){this.min=void 0!==e?e:new m(1/0,1/0,1/0),this.max=void 0!==t?t:new m(-1/0,-1/0,-1/0)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}clone(){return(new x).copy(this)}set(e,t){return this.min.copy(e),this.max.copy(t),this}containsPoint(e){return!(e.x<this.min.x||e.y<this.min.y||e.z<this.min.z||e.x>this.max.x||e.y>this.max.y||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}makeEmpty(){this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.sumOf(this.min,this.max).scale(.5)}setFromPoints(e){this.makeEmpty();for(let t=0;t<e.length;t++)this.expandByPoint(e[t]);return this}expandByPoint(e){return this.min.min(e),this.max.max(e),this}}t.Box3=x;class M{constructor(e,t){this.setFromPoints=(()=>{let e=new x;return t=>{let i=this.center,r=0;e.setFromPoints(t).getCenter(this.center);for(let e=0;e<t.length;e++)r=o(r,i.distance2(t[e]));return this.radius=s(r),this}})(),this.center=void 0!==e?e:new m,this.radius=void 0!==t?t:0}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}clone(){return(new M).copy(this)}set(e,t){return this.center.copy(e),this.radius=t,this}transformMat4(e){return this.center.transformMat4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}}t.Sphere=M;class w{constructor(e,t){this.origin=new m,this.direction=new m,this.distanceToPoint2=(()=>{let e=new m;return t=>{let i=t.sub(this.origin,e).dot(this.direction);return i<0?this.origin.distance2(t):(e.copy(this.direction).scale(i).add(this.origin),e.distance2(t))}})(),this.intersectSphere=(()=>{let e=new m;return(t,i)=>{e.sub(t.center,this.origin);let r=e.dot(this.direction),s=e.dot(e)-r*r,n=t.radius*t.radius;if(s>n)return null;let o=Math.sqrt(n-s),a=r-o,h=r+o;return a<0&&h<0?null:a<0?this.at(h,i):this.at(a,i)}})(),this.intersectTriangle=(()=>{var e=new m,t=new m,i=new m,r=new m;return(s,n,o,a,h)=>{n.sub(s,t),o.sub(s,i),t.cross(i,r);var l,d=this.direction.dot(r);if(d>0){if(a)return null;l=1}else{if(!(d<0))return null;l=-1,d=-d}this.origin.sub(s,e);var c=l*this.direction.dot(e.cross(i,i));if(c<0)return null;var u=l*this.direction.dot(t.cross(e));if(u<0)return null;if(c+u>d)return null;var p=-l*e.dot(r);return p<0?null:this.at(p/d,h)}})(),this.origin=e||this.origin,this.direction=t||this.direction}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}clone(){return(new w).copy(this)}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}transformMat4(e){return this.origin.transformMat4(e),this.direction.transformDirection(e),this}at(e,t){return t.copy(this.direction).scale(e).add(this.origin)}distanceToPlane(e){let t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;let i=-e.distanceToPoint(this.origin)/t;return i>=0?i:null}intersectPlane(e,t){let i=this.distanceToPlane(e);return null===i?null:this.at(i,t)}intersectSphereTest(e){return this.distanceToPoint2(e.center)<=e.radius*e.radius}intersectPlaneTest(e){let t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}}t.Ray=w;t.Face=class{constructor(e,t,i){this.a=e,this.b=t,this.c=i}};class b{constructor(e,t){this.normal=void 0!==e?e:new m(1,0,0),this.constant=void 0!==t?t:0}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}clone(){return(new b).copy(this)}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}normalize(){let e=1/this.normal.length();return this.normal.scale(e),this.constant*=e,this}}t.Plane=b},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),s=i(36);var n;!function(e){e[e.Object3D=16]="Object3D",e[e.Camera=32]="Camera",e[e.PerspectiveCamera=33]="PerspectiveCamera",e[e.OrthoCamera=34]="OrthoCamera",e[e.Light=48]="Light",e[e.DirectionalLight=49]="DirectionalLight",e[e.PointLight=50]="PointLight",e[e.Mesh=64]="Mesh",e[e.Scene=80]="Scene",e[e.GUI=81]="GUI"}(n=t.ObjectType||(t.ObjectType={}));let o=1;t.Object3D=class extends s.Event{constructor(){super(...arguments),this.id=o++,this.name="",this.type=n.Object3D,this.visible=!0,this.children=[],this.up=new r.Vec3(0,1,0),this.position=new r.Vec3,this.scale=new r.Vec3(1,1,1),this.rotation=new r.Euler,this.quaternion=new r.Quat,this.matrix=new r.Mat4,this.modelViewMatrix=new r.Mat4,this.isModelMatrixDirty=!0,this.isInvertModelMatrixDirty=!0,this.isTransformDirty=!0,this.isNormalMatrixDirty=!0,this.isWorldPositionDirty=!0,this._modelMatrix=new r.Mat4,this._invertModelMatrix=new r.Mat4,this._normalMatrix=new r.Mat3,this._worldPosition=new r.Vec3,this._components=[],this.updateModelMatrix=(()=>{let e=new r.Vec3,t=new r.Vec3(1,1,1),i=new r.Euler,s=new r.Quat;return()=>{if(!1===e.equals(this.position)&&(e.copy(this.position),this.isTransformDirty=!0),!1===t.equals(this.scale)&&(t.copy(this.scale),this.isTransformDirty=!0),!1===i.equals(this.rotation)&&(i.copy(this.rotation),this.quaternion.setFromEuler(this.rotation)),!1===s.equals(this.quaternion)&&(s.copy(this.quaternion),this.isTransformDirty=!0),this.isTransformDirty&&(this.isTransformDirty=!1,this.matrix.compose(this.quaternion,this.position,this.scale),this.isModelMatrixDirty=!0),this.isModelMatrixDirty){this.isModelMatrixDirty=!1,this.parent?this.parent.modelMatrix.multiply(this.matrix,this._modelMatrix):this._modelMatrix.copy(this.matrix);for(let e=0;e<this.children.length;e++)this.children[e].isModelMatrixDirty=!0;this.isInvertModelMatrixDirty=!0,this.isNormalMatrixDirty=!0,this.isWorldPositionDirty=!0}return this._modelMatrix}})(),this.lookAt=(()=>{let e=new r.Vec3,t=new r.Mat4;return i=>(e.setFromMatrixPosition(this.modelMatrix),t.lookAt(e,i,this.up),this.rotation.setFromRotationMatrix(t),this)})()}get modelMatrix(){return this.updateModelMatrix()}get invertModelMatrix(){return this.updateInvertModelMatrix()}get normalMatrix(){return this.isNormalMatrixDirty&&(this.isNormalMatrixDirty=!1,this._normalMatrix.getNormalMatrix(this.modelMatrix)),this._normalMatrix}get worldPosition(){return this.isWorldPositionDirty&&(this.isWorldPositionDirty=!1,this._worldPosition.setFromMatrixPosition(this.modelMatrix)),this._worldPosition}add(e){return e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),this}remove(e){let t=this.children.indexOf(e);return-1!=t&&(e.parent=null,this.children.splice(t,1)),this}setParent(e){return e.add(this),this}removeSelf(){return this.parent&&this.parent.remove(this),this}find(e){let t=e.split("/"),i=null,r=t[t.length-1],s=this.children;for(let e of t){for(let t of s)if(t.name===e){s=t.children,i=t;break}if(s===this.children)break}return i&&i.name===r?i:null}update(e){this.updateModelMatrix();for(let t of this._components)t.start&&(t.start(),t.start=void 0),t.update(e);for(let t of this.children)t.update(e);return this}updateInvertModelMatrix(){return this.isInvertModelMatrixDirty&&(this.isInvertModelMatrixDirty=!1,this.modelMatrix.invert(this._invertModelMatrix)),this._invertModelMatrix}render(e){return this}getComponent(e){return this.findComponent(e)}addComponent(e){let t=this.findComponent(e);return void 0===t&&((t=new e).object=this,t.onLoad(),this._components.push(t)),t}removeComponent(e){let t=this._components.indexOf(e);return-1!=t&&this._components.splice(t,1),this}findComponent(e){for(let t=0,i=this._components.length;t<i;t++){let i=this._components[t];if(i instanceof e)return i}}raycast(e,t){return this}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.None=0]="None",e[e.Simple=1]="Simple",e[e.Linear=2]="Linear",e[e.Reinhard=3]="Reinhard",e[e.ReinhardLuma=4]="ReinhardLuma",e[e.ReinhardWhite=5]="ReinhardWhite",e[e.Filmic=6]="Filmic",e[e.Filmic2015=7]="Filmic2015",e[e.Photographic=8]="Photographic",e[e.Uncharted=9]="Uncharted"}(t.ToneMappingType||(t.ToneMappingType={})),function(e){e[e.None=0]="None",e[e.Front=1]="Front",e[e.Back=2]="Back",e[e.Double=3]="Double"}(t.SideType||(t.SideType={})),function(e){e[e.None=0]="None",e[e.UnsignedByte=1]="UnsignedByte",e[e.Byte=2]="Byte",e[e.Short=3]="Short",e[e.UnsignedShort=4]="UnsignedShort",e[e.Int=5]="Int",e[e.UnsignedInt=6]="UnsignedInt",e[e.Float=7]="Float",e[e.HalfFloat=8]="HalfFloat",e[e.UnsignedShort4444=9]="UnsignedShort4444",e[e.UnsignedShort5551=10]="UnsignedShort5551",e[e.UnsignedShort565=11]="UnsignedShort565",e[e.UnsignedInt248=12]="UnsignedInt248"}(t.DataType||(t.DataType={})),function(e){e[e.None=0]="None",e[e.Alpha=1]="Alpha",e[e.RGB=2]="RGB",e[e.RGBA=3]="RGBA",e[e.Luminance=4]="Luminance",e[e.LuminanceAlpha=5]="LuminanceAlpha",e[e.RGBE=3]="RGBE",e[e.Depth=4]="Depth",e[e.DepthStencil=5]="DepthStencil",e[e.Red=6]="Red"}(t.FormatType||(t.FormatType={})),function(e){e[e.None=0]="None",e[e.Repeat=1]="Repeat",e[e.ClampToEdge=2]="ClampToEdge",e[e.MirroredRepeat=3]="MirroredRepeat"}(t.WrappingType||(t.WrappingType={})),function(e){e[e.None=0]="None",e[e.Nearest=1]="Nearest",e[e.NearestMipMapNearest=2]="NearestMipMapNearest",e[e.NearestMipMapLinear=3]="NearestMipMapLinear",e[e.Linear=4]="Linear",e[e.LinearMipMapNearest=5]="LinearMipMapNearest",e[e.LinearMipMapLinear=6]="LinearMipMapLinear"}(t.FilterType||(t.FilterType={})),function(e){e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(t.DrawMode||(t.DrawMode={})),function(e){e[e.None=0]="None",e[e.Normal=1]="Normal",e[e.Add=2]="Add",e[e.Sub=3]="Sub",e[e.Mul=4]="Mul"}(t.BlendType||(t.BlendType={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let{floor:r}=Math;class s{constructor(e,t,i){this.r=0,this.g=0,this.b=0,e instanceof s?this.copy(e):this.set(e,t,i)}set(e,t,i){return void 0!==e&&void 0!==t&&void 0!==i?this.setRGB(e,t,i):void 0!==e&&this.setHex(e),this}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}clone(){return(new s).copy(this)}scale(e,t=this){return t.r=this.r*e,t.g=this.g*e,t.b=this.b*e,t}equals(e){return this.r===e.r&&this.g===e.g&&this.b===e.b}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getGamma(e=this){let t=this.r,i=this.g,r=this.b;return e.r=t*t,e.g=i*i,e.b=r*r,e}setHex(e){return e=r(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this}setRGB(e,t,i){return this.r=e,this.g=t,this.b=i,this}setHSV(e,t,i){if(0===i)return this.r=this.g=this.b=0,this;let s=r(6*e),n=6*e-s,o=i*(1-t),a=i*(1-n*t),h=i*(1-(1-n)*t);switch(s){case 0:this.setRGB(i,h,o);break;case 1:this.setRGB(a,i,o);break;case 2:this.setRGB(o,i,h);break;case 3:this.setRGB(o,a,i);break;case 4:this.setRGB(h,o,i);break;case 5:this.setRGB(i,o,a)}return this}toArray(e,t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}}t.Color=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(2),s=i(15),n=i(8);let o=1;function a(e,t){if(e&&t)for(let i in e)t[i]=e[i];return t}t.Material=class{constructor(e){this.id=o++,this.side=r.SideType.Front,this.blending=r.BlendType.None,this.programId=-1,this.passList=[],this.needUpdate=!1,this.defines={NUM_DIR_LIGHTS:0},this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.vertexShader=e.vertexShader,this.fragmentShader=e.fragmentShader,this.side=e.side||this.side,this.blending=e.blending||this.blending,a(e.defines,this.defines),a(e.extensions,this.extensions),this.onLoad=()=>this.needUpdate=!0,this.addPass(new s.Pass({material:this}))}get pass(){return this.passList[0]}set pass(e){this.passList[0]=e}addPass(e){return this.passList.push(e),this}setTexture2D(e,t){let i=t instanceof n.Texture2D?t:t?new n.Texture2D({url:t}):null;return i&&(i.onLoad=this.onLoad),this[e]=i,this}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(2);t.assert=function(e,t){if(!e)throw Error(t);return e},t.dirname=function(e){return e.substr(0,e.lastIndexOf("/")+1)},t.getImageFormat=function(e){return e?e.search(/jpe?g/i)>0?r.FormatType.RGB:r.FormatType.RGBA:null},t.getWebglFormt=function(e,t){switch(t){case void 0:return;case r.FormatType.Alpha:return e.ALPHA;case r.FormatType.RGBA:return e.RGBA;case r.FormatType.RGB:return e.RGB;case r.FormatType.Depth:return e.DEPTH_COMPONENT;default:throw Error("invalid format: "+t)}},t.getWebglWrapping=function(e,t){switch(t){case void 0:return;case r.WrappingType.ClampToEdge:return e.CLAMP_TO_EDGE;case r.WrappingType.MirroredRepeat:return e.MIRRORED_REPEAT;case r.WrappingType.Repeat:return e.REPEAT;default:throw Error("invalid wrapping: "+t)}},t.getWebglFilter=function(e,t){switch(t){case void 0:return;case r.FilterType.Linear:return e.LINEAR;case r.FilterType.LinearMipMapLinear:return e.LINEAR_MIPMAP_LINEAR;case r.FilterType.LinearMipMapNearest:return e.LINEAR_MIPMAP_NEAREST;case r.FilterType.Nearest:return e.NEAREST;case r.FilterType.NearestMipMapLinear:return e.NEAREST_MIPMAP_LINEAR;case r.FilterType.NearestMipMapNearest:return e.NEAREST_MIPMAP_NEAREST;default:throw Error("invalid filter: "+t)}},t.getWebglDataType=function(e,t){switch(t){case void 0:return;case r.DataType.Byte:return e.BYTE;case r.DataType.Float:return e.FLOAT;case r.DataType.Int:return e.INT;case r.DataType.Short:return e.SHORT;case r.DataType.UnsignedByte:return e.UNSIGNED_BYTE;case r.DataType.UnsignedShort:return e.UNSIGNED_SHORT;default:throw Error("invalid datatype: "+t)}},t.getWebglDrawMode=function(e,t){switch(t){case void 0:return;case r.DrawMode.POINTS:return e.POINTS;case r.DrawMode.LINES:return e.LINES;case r.DrawMode.LINE_LOOP:return e.LINE_LOOP;case r.DrawMode.LINE_STRIP:return e.LINE_STRIP;case r.DrawMode.TRIANGLES:return e.TRIANGLES;case r.DrawMode.TRIANGLE_STRIP:return e.TRIANGLE_STRIP;case r.DrawMode.TRIANGLE_FAN:return e.TRIANGLE_FAN;default:throw Error("invalid drawMode: "+t)}}},function(e,t,i){"use strict";function r(e,t,i,r,s){let n=0,o=new XMLHttpRequest;return o.onreadystatechange=function(e){switch(this.readyState){case XMLHttpRequest.DONE:200===this.status?i&&i(this.response):r&&r(this.status);break;case XMLHttpRequest.LOADING:0===n&&(n=parseInt(o.getResponseHeader("Content-Length"))),s&&s(this.responseText.length,n);break;case XMLHttpRequest.HEADERS_RECEIVED:n=parseInt(o.getResponseHeader("Content-Length"))}},o.responseType=t,o.open("GET",e,!0),o.send(),o}Object.defineProperty(t,"__esModule",{value:!0}),t.loadBlob=function(e,t,i,s){return r(e,"arraybuffer",t,i,s)},t.loadText=function(e,t,i,s){return r(e,"text",t,i,s)},t.loadImage=function(e,t,i){let r=new Image;return r.onload=function(e){t&&t(r)},r.onerror=function(e){i&&i(e.toString())},r.crossOrigin="anonymous",r.src=e,r}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(17),s=i(13),n=i(0),o=i(5);t.Geometry=class{constructor(){this.groups=[],this.faces=[],this.vertices=[]}set(e){return this.setBufferView("uv",e.uv,2),this.setBufferView("position",e.position,3),this.setBufferView("normal",e.normal,3),this.setBufferView("color",e.color,3),this.setBufferView("indice",e.indice,1,!0),this.setGroups(e.groups),this.computeFaces(),this}checkComplete(){let e=0;for(let t of this.groups)e+=t.count;return this.position&&o.assert(this.position.count===e,"position not pass"),this.color&&o.assert(this.color.count===e,"color not pass"),this.normal&&o.assert(this.normal.count===e,"normal not pass"),this.uv&&o.assert(this.uv.count===e,"uv not pass"),this}setBufferView(e,t,i,s=!1){return void 0!==t&&(t instanceof r.BufferView?this[e]=t:t.length>0&&(this[e]=(new r.BufferView).set({data:t,stride:i,element:s}))),this}setGroups(e,t){if(this.groups.length=0,e)this.groups=e;else if(this.indice)this.groups.push((new s.Group).set({bv:this.indice,start:0,count:this.indice.count}));else{if(!this.position)throw Error("set groups fail");this.groups.push((new s.Group).set({bv:this.position,start:0,count:this.position.count}))}if(t){let e=this.groups[0];for(let i=0;i<t.length;i++){let r=this.groups[i];void 0===r&&(r=this.groups[i]=e.clone()),r.materialIndex=t[i]}}return this}computeFaces(){let{vertices:e,position:t,indice:i,groups:r,faces:s}=this;e.length=0,s.length=0;let o,a=t.values;for(let t=0;t<a.length;t+=3)e.push(new n.Vec3(a[t],a[t+1],a[t+2]));for(let e of r){let t=e.start+e.count;for(let r=e.start;r<t;r+=3)i?(o=i.values,s.push(new n.Face(o[r],o[r+1],o[r+2]))):s.push(new n.Face(r,r+1,r+2))}return this}computeVertexNormals(e=!1){let t,i,r,s,{faces:o,vertices:a}=this;0===o.length&&this.computeFaces();let h=new n.Vec3,l=new n.Vec3,d=new Array(a.length);for(let e=0,t=d.length;e<t;e++)d[e]=new n.Vec3;for(let e=0,n=o.length;e<n;e++)t=a[(s=o[e]).a],i=a[s.b],(r=a[s.c]).sub(i,h),t.sub(i,l),h.cross(l),d[s.a].add(h),d[s.b].add(h),d[s.c].add(h);void 0===this.normal&&this.setBufferView("normal",new Array(this.vertices.length),3);let c=this.normal.values;for(let t=0,i=d.length,r=0;t<i;t++,r+=3){let i=d[t];e&&i.normalize(),c[r]=i.x,c[r+1]=i.y,c[r+2]=i.z}return this}computeBoundingSphere(){return void 0===this.boundingSphere&&(this.boundingSphere=new n.Sphere),this.boundingSphere.setFromPoints(this.vertices),this}computeBoundingBox(){return void 0===this.boundingBox&&(this.boundingBox=new n.Box3),this.boundingBox.setFromPoints(this.vertices),this}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(2),s=i(5),n=i(6);let o=1;t.Texture2D=class{constructor(e={}){this.id=o++,this.url=null,this.image=null,this.width=1,this.height=1,this.flipY=!0,this.format=r.FormatType.RGBA,this.dataType=r.DataType.UnsignedByte,this.magFilter=r.FilterType.Linear,this.minFilter=r.FilterType.Linear,this.wrapS=r.WrappingType.ClampToEdge,this.wrapT=r.WrappingType.ClampToEdge,this.anisotropy=1,this.needUpdate=!1,this.url=e.url||this.url,this.width=e.width||this.width,this.height=e.height||this.width||this.height,this.flipY=void 0!==e.flipY?e.flipY:this.flipY,this.format=e.format||s.getImageFormat(this.url)||this.format,this.dataType=e.dataType||this.dataType,this.magFilter=e.magFilter||this.magFilter,this.minFilter=e.minFilter||this.magFilter,this.wrapS=e.wrapS||this.wrapS,this.wrapT=e.wrapT||this.wrapS,this.anisotropy=e.anisotropy||this.anisotropy,this.url&&n.loadImage(this.url,e=>{this.image=e,this.needUpdate=!0,this.onLoad&&this.onLoad()})}onLoad(){}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Component=class{constructor(){this.object=null}onLoad(){}start(){}update(e){}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(2),s=i(1),n=i(14),o=i(0);t.Mesh=class extends s.Object3D{constructor(e,t){super(),this.type=s.ObjectType.Mesh,this.drawMode=r.DrawMode.TRIANGLES,this.materials=[],this.castShadow=!1,this.receiveShadow=!1,this.raycast=(()=>{let e=new o.Sphere,t=new o.Ray,i=new o.Vec3,r=new o.Vec3,s=(e,t,i,s,n,o)=>null===t.intersectTriangle(i,s,n,!1,o)?null:(r.copy(o),r.transformMat4(this.modelMatrix),{distance:e.ray.origin.distance(r),point:r.clone(),object:this});return(r,n)=>{if(!1===this.visible)return this;if(void 0===this.geometry.boundingSphere&&this.geometry.computeBoundingSphere(),e.copy(this.geometry.boundingSphere),e.transformMat4(this.modelMatrix),!1===r.ray.intersectSphereTest(e))return this;t.copy(r.ray).transformMat4(this.invertModelMatrix);let o,a,h,l,{vertices:d,faces:c}=this.geometry;for(let e of c)o=d[e.a],a=d[e.b],h=d[e.c],null!==(l=s(r,t,o,a,h,i))&&n.push(l);return this}})(),this.geometry=e,Array.isArray(t)?this.materials=t:this.material=t||new n.PhongMaterial}get material(){return this.materials[0]}set material(e){this.materials[0]=e}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(1),s=i(0);t.Camera=class extends r.Object3D{constructor(){super(...arguments),this.type=r.ObjectType.Camera,this.projectionMatrix=new s.Mat4,this.unproject=(()=>{let e=new s.Mat4;return t=>t.transformMat4(this.projectionMatrix.invert(e)).transformMat4(this.modelMatrix)})()}get viewMatrix(){return this.invertModelMatrix}project(e){return e.transformMat4(this.invertModelMatrix).transformMat4(this.projectionMatrix)}updateProjectionMatrix(){return this}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(11),s=i(1);t.OrthoCamera=class extends r.Camera{constructor(e,t,i,r,n,o){super(),this.type=s.ObjectType.OrthoCamera,this.left=-1,this.right=1,this.top=1,this.bottom=-1,this.near=0,this.far=2e3,this.left=e||this.left,this.right=t||this.right,this.top=i||this.top,this.bottom=r||this.bottom,this.near=n||this.near,this.far=o||this.far,this.updateProjectionMatrix()}updateProjectionMatrix(){return this.projectionMatrix.ortho(this.left,this.right,this.bottom,this.top,this.near,this.far),this}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{set(e){let{bv:t,start:i,count:r,materialIndex:s=0}=e;return this.bv=t,this.start=i,this.count=r,this.offset=i*t.bytesPer,this.materialIndex=s,this}copy(e){return this.bv=e.bv,this.start=e.start,this.count=e.count,this.offset=e.offset,this.materialIndex=e.materialIndex,this}clone(){return(new r).copy(this)}}t.Group=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(4),s=i(3),n=i(0);let o="\nvarying vec3 vNormal;\nvarying vec3 vViewDir;\n\n#ifdef USE_COLOR\n    varying vec3 vColor;\n#endif\n\n#ifdef USE_MAP\n    varying vec2 vUv;\n#endif\n\n#ifdef USE_FOG\n    varying float fogDepth;\n#endif \n\n#ifdef USE_SHADOWMAP\n\n#if NUM_DIR_LIGHTS > 0\n    uniform mat4 directionalShadowMatrix[NUM_DIR_LIGHTS];\n    varying vec4 vDirectionalShadowCoord[NUM_DIR_LIGHTS];\n#endif\n\n#endif\n\nvoid main() {\n    vNormal = normalMatrix * normal;\n\n#ifdef USE_MAP\n    vUv = uv;\n#endif\n\n#ifdef USE_COLOR\n    vColor = color;\n#endif\n\n    vec4 transformed = vec4(position, 1.0);\n    vec4 worldPosition = modelMatrix * transformed;\n    vec4 mvPosition = modelViewMatrix * transformed;\n    vViewDir = cameraPosition - worldPosition.xyz;\n    gl_Position = projectionMatrix * mvPosition;\n\n#ifdef USE_FOG\n    fogDepth = -mvPosition.z;\n#endif\n\n#ifdef USE_SHADOWMAP\n\n#if NUM_DIR_LIGHTS > 0\n    #pragma unroll_loop\n    for (int i = 0; i < NUM_DIR_LIGHTS; i++){\n        vDirectionalShadowCoord[i] = directionalShadowMatrix[i] * worldPosition;\n    }\n#endif\n\n#endif\n}\n",a="\n#include <common>\n#include <packing>\n#include <bsdf>\n#include <tonemapping_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <fog_pars_fragment>\n\nuniform vec4 diffuse;\nuniform vec4 specular;\nuniform vec3 emissiveColor;\nuniform vec3 wrapRGB;\n\nvarying vec3 vNormal;\nvarying vec3 vViewDir;\n\nstruct DirectionalLight {\n    vec3 color;\n    vec3 direction;\n    int shadow;\n};\n\n#ifdef USE_COLOR\n    varying vec3 vColor;\n#endif\n\n#if NUM_DIR_LIGHTS > 0\n    uniform DirectionalLight directionalLights[NUM_DIR_LIGHTS];\n#endif\n\n#ifdef USE_SHADOWMAP\n\n#if NUM_DIR_LIGHTS > 0\n    uniform sampler2D directionalShadowMap[NUM_DIR_LIGHTS];\n    varying vec4 vDirectionalShadowCoord[NUM_DIR_LIGHTS];\n#endif\n\n#endif\n\n#ifdef USE_MAP\n    uniform sampler2D map;\n    varying vec2 vUv;\n#endif\n\n#ifdef USE_GLOSSMAP\n    uniform sampler2D glossMap;\n#endif\n\n#ifdef USE_BUMPMAP\n    uniform sampler2D bumpMap;\n    uniform float bumpScale;\n#endif\n\n#ifdef USE_SHADOWMAP\n    float getShadow(in sampler2D shadowMap, in vec4 shadowCoord) {\n        float shadow = 1.0;\n        if (shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0 && shadowCoord.z <= 1.0) {\n        #ifdef DEPTH_PACKING\n            float depth = unpackRGBAToDepth(texture2D(shadowMap, shadowCoord.xy));\n        #else\n            float depth = 1.0 - texture2D(shadowMap, shadowCoord.xy).r;\n        #endif\n            shadow = shadowCoord.z - 0.005 > depth ? 0.0: 1.0;\n        }\n        return shadow;\n    }\n#endif\n\nvoid main() {\n    vec3 totalDiffuse = vec3(0.0);\n    vec3 totalSpecular = vec3(0.0);\n\n    vec3 normal = normalize(vNormal);\n    vec3 viewDir = normalize(vViewDir);\n\n    vec4 diffuse = diffuse;\n\n#ifdef USE_COLOR\n    diffuse.rgb *= vColor;\n#endif\n\n#ifdef USE_MAP\n    vec4 texelColor = texture2D(map, vUv);\n#ifdef GAMMA_INPUT\n    texelColor.rgb *= texelColor.rgb;\n#endif\n    diffuse *= texelColor;\n#endif\n\n    vec3 specularColor = specular.rgb;\n    float shininess = specular.a;\n\n#ifdef USE_GLOSSMAP\n    vec4 texelGloss = texture2D(glossMap, vUv);\n    shininess *= exp2(13.0 * texelGloss.x + 1.0);\n#endif\n\n    float roughness = saturate(sqrt(8.0 / (shininess + 7.0)));\n\n#ifdef USE_BUMPMAP\n    normal = perturbNormalArb(-vViewDir, normal, dHdxy_fwd(bumpMap, vUv, bumpScale));\n#endif\n\n#if NUM_DIR_LIGHTS > 0\n    DirectionalLight directionalLight;\n    \n    #pragma unroll_loop\n    for (int i = 0; i < NUM_DIR_LIGHTS; i++) {\n        directionalLight = directionalLights[i];\n\n        vec3 lightDir = directionalLight.direction;\n        vec3 halfDir = normalize(lightDir + viewDir);\n\n        float dotnl = dot(normal, lightDir);\n        float dotNL = saturate(dotnl);\n        float dotNH = saturate(dot(normal, halfDir));\n        float dotLH = saturate(dot(lightDir, halfDir));\n\n        vec3 irradiance = directionalLight.color;\n\n    #ifndef PHYSICALLY_CORRECT_LIGHTS\n        irradiance *= PI; //精准光源，不需要积分，不需要除以PI配平，所以这里乘以PI用来消除BRDF中的1/PI\n    #endif\n\n    #ifdef USE_SHADOWMAP\n        irradiance *= directionalLight.shadow == 1 ? getShadow(directionalShadowMap[i], vDirectionalShadowCoord[i]): 1.0;\n    #endif\n\n        vec3 fresnel = F_Schlick(specularColor, dotLH);\n\n    #ifdef WRAP_AROUND\n        totalDiffuse += irradiance * BRDF_Diffuse_Lambert(diffuse.rgb) * (1.0 - fresnel) * mix(vec3(dotNL), vec3(0.25 * dotnl + 0.25), wrapRGB);\n    #else\n        totalDiffuse += irradiance * BRDF_Diffuse_Lambert(diffuse.rgb) * (1.0 - fresnel) * dotNL;\n    #endif\n        \n    #ifdef BRDF_GGX\n        float dotNV = saturate(dot(normal, viewDir));\n        totalSpecular += irradiance * BRDF_Specular_GGX2(roughness, dotNL, dotNV, dotNH) * specularColor * fresnel * dotNL;\n    #else\n        totalSpecular += irradiance * BRDF_Specular_BlinnPhong2(shininess, dotNH) * specularColor * fresnel * dotNL;\n    #endif\n    }\n#endif\n\n    vec3 outgoingLight = totalDiffuse + totalSpecular;\n    gl_FragColor = vec4(outgoingLight, diffuse.a);\n\n    #include <tonemapping_fragment>\n    #include <fog_fragment>\n}\n";t.PhongMaterial=class extends r.Material{constructor(e={}){super({vertexShader:o,fragmentShader:a,side:e.side,blending:e.blending,defines:e.defines,extensions:e.extensions}),this.bumpScale=1,this.opacity=1,this.shininess=32,this.diffuseColor=new s.Color(16777215),this.emissiveColor=new s.Color(0),this.specularColor=new s.Color(1118481),this.wrapRGB=null,this._diffuse=new n.Vec4,this._specular=new n.Vec4,this.name=e.name,this.setTexture2D("map",e.url),this.setTexture2D("bumpMap",e.bumpUrl),this.setTexture2D("glossMap",e.glossUrl),this.bumpScale=void 0!==e.bumpScale?e.bumpScale:this.bumpScale,this.opacity=void 0!==e.opacity?e.opacity:this.opacity,this.shininess=void 0!==e.shininess?e.shininess:this.shininess,this.diffuseColor=void 0!==e.diffuse?new s.Color(e.diffuse):this.diffuseColor,this.emissiveColor=void 0!==e.emissive?new s.Color(e.emissive):this.emissiveColor,this.specularColor=void 0!==e.specular?new s.Color(e.specular):this.specularColor,this.wrapRGB=e.wrapRGB||this.wrapRGB}get diffuse(){let e=this.diffuseColor;return this._diffuse.set(e.r,e.g,e.b,this.opacity)}get specular(){let e=this.specularColor;return this._specular.set(e.r,e.g,e.b,this.shininess)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(4),s=i(2);t.Pass=class{constructor(e){this.enabled=!0,this.material=e.material||new r.Material({vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,side:s.SideType.Double}),this.setUniforms(e.uniforms),this.renderTarget=e.renderTarget,this.beforeRender=e.beforeRender||this.beforeRender,this.afterRender=e.afterRender||this.afterRender}setUniforms(e){return e&&Object.defineProperties(this.material,e),this}addTo(e){return e.addPass(this),this}setUniform(e,t){return this.material[e]=t,this}beforeRender(e,t){}afterRender(e,t){}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(8);t.RenderTarget=class{constructor(e){this.texture=new r.Texture2D(e)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(){this.element=!1,this.byteStride=0,this.byteOffset=0,this.bytesPer=0,this.count=0}set(e){let{data:t,element:i,stride:r=0,offset:s=0}=e,n=4;return t instanceof Uint16Array?n=Uint16Array.BYTES_PER_ELEMENT:t instanceof Uint32Array?n=Uint32Array.BYTES_PER_ELEMENT:t instanceof Float32Array?n=Float32Array.BYTES_PER_ELEMENT:i?(t=new Uint16Array(t),n=Uint16Array.BYTES_PER_ELEMENT):(t=new Float32Array(t),n=Float32Array.BYTES_PER_ELEMENT),this.values=t,this.element=i,this.count=r>0?t.length/r:t.length,this.byteStride=r?r*this.bytesPer:this.byteStride,this.byteOffset=s?s*this.bytesPer:this.byteOffset,this.bytesPer=n,this}copy(e){return this.byteStride=e.byteStride,this.byteOffset=e.byteOffset,this.bytesPer=e.bytesPer,this.element=e.element,this.values=e.values,this.count=e.count,this}clone(){return(new r).copy(this)}}t.BufferView=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Clock=class{constructor(){this.diffTime=0,this.nowTime=0,this.oldTime=0}getDelta(){return this.nowTime=Date.now(),0===this.oldTime?this.oldTime=this.nowTime:(this.diffTime=this.nowTime-this.oldTime,this.oldTime=this.nowTime),.001*this.diffTime}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(1),s=i(20),n=i(27),o=i(43);t.Scene=class extends r.Object3D{constructor(){super(...arguments),this.type=r.ObjectType.Scene,this.backgournd=null,this.monitor=null,this.fog=null}setBackground(e){return e?(this.backgournd=s.MeshBuilder.Box(),this.backgournd.material=new n.CubeMaterial({urls:e})):this.backgournd=null,this}beforeRender(e){return e.backgournd=this.backgournd,this.fog&&e.setClearColor(this.fog.color),this}afterRender(e){return null===this.monitor&&(this.monitor=new o.Monitor),this.monitor.update(e),this}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(10),s=i(21),n=i(22),o=i(23),a=i(24),h=i(25),l=i(42);t.MeshBuilder=class{static Sphere(e=1,t=10){let i=new r.Mesh(new s.SphereGeometryICO(t));return i.scale.set(e),i}static Box(e=1,t=e,i=e){let s=new r.Mesh(new o.CubeGeometry);return s.scale.set(e,t,i),s}static Plane(e=1,t=e,i=1,s=1){let o=new r.Mesh(new n.PlaneGeometry(i,s));return o.scale.set(e,t),o}static DepthPlane(e=1,t=e,i){let s=new r.Mesh(new n.PlaneGeometry(1,1),new a.UnpackDepthMaterial({map:i}));return s.scale.set(e,t),s}static Model(e,t,i){if(e.url.endsWith(".obj"))return(new h.OBJLoader).load(e,t,i);if(e.url.endsWith(".json"))return(new l.JSONLoader).load(e,t,i);throw Error("not support now: "+e.url)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(7),s=i(0);let{max:n,floor:o,PI:a,cos:h,sin:l}=Math;t.SphereGeometryICO=class extends r.Geometry{constructor(e=10){super();let t,i,r,n=[],o=[],a=[],h=[],l=new s.Vec3,d=new s.Vec3,c=!1,u=[],p={},f=[];function m(e){let t=JSON.stringify(e);return void 0===p[t]&&(p[t]=f.length,f.push(e)),p[t]}function g(e,t=1){return e*t+(e-e*e)/2}function _(e,t,i){return c?n.push(e,t,i):n.push(e,i,t)}for(let s=0;s<8;s++){d.set(2*(1&s)-1,(2&s)-1,(4&s)/2-1),c=d.x*d.y*d.z>0,u.length=0;for(let s=0;s<=e;s++){t=s/e;for(let n=0;s+n<=e;n++)i=n/e,r=(e-s-n)/e,u.push(m({vertex:l.set(g(t),g(i),g(r)).normalize().multiply(d).toArray([]),uv:d.y>0?[1-t,r]:[r,1-t]}));if(s>0)for(let r=0;s+r<=e;r++)t=g(s-1,e+1)+r,i=g(s,e+1)+r,_(u[t],u[t+1],u[i]),s+r<e&&_(u[i],u[t+1],u[i+1])}}for(let e of f)o.push(...e.vertex),a.push(...e.vertex),h.push(...e.uv);this.set({uv:h,position:o,normal:a,indice:n})}};t.SphereGeometryUV=class extends r.Geometry{constructor(e,t,i,r,d,c){super(),e=n(3,o(e)||8),t=n(2,o(t)||6),i=void 0!==i?i:0,r=void 0!==r?r:2*a;let u,p,f=(d=void 0!==d?d:0)+(c=void 0!==c?c:a),m=0,g=[],_=new s.Vec3,v=new s.Vec3,y=[],x=[],M=[],w=[];for(p=0;p<=t;p++){let s=[],n=p/t,o=0==p?.5/e:p==t?-.5/e:0;for(u=0;u<=e;u++){let t=u/e;_.x=-h(i+t*r)*l(d+n*c),_.y=h(d+n*c),_.z=l(i+t*r)*l(d+n*c),x.push(_.x,_.y,_.z),_.normalize(v),M.push(v.x,v.y,v.z),w.push(t+o,1-n),s.push(m++)}g.push(s)}for(p=0;p<t;p++)for(u=0;u<e;u++){let e=g[p][u+1],i=g[p][u],r=g[p+1][u],s=g[p+1][u+1];(0!==p||d>0)&&y.push(e,i,s),(p!==t-1||f<a)&&y.push(i,r,s)}this.set({uv:w,position:x,normal:M,indice:y})}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(7);t.PlaneGeometry=class extends r.Geometry{constructor(e=1,t=e){super();let i=[],r=[],s=[],n=[];for(let o=0;o<=t;o++){let a=o/t;for(let h=0;h<=e;h++){let l=h/e;if(r.push(2*l-1,2*a-1,0),s.push(0,0,1),n.push(l,a),h<e&&o<t){let t=h+o*(e+1);i.push(t,t+1,t+e+1),i.push(t+e+1,t+1,t+e+2)}}}this.set({uv:n,position:r,normal:s,indice:i})}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(7);let s=[[0,4,2,6,-1,0,0],[1,3,5,7,1,0,0],[0,1,4,5,0,-1,0],[2,6,3,7,0,1,0],[0,2,1,3,0,0,-1],[4,5,6,7,0,0,1]];t.CubeGeometry=class extends r.Geometry{constructor(){super();let e=[],t=[],i=[],r=[];for(let n=0;n<s.length;n++){let o=s[n],a=4*n;for(let e=0;e<4;e++){let s=o[e];t.push(2*(1&s)-1,(2&s)-1,(4&s)/2-1),i.push(o[4],o[5],o[6]),r.push(1&e,(2&e)/2)}e.push(a,a+1,a+2),e.push(a+2,a+1,a+3)}this.set({uv:r,position:t,normal:i,indice:e})}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(4);let s="\nvarying vec2 vUv;\n\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    vUv = uv;\n}\n",n="\n#include <packing>\n\nuniform sampler2D map;\nvarying vec2 vUv;\n\nvoid main() {\n\n#ifdef DEPTH_PACKING\n    float depth = 1.0 - unpackRGBAToDepth(texture2D(map, vUv));\n    gl_FragColor = vec4(vec3(depth), 1.0);\n#else\n    gl_FragColor = texture2D(map, vUv);\n#endif\n}\n";t.UnpackDepthMaterial=class extends r.Material{constructor(e){super({vertexShader:s,fragmentShader:n}),this.map=e.map||this.map}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(1),s=i(5),n=i(13),o=i(10),a=i(6),h=i(26),l=i(7);class d{constructor(e,t=-1){this.vertices=[],this.colors=[],this.normals=[],this.uvs=[],this.groups=[],this.faceType=-1,this.mtllist=[],this.name="",this.name=e,this.faceType=t}addGroup(){return this.groups.push(this.vertices.length/3),this}getMesh(e){let t=(new l.Geometry).set({position:this.vertices,color:this.colors,normal:this.normals,uv:this.uvs});this.addGroup();let i=[],r=[];for(let s=0;s+1<this.groups.length;s++)i.push((new n.Group).set({bv:t.position,start:this.groups[s],count:this.groups[s+1]-this.groups[s],materialIndex:s})),r.push(e.find(e=>e.name===this.mtllist[s]));t.setGroups(i),t.checkComplete();let s=new o.Mesh(t,r);return s.name=this.name,s}}t.OBJLoader=class{constructor(){this.rootPath=null,this.buffer=new d(""),this.output=null,this.outputList=[],this.mtllib=""}load(e,t,i){return this.rootPath=this.rootPath||s.dirname(e.url),a.loadText(e.url,s=>{let n,o="",a=new Array(128),l=0,d=0,c=s.length;for(let e=0;e<c;e++)switch(n=s[e]){case" ":o.length>0&&(a[l++]=o),o="";break;case"/":o.length>0&&(a[l++]=o),o="",d++;break;case"\n":o.length>0&&(a[l++]=o),o="",this.processLine(a,l,d),l=0,d=0;break;case"\r":break;default:o+=n}(new h.MTLLoader).load({url:this.mtllib,createMaterial:e.createMaterial},e=>{let i=new r.Object3D;for(let t of this.outputList)i.add(t.getMesh(e));t&&t(i)},i)},i),this}processLine(e,t,i){if(0!==t)switch(e[0]){case"v":this.buffer.vertices.push(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])),t>4&&this.buffer.colors.push(parseFloat(e[4]),parseFloat(e[5]),parseFloat(e[6]));break;case"vt":this.buffer.uvs.push(parseFloat(e[1]),parseFloat(e[2]));break;case"vn":this.buffer.normals.push(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]));break;case"f":let r=t-1;if(0===i){this.checkFaceType(0);for(let i=2;i+1<t;i++)this.buildFace(e[1]),this.buildFace(e[i]),this.buildFace(e[i+1])}else if(r===2*i){this.checkFaceType(1);for(let i=3;i+3<t;i+=2)this.buildFace(e[1],e[2]),this.buildFace(e[i],e[i+1]),this.buildFace(e[i+2],e[i+3])}else if(2*r==3*i){this.checkFaceType(2);for(let i=4;i+5<t;i+=3)this.buildFace(e[1],e[2],e[3]),this.buildFace(e[i],e[i+1],e[i+2]),this.buildFace(e[i+3],e[i+4],e[i+5])}else{this.checkFaceType(3);for(let i=3;i+3<t;i+=2)this.buildFace(e[1],null,e[2]),this.buildFace(e[i],null,e[i+1]),this.buildFace(e[i+2],null,e[i+3])}break;case"l":case"p":case"s":case"g":break;case"o":let s=this.output&&this.output.faceType||-1;this.output=new d(e[1],s),this.outputList.push(this.output);break;case"mtllib":this.mtllib=this.rootPath+e[1];break;case"usemtl":this.output.addGroup(),this.output.mtllist.push(e[1])}}checkFaceType(e){-1===this.output.faceType?this.output.faceType=e:this.output.faceType!==e&&(this.output=new d(this.output.name+e,e),this.outputList.push(this.output))}buildFace(e,t,i){let r=parseInt(e),s=3*(r>0?r-1:r+this.buffer.vertices.length/3),n=this.buffer.colors.length>0?s:null,o=this.buffer.vertices;if(this.output.vertices.push(o[s++],o[s++],o[s]),null!==n){let e=this.buffer.colors;this.output.colors.push(e[n++],e[n++],e[n])}if(t){let e=parseInt(t),i=2*(e>0?e-1:e+this.buffer.uvs.length/2),r=this.buffer.uvs;this.output.uvs.push(r[i++],r[i])}if(i){let e=parseInt(i),t=3*(e>0?e-1:e+this.buffer.normals.length/3),r=this.buffer.normals;this.output.normals.push(r[t++],r[t++],r[t])}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(6),s=i(5),n=i(3),o=i(8),a=i(2),h=i(14);class l{constructor(){this.shininess=0,this.emissive=new n.Color,this.diffuse=new n.Color,this.specular=new n.Color}}t.Buffer=l;t.MTLLoader=class{constructor(){this.rootPath=null,this.output=new l,this.outputList=[]}load(e,t,i){return this.rootPath=this.rootPath||s.dirname(e.url),r.loadText(e.url,i=>{let r,s="",n=new Array(128),o=0,a=i.length;for(let e=0;e<a;e++)switch(r=i[e]){case" ":s.length>0&&(n[o++]=s),s="";break;case"\n":s.length>0&&(n[o++]=s),s="",this.processLine(n,o),o=0;break;case"\r":break;default:s+=r}let l=[];for(let t of this.outputList)l.push(e.createMaterial&&e.createMaterial(t)||new h.PhongMaterial(t));t&&t(l)},i),this}processLine(e,t){if(0!==t)switch(e[0].toLowerCase()){case"newmtl":this.output=new l,this.output.name=e[1],this.outputList.push(this.output);break;case"ns":this.output.shininess=parseFloat(e[1]);break;case"ka":this.output.emissive.set(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]));break;case"kd":this.output.diffuse.set(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]));break;case"ks":this.output.specular.set(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]));break;case"map_kd":this.output.url=new o.Texture2D({url:this.rootPath+e[1],wrapS:a.WrappingType.Repeat});break;case"map_bump":this.output.bumpUrl=new o.Texture2D({url:this.rootPath+e[1],wrapS:a.WrappingType.Repeat})}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(4),s=i(28),n=i(2);let o="\nvarying vec3 vWorldDirection;\n\nvoid main() {\n    vWorldDirection = normalize(position);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    gl_Position.z = gl_Position.w; //令 z/w = 1.0, 这样可以欺骗深度测试认为天空盒的深度为最大深度1.0，用于通过深度测试，将天空盒放最后渲染，可以得到轻微的性能提升，避免覆盖渲染。\n}\n",a="\nuniform samplerCube map;\nvarying vec3 vWorldDirection;\n\nvoid main() {\n    gl_FragColor = textureCube(map, vWorldDirection);\n}\n";t.CubeMaterial=class extends r.Material{constructor(e={}){super({vertexShader:o,fragmentShader:a}),this.side=n.SideType.Back,this.map=e.urls instanceof s.TextureCube?e.urls:e.urls?new s.TextureCube({urls:e.urls}):null,this.map.onLoad=this.onLoad}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(2),s=i(5),n=i(6);let o=1e4;t.TextureCube=class{constructor(e={}){this.id=o++,this.urls=[],this.formats=[],this.width=1,this.height=1,this.flipY=!1,this.images=[],this.dataType=r.DataType.UnsignedByte,this.magFilter=r.FilterType.Linear,this.minFilter=r.FilterType.Linear,this.wrapS=r.WrappingType.ClampToEdge,this.wrapT=r.WrappingType.ClampToEdge,this.anisotropy=1,this.needUpdate=!1,this.urls=e.urls||this.urls,this.width=e.width||this.width,this.height=e.height||this.height,this.flipY=void 0!==e.flipY?e.flipY:this.flipY,this.dataType=e.dataType||this.dataType,this.magFilter=e.magFilter||this.magFilter,this.minFilter=e.minFilter||this.magFilter,this.wrapS=e.wrapS||this.wrapS,this.wrapT=e.wrapT||this.wrapS,this.anisotropy=e.anisotropy||this.anisotropy;for(let t=0;t<this.urls.length;t++){let i=this.urls[t];this.formats[t]=e.formats&&e.formats[t]||s.getImageFormat(i),n.loadImage(i,e=>{this.images[t]=e,this.needUpdate=t+1>=this.urls.length,this.needUpdate&&this.onLoad&&this.onLoad()})}}onLoad(){}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let r=[];var s=[];let n=new Float32Array(9),o=new Float32Array(16);function a(e,t){let i,s=e.length,n=s*t,o=r[n];void 0===o&&(o=r[n]=new Float32Array(n));for(let r=0,n=0;r<s;++r,n+=t)(i=e[r])&&i.toArray(o,n);return o}function h(e,t){let i=t,s=r[i];return void 0===s&&(s=r[i]=new Float32Array(i)),e.toArray(s),s}function l(e,t){var i=s[t];void 0===i&&(i=new Int32Array(t),s[t]=i);for(var r=0;r!==t;++r)i[r]=e.getTextureUnit();return i}class d{constructor(e,t,i){this.id=e,this.addr=t,this.info=i}setValue(e,t,i){if(null==i)return this;const{info:r,addr:s}=this;switch(r.type){case e.INT:e.uniform1i(s,i);break;case e.FLOAT:e.uniform1f(s,i);break;case e.FLOAT_VEC2:e.uniform2fv(s,h(i,2));break;case e.FLOAT_VEC3:e.uniform3fv(s,h(i,3));break;case e.FLOAT_VEC4:e.uniform4fv(s,h(i,4));break;case e.FLOAT_MAT3:n.set(i.elements),e.uniformMatrix3fv(s,!1,n);break;case e.FLOAT_MAT4:o.set(i.elements),e.uniformMatrix4fv(s,!1,o);break;case e.SAMPLER_2D:{let r=t.getTextureUnit();e.uniform1i(s,r),t.useTexture2D(i,r);break}case e.SAMPLER_CUBE:{let r=t.getTextureUnit();e.uniform1i(s,r),t.useTextureCube(i,r);break}default:throw Error("uniform type invalid "+r.type)}return this}}class c extends d{setValue(e,t,i){if(null==i)return this;const{info:r,addr:s}=this;switch(r.type){case e.INT:e.uniform1iv(s,i);break;case e.FLOAT:e.uniform1fv(s,i);break;case e.FLOAT_VEC2:e.uniform2fv(s,a(i,2));break;case e.FLOAT_VEC3:e.uniform3fv(s,a(i,3));break;case e.FLOAT_VEC4:e.uniform4fv(s,a(i,4));break;case e.FLOAT_MAT3:e.uniformMatrix3fv(s,!1,a(i,9));break;case e.FLOAT_MAT4:e.uniformMatrix4fv(s,!1,a(i,16));break;case e.SAMPLER_2D:{let r=i.length,n=l(t,r);e.uniform1iv(s,n);for(let e=0;e<r;e++)t.useTexture2D(i[e],n[e]);break}case e.SAMPLER_CUBE:{let r=i.length,n=l(t,r);e.uniform1iv(s,n);for(let e=0;e<r;e++)t.useTextureCube(i[e],n[e]);break}default:throw Error("ArrayUniform.setValue: invalid type "+r.type)}return this}}class u{constructor(e,t,i){this.id=e,this.addr=t,this.info=i}setValue(e,t,i){if(null==i)return this;const{byteStride:r,byteOffset:s}=i,{info:n,addr:o}=this;switch(t.useBufferView(i),n.type){case e.INT:e.vertexAttribPointer(o,1,e.INT,!1,r,s);break;case e.INT_VEC2:e.vertexAttribPointer(o,2,e.INT,!1,r,s);break;case e.INT_VEC3:e.vertexAttribPointer(o,3,e.INT,!1,r,s);break;case e.INT_VEC4:e.vertexAttribPointer(o,4,e.INT,!1,r,s);break;case e.FLOAT:e.vertexAttribPointer(o,1,e.FLOAT,!1,r,s);break;case e.FLOAT_VEC2:e.vertexAttribPointer(o,2,e.FLOAT,!1,r,s);break;case e.FLOAT_VEC3:e.vertexAttribPointer(o,3,e.FLOAT,!1,r,s);break;case e.FLOAT_VEC4:e.vertexAttribPointer(o,4,e.FLOAT,!1,r,s);break;case e.FLOAT_MAT2:e.vertexAttribPointer(o,2,e.FLOAT,!1,r,s);break;case e.FLOAT_MAT3:e.vertexAttribPointer(o,3,e.FLOAT,!1,r,s);break;case e.FLOAT_MAT4:e.vertexAttribPointer(o,4,e.FLOAT,!1,r,s);break;default:throw Error("attribute type invalid "+n.type)}return e.enableVertexAttribArray(o),this}}class p{constructor(e){this.seq=[],this.map={},this.id=e}add(e){return this.seq.push(e),this.map[e.id]=e,this}setValue(e,t,i){if(null==i)return this;for(let r of this.seq)r.setValue(e,t,i[r.id]);return this}}function f(e,t){let{map:i,seq:r}=e,s=i[t];return void 0===s&&(s=i[t]=new p(t),r.push(s)),s}let m=/(\w+)(\[\d+\])?(\.\w+)?/;function g(e,t,i){let r=t.name.match(m),s=r[1],n=r[2],o=r[3];if(s)if(o){let r=f(e,s);void 0!==n&&(r=f(r,n.substr(1,n.length-2))),r.add(new d(o.substr(1),i,t))}else void 0!==n?e.add(new c(s,i,t)):e.add(new d(s,i,t));return e}t.Program=class{constructor(e,t,i){function r(t,i,r="shader"){let s=e.createShader(t);if(e.shaderSource(s,i),e.compileShader(s),!e.getShaderParameter(s,e.COMPILE_STATUS))throw Error(`${r}: \n`+e.getShaderInfoLog(s));return s}this.attributes=new p("attributes"),this.uniforms=new p("uniforms"),this.textureUnit=0;let s=r(e.VERTEX_SHADER,t,"vertex shader"),n=r(e.FRAGMENT_SHADER,i,"fragment shader"),o=e.createProgram();if(e.attachShader(o,s),e.attachShader(o,n),e.linkProgram(o),!e.getProgramParameter(o,e.LINK_STATUS))throw Error("shader program: \n"+e.getProgramInfoLog(o));e.deleteShader(s),e.deleteShader(n);let a=e.getProgramParameter(o,e.ACTIVE_UNIFORMS);for(let t=0;t<a;t++){let i=e.getActiveUniform(o,t),r=e.getUniformLocation(o,i.name);g(this.uniforms,i,r)}let h=e.getProgramParameter(o,e.ACTIVE_ATTRIBUTES);for(let t=0;t<h;t++){let i=e.getActiveAttrib(o,t),r=e.getAttribLocation(o,i.name);this.attributes.add(new u(i.name,r,i))}this.webglprogram=o}use(e){return e.useProgram(this.webglprogram),this}setUniform(e,t,i,r){let s=this.uniforms.map[i];return s&&s.setValue(e,t,r),this}setAttribute(e,t,i,r){let s=this.attributes.map[i];return s&&s.setValue(e,t,r),this}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(31);t.ShadowMap=class{render(e){let t=e.shadowLights;if(0===t.length)return this;e.save();for(let i of t)e.useRenderTarget(i.shadow.renderTarget),this.renderObjects(i,e);return e.restore(),this}renderObjects(e,t){let i=e.shadow,s=i.matrix,n=i.camera;if(void 0===n)return console.error("ShadowMap.renderLight",e,"dont`t has camera"),this;n.position.copy(e.worldPosition),n.lookAt(e.target.worldPosition),s.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),s.multiply(n.projectionMatrix),s.multiply(n.viewMatrix),void 0===this.depthMaterial&&(this.depthMaterial=new r.DepthMaterial);for(let e of t.renderList)t.renderDepth(e,n,this.depthMaterial);return this}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(4);let s="\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n",n="\n#include <packing>\n\nvoid main() {\n\n#ifdef DEPTH_PACKING\n    gl_FragColor = packDepthToRGBA(gl_FragCoord.z);\n#else\n    gl_FragColor = vec4(vec3(1.0 - gl_FragCoord.z), 1.0); // gl_FragCoord.z的坐标范围是[0, 1]，这里用1.0减去z的原因是，纹理默认是值是0\n#endif\n\n}\n";t.DepthMaterial=class extends r.Material{constructor(){super({vertexShader:s,fragmentShader:n})}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ShaderChunk={common:"\n#define PI 3.14159265359\n#define RECIPROCAL_PI 0.31830988618\n#define LOG2 1.442695\n#define EPSILON 1e-6\n\n#define saturate(a) clamp(a, 0.0, 1.0)\n#define whiteCompliment(a)(1.0 - saturate(a))\n\nfloat pow2( const in float x ) { return x*x; }\n",packing:"\nconst float PackUpscale = 256. / 255.; // fraction -> 0..1 (including 1)\nconst float UnpackDownscale = 255. / 256.; // 0..1 -> fraction (excluding 1)\n\nconst vec3 PackFactors = vec3(256. * 256. * 256., 256. * 256., 256.);\nconst vec4 UnpackFactors = UnpackDownscale / vec4(PackFactors, 1.);\n\nconst float ShiftRight8 = 1. / 256.;\n\nvec4 packDepthToRGBA(in float v) {\n    vec4 r = vec4(fract(v * PackFactors), v);\n    r.yzw -= r.xyz * ShiftRight8; // tidy overflow\n    return r * PackUpscale;\n}\n\nfloat unpackRGBAToDepth(in vec4 v) {\n    return dot(v, UnpackFactors);\n}\n",bsdf:"\nvec3 F_Schlick(in vec3 specularColor, in float dotLH ) {\n\t// Original approximation by Christophe Schlick '94\n\t// float fresnel = pow( 1.0 - dotLH, 5.0 );\n\n\t// Optimized variant (presented by Epic at SIGGRAPH '13)\n\t// https://cdn2.unrealengine.com/Resources/files/2013SiggraphPresentationsNotes-26915738.pdf\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\n\nfloat G_BlinnPhong_Implicit() {\n    //(n dot l)(n dot v) / 4(n dot l)(n dot v) //分子是G_Implicit，分母是brdf的分母项，这里非常数项抵消了\n    return 0.25;\n}\n\n// http://www.cs.uu.nl/docs/vakken/magr/2016-2017/slides/lecture%2013%20-%20BRDFs.pdf\nfloat D_BlinnPhong(in float shininess, in float dotNH) {\n    // (shininess + 2) / (2 * PI) * pow(cos(N,H), shininess)\n    return RECIPROCAL_PI * (shininess * 0.5 + 1.0)  * pow(dotNH, shininess);\n}\n\nvec3 BRDF_Specular_BlinnPhong(in vec3 specularColor, in float shininess, in vec3 lightDir, in vec3 viewDir, in vec3 normal) {\n    vec3 halfDir = normalize(lightDir + viewDir);\n    float dotNH = saturate(dot(normal, halfDir));\n    float dotLH = saturate(dot(lightDir, halfDir));\n    // DFG / 4(n dot l)(n dot v), 分母在G项中抵消了\n    vec3 F = F_Schlick(specularColor, dotLH);\n    float G = G_BlinnPhong_Implicit();\n    float D = D_BlinnPhong(shininess, dotNH);\n    return F * (G * D); //两个标量先乘再乘向量，减少与向量的运算\n}\n\nfloat BRDF_Specular_BlinnPhong2(in float shininess, in float dotNH) {\n    float G = G_BlinnPhong_Implicit();\n    float D = D_BlinnPhong(shininess, dotNH);\n    return G * D; //两个标量先乘再乘向量，减少与向量的运算\n}\n\n// Moving Frostbite to Physically Based Rendering 3.0 - page 12, listing 2\n// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n    float a2 = pow2(alpha);\n\n    // dotNL and dotNV are explicitly swapped. This is not a mistake.\n    float gv = dotNL * sqrt(a2 + (1.0 - a2) * pow2(dotNV));\n    float gl = dotNV * sqrt(a2 + (1.0 - a2) * pow2(dotNL));\n\n    return 0.5 / max(gv + gl, EPSILON);\n}\n\n// Microfacet Models for Refraction through Rough Surfaces - equation (33)\n// http://graphicrants.blogspot.com/2013/08/specular-brdf-reference.html\n// alpha is \"roughness squared\" in Disney’s reparameterization\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n    float a2 = pow2(alpha);\n    float denom = pow2(dotNH) * (a2 - 1.0) + 1.0; // avoid alpha = 0 with dotNH = 1\n    return RECIPROCAL_PI * a2 / pow2(denom);\n}\n\n// GGX Distribution, Schlick Fresnel, GGX-Smith Visibility\nvec3 BRDF_Specular_GGX(in vec3 specularColor, in float roughness, in vec3 lightDir, in vec3 viewDir, in vec3 normal) {\n    float alpha = pow2(roughness); // UE4's roughness\n    vec3 halfDir = normalize(lightDir + viewDir);\n\n    float dotNL = saturate(dot(normal, lightDir));\n    float dotNV = saturate(dot(normal, viewDir));\n    float dotNH = saturate(dot(normal, halfDir));\n    float dotLH = saturate(dot(lightDir, halfDir));\n\n    vec3 F = F_Schlick(specularColor, dotLH);\n    float G = G_GGX_SmithCorrelated(alpha, dotNL, dotNV);\n    float D = D_GGX(alpha, dotNH);\n    return F * (G * D);\n}\n\nfloat BRDF_Specular_GGX2(in float roughness, in float dotNL, in float dotNV, in float dotNH) {\n    float alpha = pow2(roughness); // UE4's roughness\n    float G = G_GGX_SmithCorrelated(alpha, dotNL, dotNV);\n    float D = D_GGX(alpha, dotNH);\n    return G * D;\n}\n\nvec3 BRDF_Diffuse_Lambert(in vec3 diffuseColor) {\n    return RECIPROCAL_PI * diffuseColor;\n}\n",tonemapping_fragment:"\n#ifdef TONE_MAPPING\n\tgl_FragColor.rgb = toneMapping(gl_FragColor.rgb);\n#endif\n",tonemapping_pars_fragment:"\n#ifdef TONE_MAPPING\nconst vec3 GAMMA = vec3(1.0 / 2.2);\nconst vec3 GAMMA_INVERSE = vec3(2.2);\nconst vec3 LUMA = vec3(0.2126, 0.7152, 0.0722);\n\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\n\nvec3 toneMapping(vec3 color){\n    vec3 outColor = color * toneMappingExposure;\n\n#if defined(TONEMAP_SIMPLE)\n    outColor = sqrt(max(outColor, vec3(0.0)));\n\n#elif defined(TONEMAP_LINEAR)\n    outColor = pow(max(outColor, vec3(0.0)), GAMMA);\n\n#elif defined(TONEMAP_REINHARD)\n    outColor = outColor / (1.0 + outColor);\n    outColor = pow(max(outColor, vec3(0.0)), GAMMA);\n\n#elif defined(TONEMAP_REINHARD_LUMA)\n    float luma = dot(outColor, LUMA);\n    float toneMappedLuma = luma / (1.0 + luma);\n    outColor *= toneMappedLuma / luma;\n    outColor = pow(max(outColor, vec3(0.0)), GAMMA);\n\n#elif defined(TONEMAP_REINHARD_WHITE)\n    float white = 2.0 * toneMappingWhitePoint;\n    float luma = dot(outColor, LUMA);\n    float toneMappedLuma = luma * (1.0 + luma / (white * white)) / (1.0 + luma);\n    outColor *= toneMappedLuma / luma;\n    outColor = pow(max(outColor, vec3(0.0)), GAMMA);\n\n#elif defined(TONEMAP_FILMIC)\n    vec3 x = max(vec3(0.0), outColor - 0.004);\n    outColor = (x * (6.2 * x + 0.5)) / (x * (6.2 * x + 1.7) + 0.06);\n    outColor = max(outColor, vec3(0.0));\n\n    #elif defined(TONEMAP_FILMIC_2015)\n    vec4 vh = vec4(outColor, toneMappingWhitePoint);\n    vec4 va = (1.425 * vh) + 0.05;\n    vec4 vf = ((vh * va + 0.004) / ((vh * (va + 0.55) + 0.0491))) - 0.0821;\n    outColor = vf.rgb / vf.www;\n    outColor = pow(max(outColor, vec3(0.0)), GAMMA);\n\n    #elif defined(TONEMAP_PHOTOGRAPHIC)\n    const float exposureBias = 3.0;\n    const float saturationBias = 1.3;\n    outColor = 1.0 - exp2(-exposureBias * outColor);\n    outColor = pow(max(outColor, vec3(0.0)), vec3(saturationBias / 2.2));\n\n#elif defined(TONEMAP_UNCHARTED)\n    float exposureBias = 2.0;\n    vec3 curr = Uncharted2Tonemap(exposureBias * outColor);\n    float white = W * toneMappingWhitePoint;\n    vec3 whiteScale = vec3(1.0) / Uncharted2Tonemap(vec3(white));\n    vec3 color = curr * whiteScale;\n    outColor = pow(max(color, vec3(0.0)), GAMMA);\n    \n#endif\n    return outColor;\n}\n#endif\n",bumpmap_pars_fragment:"\n#ifdef USE_BUMPMAP\n\n    // Bump Mapping Unparametrized Surfaces on the GPU by Morten S. Mikkelsen\n    // http://api.unrealengine.com/attachments/Engine/Rendering/LightingAndShadows/BumpMappingWithoutTangentSpace/mm_sfgrad_bump.pdf\n\n    // Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\n\n    vec2 dHdxy_fwd(in sampler2D sourceMap, in vec2 uv, in float sourceScale) {\n        vec2 dSTdx = dFdx(uv);\n        vec2 dSTdy = dFdy(uv);\n\n        float Hll = sourceScale * texture2D(sourceMap, uv).x;\n        float dBx = sourceScale * texture2D(sourceMap, uv + dSTdx).x - Hll;\n        float dBy = sourceScale * texture2D(sourceMap, uv + dSTdy).x - Hll;\n        return vec2(dBx, dBy);\n    }\n\n    vec3 perturbNormalArb(in vec3 surf_pos, in vec3 surf_norm, in vec2 dHdxy) {\n\n        // Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\n        vec3 vSigmaX = vec3(dFdx(surf_pos.x), dFdx(surf_pos.y), dFdx(surf_pos.z));\n        vec3 vSigmaY = vec3(dFdy(surf_pos.x), dFdy(surf_pos.y), dFdy(surf_pos.z));\n        vec3 vN = surf_norm;\t\t// normalized\n\n        vec3 R1 = cross(vSigmaY, vN);\n        vec3 R2 = cross(vN, vSigmaX);\n\n        float fDet = dot(vSigmaX, R1);\n\n        fDet *= (float(gl_FrontFacing) * 2.0 - 1.0);\n\n        vec3 vGrad = sign(fDet) * (dHdxy.x * R1 + dHdxy.y * R2);\n        return normalize(abs(fDet) * surf_norm - vGrad);\n    }\n#endif\n",fog_fragment:"\n#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\tfloat fogFactor = whiteCompliment(exp2(-fogDensity * fogDensity * fogDepth * fogDepth * LOG2));\n\t#else\n\tfloat fogFactor = smoothstep(fogNear, fogFar, fogDepth);\n\t#endif\n\tgl_FragColor.rgb = mix(gl_FragColor.rgb, fogColor, fogFactor);\n#endif\n",fog_pars_fragment:"\n#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif\n"}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Extensions=new class{constructor(){this.extensions={}}get(e,t){if(void 0!==this.extensions[t])return this.extensions[t];let i;switch(t){case"WEBGL_depth_texture":i=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=e.getExtension(t)}return null===i&&console.warn("Extensions: "+t+" extension not supported."),this.extensions[t]=i,i}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(1),s=i(3),n=i(0);t.Light=class extends r.Object3D{constructor(e,t){super(),this.type=r.ObjectType.Light,this.color=new s.Color(16777215),this.intensity=1,this.target=new r.Object3D,this.shadow=null,this._direction=new n.Vec3,this.color=new s.Color(e||this.color),this.intensity=t||this.intensity}get direction(){return this.worldPosition.sub(this.target.worldPosition,this._direction).normalize()}}},function(e,t,i){"use strict";function r(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),r(i(11)),r(i(12)),r(i(37)),r(i(9)),r(i(38)),r(i(39)),r(i(40)),r(i(0)),r(i(17)),r(i(18)),r(i(3)),r(i(13)),r(i(41)),r(i(2)),r(i(0)),r(i(10)),r(i(1)),r(i(15)),r(i(29)),r(i(44)),r(i(45)),r(i(16)),r(i(19)),r(i(48)),r(i(30)),r(i(8)),r(i(28)),r(i(49)),r(i(7)),r(i(22)),r(i(23)),r(i(21)),r(i(34)),r(i(50)),r(i(6)),r(i(26)),r(i(25)),r(i(51)),r(i(4)),r(i(27)),r(i(31)),r(i(14)),r(i(54)),r(i(24)),r(i(20)),r(i(32))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Event=class{constructor(){this.children=[],this.listeners={}}on(e,t){let i=this.listeners[e];return void 0===i&&(i=this.listeners[e]=[]),-1===i.indexOf(t)&&i.push(t),this}off(e,t){let i=this.listeners[e];if(void 0!==i){if(t){let e=i.indexOf(t);-1!==e&&i.splice(e,1)}else delete this.listeners[e];return this}}emit(e,t){let i=this.listeners[e];if(i)for(let e of i)e(t.data);if(t.bubble&&this.parent&&this.parent.emit(e,t),t.broadcost&&this.children)for(let i of this.children)i.emit(e,t);return this}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(11),s=i(1),n=i(0);t.PerspectiveCamera=class extends r.Camera{constructor(e,t,i,r){super(),this.type=s.ObjectType.PerspectiveCamera,this.fov=50,this.aspect=1,this.near=.1,this.far=1e3,this.fov=e||this.fov,this.aspect=t||this.aspect,this.near=i||this.near,this.far=r||this.far,this.updateProjectionMatrix()}updateProjectionMatrix(){return this.projectionMatrix.perspective(n.degToRad(this.fov),this.aspect,this.near,this.far),this}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(9),s=i(0),n=i(1);let{pow:o,tan:a,max:h,min:l,abs:d,PI:c}=Math;t.OrbitControl=class extends r.Component{constructor(){super(...arguments),this.target=new s.Vec3,this.zoomSpeed=1,this.dampScale=.8,this.enableDamping=!0,this.mode=0,this.isDragDirty=!1,this.isPanDirty=!1,this.offsetStart=new s.Vec2,this.offsetEnd=new s.Vec2,this.offsetDelta=new s.Vec2,this.spherical=new s.Spherical,this.dollyScale=1,this.update=(()=>{let e=new s.Vec3;return()=>{if(this.isDragDirty&&(this.isDragDirty=d(this.offsetDelta.x)>.001,this.object.position.sub(this.target,e),this.spherical.setFromVec3(e),this.spherical.theta-=s.degToRad(.5*this.offsetDelta.x),this.spherical.phi-=s.degToRad(.5*this.offsetDelta.y),this.spherical.phi=h(1e-5,l(c-1e-5,this.spherical.phi)),this.spherical.radius*=this.dollyScale,e.setFromSpherical(this.spherical),this.target.add(e,this.object.position),this.object.lookAt(this.target),this.dollyScale=1,this.enableDamping?this.offsetDelta.scale(this.dampScale):this.offsetDelta.set(0)),this.isPanDirty){if(this.isPanDirty=d(this.offsetDelta.x)>.001,this.object.position.sub(this.target,e),this.object.type===n.ObjectType.PerspectiveCamera){let t=2*e.length()*a(s.degToRad(.5*this.object.fov));this.pan(-this.offsetDelta.x*t/800,0),this.pan(this.offsetDelta.y*t/800,1)}else this.object.type===n.ObjectType.OrthoCamera&&(this.pan(-this.offsetDelta.x/(this.object.right-this.object.left),0),this.pan(this.offsetDelta.y/(this.object.top-this.object.bottom),1));this.target.add(e,this.object.position),this.enableDamping?this.offsetDelta.scale(this.dampScale):this.offsetDelta.set(0)}}})(),this.pan=(()=>{let e=new s.Vec3;return(t,i)=>{e.setFromMatrixColumn(this.object.matrix,i),e.scale(t),this.target.add(e)}})()}onLoad(){this.object.on("MouseDown",e=>{switch(e.button){case 0:this.mode=1;break;case 2:this.mode=2}}),this.object.on("MouseUp",e=>{this.mode=0,this.offsetStart.set(0),this.offsetEnd.set(0)}),this.object.on("MouseMove",e=>{0!==this.mode&&(this.offsetStart.set(e.offsetX,e.offsetY),0===this.offsetEnd.x&&0===this.offsetEnd.y&&this.offsetEnd.copy(this.offsetStart),this.offsetStart.sub(this.offsetEnd,this.offsetDelta),this.offsetEnd.copy(this.offsetStart),this.isDragDirty=1===this.mode,this.isPanDirty=2===this.mode)}),this.object.on("MouseWheel",e=>{e.deltaY>0?(this.dollyScale/=this.getZoomScale(),this.isDragDirty=!0):e.deltaY<0&&(this.dollyScale*=this.getZoomScale(),this.isDragDirty=!0)})}getZoomScale(){return o(.95,this.zoomSpeed)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(9),s=i(0);t.MouseTracing=class extends r.Component{constructor(){super(...arguments),this.mouse=new s.Vec2,this.target=new s.Vec2,this.screen=new s.Vec2}onLoad(){this.object.on("Resize",e=>{this.screen.set(e.screenWidth/2,e.screenHeight/2)}),this.object.on("MouseMove",e=>{this.mouse.x=.7*(e.clientX-this.screen.x),this.mouse.y=.5*(e.clientY-this.screen.y)})}init(e,t){return this.screen.set(e/2,t/2),this}update(e){this.mouse.scale(.001,this.target);let t=this.object.rotation;t.y+=.05*(this.target.x-t.y),t.x+=.05*(this.target.y-t.x)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(9),s=i(0);t.Gyroscope=class extends r.Component{constructor(){super(...arguments),this.rotationMatrix=new s.Mat4,this.quaternion=new s.Quat,this.quat=new s.Quat}start(){this.quat.setFromEuler(this.object.rotation)}update(e){let t=this.object.parent;t&&(t.modelMatrix.getRatationMatrix(this.rotationMatrix),this.quaternion.setFromRotationMatrix(this.rotationMatrix),this.quaternion.invert().multiply(this.quat,this.object.quaternion))}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(12),s=i(19),n=i(1);t.GUI=class extends s.Scene{constructor(){super(),this.type=n.ObjectType.GUI,this.camera=new r.OrthoCamera(-500,500,500,-500,1,10),this.camera.position.set(0,0,2),this.add(this.camera)}beforeRender(e){return e.autoClear=!1,this}afterRender(e){return e.autoClear=!0,this}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(10),s=i(6),n=i(7);t.JSONLoader=class{load(e,t,i){return s.loadText(e.url,e=>{let i=JSON.parse(e),s=(new n.Geometry).set({uv:i.uvs,position:i.vertices,normal:i.normals,indice:i.indices,color:i.colors}),o=new r.Mesh(s);t&&t(o)},i),this}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let{round:r,min:s,max:n}=Math,o=r(devicePixelRatio||1),a=80*o,h=48*o,l=3*o,d=2*o,c=3*o,u=15*o,p=74*o,f=30*o;class m{constructor(e,t,i,r){this.minValue=1/0,this.maxValue=0,this.name="",this.frontColor=null,this.backgroundColor=null,this.type=e,this.name=t,this.frontColor=i,this.backgroundColor=r;let s=document.createElement("canvas");s.width=a,s.height=h,s.style.cssText="width:80px;height:48px",this.dom=s,this.context=s.getContext("2d"),this.context.font="bold "+9*o+"px Helvetica,Arial,sans-serif",this.context.textBaseline="top",this.context.fillStyle=r,this.context.fillRect(0,0,a,h),this.context.fillStyle=i,this.context.fillText(this.name,l,d),this.context.fillRect(c,u,p,f),this.context.fillStyle=r,this.context.globalAlpha=.9,this.context.fillRect(c,u,p,f)}update(e,t){this.minValue=s(this.minValue,e),this.maxValue=n(this.maxValue,e),this.context.fillStyle=this.backgroundColor,this.context.globalAlpha=1,this.context.fillRect(0,0,a,u),this.context.fillStyle=this.frontColor,this.context.fillText(r(e)+" "+this.name+" ("+r(this.minValue)+"-"+r(this.maxValue)+")",l,d),this.context.drawImage(this.dom,c+o,u,p-o,f,c,u,p-o,f),this.context.fillRect(c+p-o,u,o,f),this.context.fillStyle=this.backgroundColor,this.context.globalAlpha=.9,this.context.fillRect(c+p-o,u,o,r((1-e/t)*f))}show(e){return this.dom.style.display=e?"block":"none",this}}class g{constructor(){this.mode=-1,this.panels=[],this.container=document.createElement("div"),this.container.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",document.body.appendChild(this.container),this.addPanel(new m(1,"FPS","#0ff","#002")),performance&&performance.memory&&this.addPanel(new m(2,"MB","#f08","#201")),this.addPanel(new m(4,"MS","#0f0","#020"))}showPanel(e){if(this.mode!==e){this.mode=e;for(let t of this.panels)t.show((t.type&e)>0)}return this}addPanel(e){return this.panels.push(e),this.container.appendChild(e.dom),this}update(e,t,i){for(let t of this.panels)if(1===t.type&&t.update(e,100),4===t.type&&t.update(i,200),2===t.type){let e=performance.memory;t.update(e.usedJSHeapSize/1048576,e.jsHeapSizeLimit/1048576)}return this}}t.Monitor=class{constructor(){this.face=0,this.memory=0,this.fps=0,this.stats=new g,this.statsMode=7,this.total=0,this.frame=0}update(e){let{renderList:t,clock:i}=e;this.face=0;for(let e of t)this.face+=e.geometry.faces.length;return this.total+=.001*i.diffTime,this.frame++,this.total>=1&&(this.total=0,this.fps=this.frame,this.frame=0,this.stats.update(this.fps,this.face,i.diffTime)),this.stats.showPanel(this.statsMode),this}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(0);function s(e,t){return e.distance-t.distance}t.Raycaster=class{constructor(){this.ray=new r.Ray}setFromCamera(e,t){return this.ray.origin.setFromMatrixPosition(t.modelMatrix),t.unproject(this.ray.direction.set(e.x,e.y,-1)).sub(this.ray.origin).normalize(),this}intersectObject(e,t,i=!0){return t.length=0,e.raycast(this,t),t.sort(s),t}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(2),s=i(5),n=i(1),o=i(0),a=i(3),h=i(30),l=i(8),d=i(18),c=i(29),u=i(46),p=i(32),f=i(33),m=i(47);let g={},_=[],v=[],y=[],x=new l.Texture2D;function M(e){let t=g[e.id];if(void 0!==t)return t;switch(e.type){case n.ObjectType.Light:t={color:new a.Color};break;case n.ObjectType.DirectionalLight:t={color:new a.Color,direction:new o.Vec3,shadow:!1}}return g[e.id]=t,t}let w=/(?:|\n|\r)\s*\/\/.*/g,b=/\s*#include\s*<(.*)>/g;function T(e){return e=(e=e.replace(w,(e,t)=>"")).replace(b,(e,t)=>{let i=p.ShaderChunk[t];if(void 0===i)throw Error("not find "+t);return`\n\n/*${t}*/\n`+i})}let E,S,D="\nattribute vec3 position;\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 modelMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\n";t.Renderer=class{constructor(e={}){this.width=1,this.height=1,this.aspect=1,this.pixelRatio=1,this.premultipliedAlpha=!1,this.scene=null,this.gui=null,this.camera=null,this.backgournd=null,this.renderList=[],this.lights=[],this.shadowLights=[],this.directionalLights=[],this.directionalShadowMap=[],this.directionalShadowMatrix=[],this.dirctionalLength=0,this.clock=new d.Clock,this.autoClear=!0,this.ambient=null,this.toneMapping=r.ToneMappingType.None,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.gammaInput=!1,this.gammaOutput=!1,this.depthPacking=!1,this.running=!1,this.programUsed=null,this.materiaUsed=null,this.meshUsed=null,this.textureUnitUsed=0,this.properties=new u.Properties,this.uniforms={},this.detector=null,this.clearColor=new a.Color,this.enabledCapabilities={},this.renderTarget=null,this.saveContents=[],this.shadowMap=new h.ShadowMap,this.fullScreen_=!0,this.side=r.SideType.None,this.blending=r.BlendType.None,(S=document.getElementById("canvas")).style.width="100%",S.style.height="100%",(E=S.getContext("webgl",e)||S.getContext("experimental-webgl",e)).clearColor(0,0,0,1),E.enable(E.DEPTH_TEST),E.depthFunc(E.LEQUAL),this.width=S.width,this.height=S.height,this.pixelRatio=window.devicePixelRatio,this.detector=new m.Detector(E),f.Extensions.get(E,"WEBGL_depth_texture"),f.Extensions.get(E,"OES_element_index_uint"),this.toneMapping=e.toneMapping||this.toneMapping,this.toneMappingExposure=void 0!==e.toneMappingExposure?e.toneMappingExposure:this.toneMappingExposure,this.toneMappingWhitePoint=void 0!==e.toneMappingWhitePoint?e.toneMappingWhitePoint:this.toneMappingWhitePoint,this.gammaInput=void 0!==e.gammaInput?e.gammaInput:this.gammaInput,this.gammaOutput=void 0!==e.gammaInput?e.gammaInput:this.gammaInput,this.depthPacking=void 0!==e.depthPacking?e.depthPacking:this.depthPacking,this.premultipliedAlpha=void 0!==e.premultipliedAlpha?e.premultipliedAlpha:this.premultipliedAlpha,this.setClearColor(new a.Color(e.clearColor)),this.resize(),this.start()}get fullScreen(){return this.fullScreen_}set fullScreen(e){this.fullScreen_!==e&&(this.fullScreen_=e,this.resize())}start(){window.addEventListener("resize",this.resize.bind(this),!1),S.addEventListener("mousedown",e=>this.dispatch("MouseDown",e),!1),S.addEventListener("mouseup",e=>this.dispatch("MouseUp",e),!1),S.addEventListener("mousemove",e=>this.dispatch("MouseMove",e),!1),S.addEventListener("mousewheel",e=>this.dispatch("MouseWheel",e),!1),S.addEventListener("touchstart",e=>this.dispatch("TouchStart",e),!1),S.addEventListener("touchend",e=>this.dispatch("TouchEnd",e),!1),S.addEventListener("touchmove",e=>this.dispatch("TouchMove",e),!1)}dispatch(e,t){return t instanceof Event&&t.preventDefault(),this.scene&&this.scene.emit(e,{broadcost:!0,data:t}),this.gui&&this.gui.emit(e,{broadcost:!0,data:t}),this}resize(){return this.fullScreen_?this.setSize(window.innerWidth,window.innerHeight):this.setSize(this.width,this.height),this.dispatch("Resize",{screenWidth:this.width,screenHeight:this.height}),this}setSize(e,t=e){return this.width=e,this.height=t,this.aspect=e/t,S.width=this.pixelRatio*this.width,S.height=this.pixelRatio*this.height,E.viewport(0,0,S.width,S.height),this}getProgram(e,t){let i=!1,r=e.defines;r.NUM_DIR_LIGHTS!==this.dirctionalLength&&(r.NUM_DIR_LIGHTS=this.dirctionalLength,i=!0),-1===e.programId&&(i=!0),i&&this.updateProgram(e,t);let s=_[e.programId];if(void 0===s){let t=y[e.programId];s=_[e.programId]=new c.Program(E,T(t.vertexShader),T(t.fragmentShader))}return s}useProgram(e,t){let i=this.programUsed;return this.materiaUsed!==t||t.needUpdate?(this.materiaUsed=t,t.needUpdate=!1,this.textureUnitUsed=0,this.updateMaterial(t),(i=this.getProgram(t,e).use(E)).uniforms.setValue(E,this,t),i.attributes.setValue(E,this,e.geometry),this.programUsed=i):this.programUsed!==i?(this.programUsed=i,i.attributes.setValue(E,this,e.geometry)):this.meshUsed!==e&&(this.meshUsed=e,i.attributes.setValue(E,this,e.geometry)),i}updateProgram(e,t){let i="";for(let t in e.defines)i+=`#define ${t} ${e.defines[t]}\n`;let r=!!this.scene.fog,s=r&&1===this.scene.fog.type,n=t.receiveShadow&&this.shadowLights.length>0,o=t.geometry,a=["precision mediump float;",r?"#define USE_FOG":"",e.map?"#define USE_MAP":"",e.bumpMap?"#define USE_BUMPMAP":"",n?"#define USE_SHADOWMAP":"",o.color?"#define USE_COLOR":"",o.uv?"attribute vec2 uv;":"",o.color?"attribute vec3 color;":"",o.normal?"attribute vec3 normal;":"",D,e.vertexShader,"\n"].filter(e=>""!==e).join("\n"),h=[this.getExtensions(e),"precision mediump float;",this.depthPacking?"#define DEPTH_PACKING":"",this.toneMapping?"#define TONE_MAPPING":"",this.toneMapping?this.getToneMapping():"",r?"#define USE_FOG":"",s?"#define FOG_EXP2":"",e.map?"#define USE_MAP":"",e.bumpMap?"#define USE_BUMPMAP":"",e.glossMap?"#define USE_GLOSSMAP":"",e.wrapRGB?"#define WRAP_AROUND":"",n?"#define USE_SHADOWMAP":"",o.color?"#define USE_COLOR":"",this.gammaInput?"#define GAMMA_INPUT":"",this.gammaOutput?"#define GAMMA_OUTPUT":"",e.fragmentShader,"\n"].filter(e=>""!==e).join("\n");return e.programId=function(e){let t=v.indexOf(e);return-1===t&&(t=v.length,v.push(e)),t}(i+a+h),y[e.programId]={vertexShader:i+a,fragmentShader:i+h},this}updateMaterial(e){return this.setFrontFace(e.side),this.setBlending(e.blending),this}getTextureUnit(){let e=this.textureUnitUsed++;if(e>this.detector.maxTextureUnit)throw Error(`texture unit ${this.textureUnitUsed} larger than support ${this.detector.maxTextureUnit}`);return e}getToneMapping(){switch(this.toneMapping){case r.ToneMappingType.Linear:return"#define TONEMAP_LINEAR";case r.ToneMappingType.Filmic:return"#define TONEMAP_FILMIC";default:return""}}getExtensions(e){let t=e.extensions;return[t.derivatives&&f.Extensions.get(E,"OES_standard_derivatives")?"#extension GL_OES_standard_derivatives : enable":"",t.fragDepth&&f.Extensions.get(E,"EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",t.drawBuffers&&f.Extensions.get(E,"WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",t.shaderTextureLOD&&f.Extensions.get(E,"EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(e=>""!==e).join("\n")}setTexture2D(e,t){if(t.dataType===r.DataType.Float&&!f.Extensions.get(E,"OES_texture_float"))throw Error("not support DataType.Float");if(t.dataType===r.DataType.Float&&(t.magFilter===r.FilterType.Linear||t.minFilter===r.FilterType.Linear)&&!f.Extensions.get(E,"OES_texture_float_linear"))throw Error("not support (DataType.Float && FilterType.Linear)");return E.bindTexture(E.TEXTURE_2D,e),E.pixelStorei(E.UNPACK_FLIP_Y_WEBGL,t.flipY),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MAG_FILTER,s.getWebglFilter(E,t.magFilter)),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MIN_FILTER,s.getWebglFilter(E,t.minFilter)),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_S,s.getWebglWrapping(E,t.wrapS)),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_T,s.getWebglWrapping(E,t.wrapT)),t.url?E.texImage2D(E.TEXTURE_2D,0,E.RGBA,1,1,0,E.RGBA,s.getWebglDataType(E,t.dataType),new Uint8Array(4)):E.texImage2D(E.TEXTURE_2D,0,E.RGBA,t.width,t.height,0,E.RGBA,s.getWebglDataType(E,t.dataType),null),this.setAnisotropy(E.TEXTURE_2D,t),E.bindTexture(E.TEXTURE_2D,null),this}updateTexture2D(e,t){if(t.needUpdate){t.needUpdate=!1;let i=t.image,r=s.getWebglFormt(E,t.format);E.bindTexture(E.TEXTURE_2D,e),E.pixelStorei(E.UNPACK_FLIP_Y_WEBGL,t.flipY),o.isPowerOfTwo(i.width)&&o.isPowerOfTwo(i.height)||(console.warn("Texture2D: size is not power of two "+t.url),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_S,E.CLAMP_TO_EDGE),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_T,E.CLAMP_TO_EDGE)),E.texImage2D(E.TEXTURE_2D,0,r,r,s.getWebglDataType(E,t.dataType),i),E.bindTexture(E.TEXTURE_2D,null)}return this}useTexture2D(e,t){e=e||x;let i=this.properties.get(e);return void 0===i.webgltexture&&(i.webgltexture=E.createTexture(),this.setTexture2D(i.webgltexture,e)),this.updateTexture2D(i.webgltexture,e),E.activeTexture(E.TEXTURE0+t),E.bindTexture(E.TEXTURE_2D,i.webgltexture),this}setTextureCube(e,t){E.bindTexture(E.TEXTURE_CUBE_MAP,e),E.pixelStorei(E.UNPACK_FLIP_Y_WEBGL,t.flipY),E.texParameteri(E.TEXTURE_CUBE_MAP,E.TEXTURE_MAG_FILTER,s.getWebglFilter(E,t.magFilter)),E.texParameteri(E.TEXTURE_CUBE_MAP,E.TEXTURE_MIN_FILTER,s.getWebglFilter(E,t.minFilter)),E.texParameteri(E.TEXTURE_CUBE_MAP,E.TEXTURE_WRAP_S,s.getWebglWrapping(E,t.wrapS)),E.texParameteri(E.TEXTURE_CUBE_MAP,E.TEXTURE_WRAP_T,s.getWebglWrapping(E,t.wrapT));for(let e=0;e<6;e++)t.urls?E.texImage2D(E.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,E.RGBA,1,1,0,E.RGBA,s.getWebglDataType(E,t.dataType),new Uint8Array(4)):E.texImage2D(E.TEXTURE_2D,0,E.RGBA,t.width,t.height,0,E.RGBA,s.getWebglDataType(E,t.dataType),null);return this.setAnisotropy(E.TEXTURE_CUBE_MAP,t),E.bindTexture(E.TEXTURE_CUBE_MAP,null),this}updateTextureCube(e,t){if(t.needUpdate){if(t.needUpdate=!1,t.images.length<6)throw Error("TextureCube: urls.length should be 6");E.bindTexture(E.TEXTURE_CUBE_MAP,e),E.pixelStorei(E.UNPACK_FLIP_Y_WEBGL,t.flipY);for(let e=0;e<6;e++){let i=t.images[e],r=s.getWebglFormt(E,t.formats[e]);o.isPowerOfTwo(i.width)&&o.isPowerOfTwo(i.height)||(console.warn("TextureCube: size is not power of two "+i.baseURI),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_S,E.CLAMP_TO_EDGE),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_T,E.CLAMP_TO_EDGE)),E.texImage2D(E.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,r,r,s.getWebglDataType(E,t.dataType),i)}E.bindTexture(E.TEXTURE_CUBE_MAP,null)}return this}useTextureCube(e,t){let i=this.properties.get(e);return void 0===i.webgltexture&&(i.webgltexture=E.createTexture(),this.setTextureCube(i.webgltexture,e)),this.updateTextureCube(i.webgltexture,e),E.activeTexture(E.TEXTURE0+t),E.bindTexture(E.TEXTURE_CUBE_MAP,i.webgltexture),this}setAnisotropy(e,t){let i=f.Extensions.get(E,"EXT_texture_filter_anisotropic");if(i){if(t.dataType===r.DataType.Float&&!f.Extensions.get(E,"OES_texture_float_linear"))return this;if(t.dataType===r.DataType.HalfFloat&&!f.Extensions.get(E,"OES_texture_half_float_linear"))return this;t.anisotropy>0&&E.texParameterf(e,i.TEXTURE_MAX_ANISOTROPY_EXT,this.detector.maxAnisotropy)}return this}useRenderTarget(e,t=!0){if(this.renderTarget!==e){if(this.renderTarget=e,e){let t=this.properties.get(e);void 0===t.webglframebuffer&&(t.webglframebuffer=E.createFramebuffer(),this.setRenderTarget(t.webglframebuffer,e)),E.bindFramebuffer(E.FRAMEBUFFER,t.webglframebuffer),E.viewport(0,0,e.texture.width,e.texture.height)}else E.bindFramebuffer(E.FRAMEBUFFER,null),E.viewport(0,0,S.width,S.height);t&&this.clear()}return this}setRenderTarget(e,t){let i=this.properties.get(t.texture);void 0===i.webgltexture&&(i.webgltexture=E.createTexture(),this.setTexture2D(i.webgltexture,t.texture)),E.bindFramebuffer(E.FRAMEBUFFER,e),E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_2D,i.webgltexture,0);let r=E.createRenderbuffer();if(E.bindRenderbuffer(E.RENDERBUFFER,r),E.renderbufferStorage(E.RENDERBUFFER,E.DEPTH_COMPONENT16,t.texture.width,t.texture.height),E.framebufferRenderbuffer(E.FRAMEBUFFER,E.DEPTH_ATTACHMENT,E.RENDERBUFFER,r),E.bindRenderbuffer(E.RENDERBUFFER,null),E.bindFramebuffer(E.FRAMEBUFFER,null),E.checkFramebufferStatus(E.FRAMEBUFFER)!==E.FRAMEBUFFER_COMPLETE)throw Error("RenderTarget incomplete");return this}setBufferView(e,t){let i=t.element?E.ELEMENT_ARRAY_BUFFER:E.ARRAY_BUFFER;return E.bindBuffer(i,e),E.bufferData(i,t.values,E.STATIC_DRAW),E.bindBuffer(i,null),this}useBufferView(e){let t=this.properties.get(e);return void 0===t.webglbuffer&&(t.webglbuffer=E.createBuffer(),this.setBufferView(t.webglbuffer,e)),E.bindBuffer(E.ARRAY_BUFFER,t.webglbuffer),this}reset(){return this.renderList.length=0,this.lights.length=0,this.shadowLights.length=0,this}save(){return this.saveContents.push(this.renderTarget),this}restore(){return this.useRenderTarget(this.saveContents.pop(),!1),this}pushLight(e){return this.lights.push(e),e.shadow&&this.shadowLights.push(e),this}pushMesh(e){return this.renderList.push(e),this}updateLights(){this.dirctionalLength=0;for(let e of this.lights){let t=e.shadow,i=M(e),r=e.color.scale(e.intensity,i.color);switch(e.type){case n.ObjectType.Light:this.ambient=this.gammaInput?r.getGamma():r;break;case n.ObjectType.DirectionalLight:(i=i).color=this.gammaInput?r.getGamma():r,i.direction.copy(e.direction),i.shadow=!!t,this.directionalLights[this.dirctionalLength]=i,this.directionalShadowMap[this.dirctionalLength]=t&&t.renderTarget&&t.renderTarget.texture||null,this.directionalShadowMatrix[this.dirctionalLength]=t&&t.matrix||null,this.dirctionalLength++}}return this}updateCamera(){return this.camera&&this.camera.type===n.ObjectType.PerspectiveCamera&&this.camera.aspect!==this.aspect&&(this.camera.aspect=this.aspect,this.camera.updateProjectionMatrix()),this}projectObject(e){if(!1===e.visible)return this;switch(240&e.type){case n.ObjectType.Light:this.pushLight(e);break;case n.ObjectType.Camera:this.camera=e;break;case n.ObjectType.Mesh:this.pushMesh(e)}for(let t of e.children)this.projectObject(t)}render(){if(!1===this.running){this.running=!0;let e=()=>{this.renderScene(this.scene),this.renderScene(this.gui),this.running&&requestAnimationFrame(e)};e()}return this}renderScene(e){if(!e)return this;e.update(this.clock.getDelta()),e.beforeRender(this),this.reset(),this.projectObject(e),this.updateLights(),this.updateCamera(),this.updateUniforms(e),this.shadowMap.render(this),this.autoClear&&this.clear();for(let e of this.renderList)this.renderMesh(e);return this.backgournd&&(this.backgournd.position.copy(this.camera.position),this.renderMesh(this.backgournd)),e.afterRender(this),this}updateUniforms(e){let t=this.camera;this.uniforms.viewMatrix=t.viewMatrix,this.uniforms.projectionMatrix=t.projectionMatrix,this.uniforms.cameraPosition=t.worldPosition,this.uniforms.ambient=this.ambient,this.uniforms.directionalLights=this.directionalLights,this.uniforms.directionalShadowMap=this.directionalShadowMap,this.uniforms.directionalShadowMatrix=this.directionalShadowMatrix,this.uniforms.toneMappingExposure=this.toneMappingExposure,this.uniforms.toneMappingWhitePoint=this.toneMappingWhitePoint;let i=e.fog;return i&&(this.uniforms.fogColor=i.color,this.uniforms.fogNear=i.near,this.uniforms.fogFar=i.far,this.uniforms.fogDensity=i.density),this}renderMesh(e,t){let i,r;this.camera.viewMatrix.multiply(e.modelMatrix,e.modelViewMatrix),this.uniforms.modelViewMatrix=e.modelViewMatrix,this.uniforms.modelMatrix=e.modelMatrix,this.uniforms.normalMatrix=e.normalMatrix;for(let s of e.geometry.groups)if(void 0!==(r=t||e.materials[s.materialIndex]))for(let t of r.passList)!1!==t.enabled&&(t.beforeRender(t,this),t.renderTarget?(this.save(),this.useRenderTarget(t.renderTarget),(i=this.useProgram(e,t.material)).uniforms.setValue(E,this,this.uniforms),this.draw(s,e.drawMode),this.restore()):((i=this.useProgram(e,t.material)).uniforms.setValue(E,this,this.uniforms),this.draw(s,e.drawMode)),t.afterRender(t,this));return this}renderDepth(e,t,i){if(!1===e.castShadow)return this;let r;t.viewMatrix.multiply(e.modelMatrix,e.modelViewMatrix);for(let s of e.geometry.groups)(r=this.useProgram(e,i)).setUniform(E,this,"modelViewMatrix",e.modelViewMatrix),r.setUniform(E,this,"modelMatrix",e.modelMatrix),r.setUniform(E,this,"viewMatrix",t.viewMatrix),r.setUniform(E,this,"projectionMatrix",t.projectionMatrix),r.setUniform(E,this,"cameraPosition",t.worldPosition),this.draw(s,e.drawMode);return this}draw(e,t){t=s.getWebglDrawMode(E,t);let i=this.properties.get(e.bv);return void 0===i.webglbuffer&&(i.webglbuffer=E.createBuffer(),this.setBufferView(i.webglbuffer,e.bv)),e.bv.element?(E.bindBuffer(E.ELEMENT_ARRAY_BUFFER,i.webglbuffer),E.drawElements(t,e.count,2===e.bv.bytesPer?E.UNSIGNED_SHORT:E.UNSIGNED_INT,e.offset)):(E.bindBuffer(E.ARRAY_BUFFER,i.webglbuffer),E.drawArrays(t,e.start,e.count)),this}clear(e=!0,t=!0){let i=0;return e&&(i|=E.COLOR_BUFFER_BIT),t&&(i|=E.DEPTH_BUFFER_BIT),i&&E.clear(i),this}enable(e){return!0!==this.enabledCapabilities[e]&&(this.enabledCapabilities[e]=!0,E.enable(e)),this}disable(e){return!1!==this.enabledCapabilities[e]&&(this.enabledCapabilities[e]=!1,E.disable(e)),this}setClearColor(e){return!1===this.clearColor.equals(e)&&(this.clearColor.copy(e),E.clearColor(e.r,e.g,e.b,1)),this}setFrontFace(e){return this.side!==e&&(this.side=e,e===r.SideType.Double?this.disable(E.CULL_FACE):this.enable(E.CULL_FACE),E.frontFace(e===r.SideType.Back?E.CW:E.CCW)),this}setBlending(e){if(this.blending!==e)if(this.blending=e,e===r.BlendType.None)this.disable(E.BLEND);else switch(this.enable(E.BLEND),e){case r.BlendType.Normal:this.premultipliedAlpha?E.blendFuncSeparate(E.ONE,E.ONE_MINUS_SRC_ALPHA,E.ONE,E.ONE_MINUS_SRC_ALPHA):E.blendFuncSeparate(E.SRC_ALPHA,E.ONE_MINUS_SRC_ALPHA,E.ONE,E.ONE_MINUS_SRC_ALPHA);break;case r.BlendType.Add:this.premultipliedAlpha?E.blendFunc(E.ONE,E.ONE):E.blendFunc(E.SRC_ALPHA,E.ONE);break;case r.BlendType.Sub:this.premultipliedAlpha?E.blendFuncSeparate(E.ZERO,E.ONE_MINUS_SRC_COLOR,E.ZERO,E.ONE_MINUS_SRC_ALPHA):E.blendFunc(E.ZERO,E.ONE_MINUS_SRC_COLOR);break;case r.BlendType.Mul:this.premultipliedAlpha?E.blendFuncSeparate(E.ZERO,E.SRC_COLOR,E.ZERO,E.SRC_ALPHA):E.blendFunc(E.ZERO,E.SRC_COLOR);break;default:throw Error("setBlending: invalid blending "+e)}return this}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Properties=class{constructor(){this._properties=new WeakMap}get(e){let t=this._properties.get(e);return void 0===t&&(t={},this._properties.set(e,t)),t}remove(e){return this._properties.delete(e),this}destroy(){return this._properties=new WeakMap,this}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(33);t.Detector=class{constructor(e){this.isWebgl2="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext,this.maxTextureUnit=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this.setMaxAnisotropy(e)}setMaxAnisotropy(e){let t=r.Extensions.get(e,"EXT_texture_filter_anisotropic");return this.maxAnisotropy=t?e.getParameter(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),s=i(12),n=i(16);t.Shadow=class{constructor(e={}){this.camera=new s.OrthoCamera(-15,15,15,-15,1,100),this.renderTarget=new n.RenderTarget({width:512}),this.matrix=new r.Mat4,this.renderTarget=e.width?new n.RenderTarget({width:e.width,height:e.height}):this.renderTarget,this.camera=e.camera||this.camera}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(3),s=i(5);t.Fog=class{constructor(e,t,i){this.type=0,this.color=new r.Color(16777215),this.near=1,this.far=1e3,this.color=void 0!==e?new r.Color(e):this.color,this.near=void 0!==t?t:this.near,this.far=null!=i?i:this.far,s.assert(this.near<this.far,"Fog: near must less than far")}};t.FogExp2=class{constructor(e,t){this.type=1,this.color=new r.Color(16777215),this.density=25e-5,this.color=void 0!==e?new r.Color(e):this.color,this.density=t||this.density}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(34),s=i(1);t.DirectionalLight=class extends r.Light{constructor(e,t){super(e,t),this.type=s.ObjectType.DirectionalLight,this.position.copy(this.up)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(52),s=i(6),n=i(7);t.CTMLoader=class{load(e,t,i){return s.loadBlob(e.url,e=>{let i,s,o=new Uint8Array(e),a=new r.CTM.Stream(o),h=new r.CTM.File(a),l=h.body.uvMaps;l&&l.length>0&&(i=l[0].uv);let d=h.body.attrMaps;d&&d.length>0&&"Color"===d[0].name&&(s=d[0].attr);let c=(new n.Geometry).set({uv:i,color:s,position:h.body.vertices,normal:h.body.normals,indice:h.body.indices});t&&t(c)},i),this}}},function(e,t,i){let r=i(53);var s,n,o,a=a||{};e.exports=a,a.CompressionMethod={RAW:5718354,MG1:3229517,MG2:3295053},a.Flags={NORMALS:1},a.File=function(e){this.load(e)},a.File.prototype.load=function(e){this.header=new a.FileHeader(e),this.body=new a.FileBody(this.header),this.getReader().read(e,this.body)},a.File.prototype.getReader=function(){var e;switch(this.header.compressionMethod){case a.CompressionMethod.RAW:e=new a.ReaderRAW;break;case a.CompressionMethod.MG1:e=new a.ReaderMG1;break;case a.CompressionMethod.MG2:e=new a.ReaderMG2}return e},a.FileHeader=function(e){e.readInt32(),this.fileFormat=e.readInt32(),this.compressionMethod=e.readInt32(),this.vertexCount=e.readInt32(),this.triangleCount=e.readInt32(),this.uvMapCount=e.readInt32(),this.attrMapCount=e.readInt32(),this.flags=e.readInt32(),this.comment=e.readString()},a.FileHeader.prototype.hasNormals=function(){return this.flags&a.Flags.NORMALS},a.FileBody=function(e){var t=3*e.triangleCount,i=3*e.vertexCount,r=e.hasNormals()?3*e.vertexCount:0,s=2*e.vertexCount,n=4*e.vertexCount,o=0,a=new ArrayBuffer(4*(t+i+r+s*e.uvMapCount+n*e.attrMapCount));if(this.indices=new Uint32Array(a,0,t),this.vertices=new Float32Array(a,4*t,i),e.hasNormals()&&(this.normals=new Float32Array(a,4*(t+i),r)),e.uvMapCount)for(this.uvMaps=[],o=0;o<e.uvMapCount;++o)this.uvMaps[o]={uv:new Float32Array(a,4*(t+i+r+o*s),s)};if(e.attrMapCount)for(this.attrMaps=[],o=0;o<e.attrMapCount;++o)this.attrMaps[o]={attr:new Float32Array(a,4*(t+i+r+s*e.uvMapCount+o*n),n)}},a.FileMG2Header=function(e){e.readInt32(),this.vertexPrecision=e.readFloat32(),this.normalPrecision=e.readFloat32(),this.lowerBoundx=e.readFloat32(),this.lowerBoundy=e.readFloat32(),this.lowerBoundz=e.readFloat32(),this.higherBoundx=e.readFloat32(),this.higherBoundy=e.readFloat32(),this.higherBoundz=e.readFloat32(),this.divx=e.readInt32(),this.divy=e.readInt32(),this.divz=e.readInt32(),this.sizex=(this.higherBoundx-this.lowerBoundx)/this.divx,this.sizey=(this.higherBoundy-this.lowerBoundy)/this.divy,this.sizez=(this.higherBoundz-this.lowerBoundz)/this.divz},a.ReaderRAW=function(){},a.ReaderRAW.prototype.read=function(e,t){this.readIndices(e,t.indices),this.readVertices(e,t.vertices),t.normals&&this.readNormals(e,t.normals),t.uvMaps&&this.readUVMaps(e,t.uvMaps),t.attrMaps&&this.readAttrMaps(e,t.attrMaps)},a.ReaderRAW.prototype.readIndices=function(e,t){e.readInt32(),e.readArrayInt32(t)},a.ReaderRAW.prototype.readVertices=function(e,t){e.readInt32(),e.readArrayFloat32(t)},a.ReaderRAW.prototype.readNormals=function(e,t){e.readInt32(),e.readArrayFloat32(t)},a.ReaderRAW.prototype.readUVMaps=function(e,t){for(var i=0;i<t.length;++i)e.readInt32(),t[i].name=e.readString(),t[i].filename=e.readString(),e.readArrayFloat32(t[i].uv)},a.ReaderRAW.prototype.readAttrMaps=function(e,t){for(var i=0;i<t.length;++i)e.readInt32(),t[i].name=e.readString(),e.readArrayFloat32(t[i].attr)},a.ReaderMG1=function(){},a.ReaderMG1.prototype.read=function(e,t){this.readIndices(e,t.indices),this.readVertices(e,t.vertices),t.normals&&this.readNormals(e,t.normals),t.uvMaps&&this.readUVMaps(e,t.uvMaps),t.attrMaps&&this.readAttrMaps(e,t.attrMaps)},a.ReaderMG1.prototype.readIndices=function(e,t){e.readInt32(),e.readInt32();var i=new a.InterleavedStream(t,3);r.decompress(e,e,i,i.data.length),a.restoreIndices(t,t.length)},a.ReaderMG1.prototype.readVertices=function(e,t){e.readInt32(),e.readInt32();var i=new a.InterleavedStream(t,1);r.decompress(e,e,i,i.data.length)},a.ReaderMG1.prototype.readNormals=function(e,t){e.readInt32(),e.readInt32();var i=new a.InterleavedStream(t,3);r.decompress(e,e,i,i.data.length)},a.ReaderMG1.prototype.readUVMaps=function(e,t){for(var i=0;i<t.length;++i){e.readInt32(),t[i].name=e.readString(),t[i].filename=e.readString(),e.readInt32();var s=new a.InterleavedStream(t[i].uv,2);r.decompress(e,e,s,s.data.length)}},a.ReaderMG1.prototype.readAttrMaps=function(e,t){for(var i=0;i<t.length;++i){e.readInt32(),t[i].name=e.readString(),e.readInt32();var s=new a.InterleavedStream(t[i].attr,4);r.decompress(e,e,s,s.data.length)}},a.ReaderMG2=function(){},a.ReaderMG2.prototype.read=function(e,t){this.MG2Header=new a.FileMG2Header(e),this.readVertices(e,t.vertices),this.readIndices(e,t.indices),t.normals&&this.readNormals(e,t),t.uvMaps&&this.readUVMaps(e,t.uvMaps),t.attrMaps&&this.readAttrMaps(e,t.attrMaps)},a.ReaderMG2.prototype.readVertices=function(e,t){e.readInt32(),e.readInt32();var i=new a.InterleavedStream(t,3);r.decompress(e,e,i,i.data.length);var s=this.readGridIndices(e,t);a.restoreVertices(t,this.MG2Header,s,this.MG2Header.vertexPrecision)},a.ReaderMG2.prototype.readGridIndices=function(e,t){e.readInt32(),e.readInt32();var i=new Uint32Array(t.length/3),s=new a.InterleavedStream(i,1);return r.decompress(e,e,s,s.data.length),a.restoreGridIndices(i,i.length),i},a.ReaderMG2.prototype.readIndices=function(e,t){e.readInt32(),e.readInt32();var i=new a.InterleavedStream(t,3);r.decompress(e,e,i,i.data.length),a.restoreIndices(t,t.length)},a.ReaderMG2.prototype.readNormals=function(e,t){e.readInt32(),e.readInt32();var i=new a.InterleavedStream(t.normals,3);r.decompress(e,e,i,i.data.length);var s=a.calcSmoothNormals(t.indices,t.vertices);a.restoreNormals(t.normals,s,this.MG2Header.normalPrecision)},a.ReaderMG2.prototype.readUVMaps=function(e,t){for(var i=0;i<t.length;++i){e.readInt32(),t[i].name=e.readString(),t[i].filename=e.readString();var s=e.readFloat32();e.readInt32();var n=new a.InterleavedStream(t[i].uv,2);r.decompress(e,e,n,n.data.length),a.restoreMap(t[i].uv,2,s)}},a.ReaderMG2.prototype.readAttrMaps=function(e,t){for(var i=0;i<t.length;++i){e.readInt32(),t[i].name=e.readString();var s=e.readFloat32();e.readInt32();var n=new a.InterleavedStream(t[i].attr,4);r.decompress(e,e,n,n.data.length),a.restoreMap(t[i].attr,4,s)}},a.restoreIndices=function(e,t){var i=3;for(t>0&&(e[2]+=e[0],e[1]+=e[0]);i<t;i+=3)e[i]+=e[i-3],e[i]===e[i-3]?e[i+1]+=e[i-2]:e[i+1]+=e[i],e[i+2]+=e[i]},a.restoreGridIndices=function(e,t){for(var i=1;i<t;++i)e[i]+=e[i-1]},a.restoreVertices=function(e,t,i,r){for(var s,n,o,a,h,l=new Uint32Array(e.buffer,e.byteOffset,e.length),d=t.divx,c=d*t.divy,u=2147483647,p=0,f=0,m=0,g=i.length;f<g;m+=3)o=s=i[f++],o-=~~((h=~~(o/c))*c),o-=~~((a=~~(o/d))*d),n=l[m],s===u&&(n+=p),e[m]=t.lowerBoundx+o*t.sizex+r*n,e[m+1]=t.lowerBoundy+a*t.sizey+r*l[m+1],e[m+2]=t.lowerBoundz+h*t.sizez+r*l[m+2],u=s,p=n},a.restoreNormals=function(e,t,i){for(var r,s,n,o,a,h,l,d,c,u,p=new Uint32Array(e.buffer,e.byteOffset,e.length),f=0,m=e.length,g=1.5707963267948966;f<m;f+=3)r=p[f]*i,0===(s=p[f+1])?(e[f]=t[f]*r,e[f+1]=t[f+1]*r,e[f+2]=t[f+2]*r):(n=s<=4?(p[f+2]-2)*g:(4*p[f+2]/s-2)*g,s*=i*g,a=(o=r*Math.sin(s))*Math.cos(n),h=o*Math.sin(n),l=r*Math.cos(s),c=t[f+1],d=t[f]-t[f+2],(u=Math.sqrt(2*c*c+d*d))>1e-20&&(d/=u,c/=u),e[f]=t[f]*l+(t[f+1]*c-t[f+2]*d)*h-c*a,e[f+1]=t[f+1]*l-(t[f+2]+t[f])*c*h+d*a,e[f+2]=t[f+2]*l+(t[f]*d+t[f+1]*c)*h+c*a)},a.restoreMap=function(e,t,i){for(var r,s,n,o=new Uint32Array(e.buffer,e.byteOffset,e.length),a=0,h=e.length;a<t;++a)for(r=0,n=a;n<h;n+=t)r+=1&(s=o[n])?-(s+1>>1):s>>1,e[n]=r*i},a.calcSmoothNormals=function(e,t){var i,r,s,n,o,a,h,l,d,c,u,p,f,m,g,_=new Float32Array(t.length);for(m=0,g=e.length;m<g;)i=3*e[m++],r=3*e[m++],s=3*e[m++],h=t[r]-t[i],c=t[s]-t[i],l=t[r+1]-t[i+1],u=t[s+1]-t[i+1],d=t[r+2]-t[i+2],n=l*(p=t[s+2]-t[i+2])-d*u,o=d*c-h*p,a=h*u-l*c,(f=Math.sqrt(n*n+o*o+a*a))>1e-10&&(n/=f,o/=f,a/=f),_[i]+=n,_[i+1]+=o,_[i+2]+=a,_[r]+=n,_[r+1]+=o,_[r+2]+=a,_[s]+=n,_[s+1]+=o,_[s+2]+=a;for(m=0,g=_.length;m<g;m+=3)(f=Math.sqrt(_[m]*_[m]+_[m+1]*_[m+1]+_[m+2]*_[m+2]))>1e-10&&(_[m]/=f,_[m+1]/=f,_[m+2]/=f);return _},a.isLittleEndian=(s=new ArrayBuffer(2),n=new Uint8Array(s),o=new Uint16Array(s),n[0]=1,1===o[0]),a.InterleavedStream=function(e,t){this.data=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),this.offset=a.isLittleEndian?3:0,this.count=4*t,this.len=this.data.length},a.InterleavedStream.prototype.writeByte=function(e){this.data[this.offset]=e,this.offset+=this.count,this.offset>=this.len&&(this.offset-=this.len-4,this.offset>=this.count&&(this.offset-=this.count+(a.isLittleEndian?1:-1)))},a.Stream=function(e){this.data=e,this.offset=0},a.Stream.prototype.TWO_POW_MINUS23=Math.pow(2,-23),a.Stream.prototype.TWO_POW_MINUS126=Math.pow(2,-126),a.Stream.prototype.readByte=function(){return 255&this.data[this.offset++]},a.Stream.prototype.readInt32=function(){var e=this.readByte();return e|=this.readByte()<<8,(e|=this.readByte()<<16)|this.readByte()<<24},a.Stream.prototype.readFloat32=function(){var e=this.readByte();e+=this.readByte()<<8;var t=this.readByte(),i=this.readByte();e+=(127&t)<<16;var r=(127&i)<<1|(128&t)>>>7,s=128&i?-1:1;return 255===r?0!==e?NaN:s*(1/0):r>0?s*(1+e*this.TWO_POW_MINUS23)*Math.pow(2,r-127):0!==e?s*e*this.TWO_POW_MINUS126:0*s},a.Stream.prototype.readString=function(){var e=this.readInt32();return this.offset+=e,String.fromCharCode.apply(null,this.data.subarray(this.offset-e,this.offset))},a.Stream.prototype.readArrayInt32=function(e){for(var t=0,i=e.length;t<i;)e[t++]=this.readInt32();return e},a.Stream.prototype.readArrayFloat32=function(e){for(var t=0,i=e.length;t<i;)e[t++]=this.readFloat32();return e},e.exports={CTM:a}},function(e,t,i){var r=r||{};e.exports=r,r.OutWindow=function(){this._windowSize=0},r.OutWindow.prototype.create=function(e){this._buffer&&this._windowSize===e||(this._buffer=[]),this._windowSize=e,this._pos=0,this._streamPos=0},r.OutWindow.prototype.flush=function(){var e=this._pos-this._streamPos;if(0!==e){for(;e--;)this._stream.writeByte(this._buffer[this._streamPos++]);this._pos>=this._windowSize&&(this._pos=0),this._streamPos=this._pos}},r.OutWindow.prototype.releaseStream=function(){this.flush(),this._stream=null},r.OutWindow.prototype.setStream=function(e){this.releaseStream(),this._stream=e},r.OutWindow.prototype.init=function(e){e||(this._streamPos=0,this._pos=0)},r.OutWindow.prototype.copyBlock=function(e,t){var i=this._pos-e-1;for(i<0&&(i+=this._windowSize);t--;)i>=this._windowSize&&(i=0),this._buffer[this._pos++]=this._buffer[i++],this._pos>=this._windowSize&&this.flush()},r.OutWindow.prototype.putByte=function(e){this._buffer[this._pos++]=e,this._pos>=this._windowSize&&this.flush()},r.OutWindow.prototype.getByte=function(e){var t=this._pos-e-1;return t<0&&(t+=this._windowSize),this._buffer[t]},r.RangeDecoder=function(){},r.RangeDecoder.prototype.setStream=function(e){this._stream=e},r.RangeDecoder.prototype.releaseStream=function(){this._stream=null},r.RangeDecoder.prototype.init=function(){var e=5;for(this._code=0,this._range=-1;e--;)this._code=this._code<<8|this._stream.readByte()},r.RangeDecoder.prototype.decodeDirectBits=function(e){for(var t,i=0,r=e;r--;)this._range>>>=1,t=this._code-this._range>>>31,this._code-=this._range&t-1,i=i<<1|1-t,0==(4278190080&this._range)&&(this._code=this._code<<8|this._stream.readByte(),this._range<<=8);return i},r.RangeDecoder.prototype.decodeBit=function(e,t){var i=e[t],r=(this._range>>>11)*i;return(2147483648^this._code)<(2147483648^r)?(this._range=r,e[t]+=2048-i>>>5,0==(4278190080&this._range)&&(this._code=this._code<<8|this._stream.readByte(),this._range<<=8),0):(this._range-=r,this._code-=r,e[t]-=i>>>5,0==(4278190080&this._range)&&(this._code=this._code<<8|this._stream.readByte(),this._range<<=8),1)},r.initBitModels=function(e,t){for(;t--;)e[t]=1024},r.BitTreeDecoder=function(e){this._models=[],this._numBitLevels=e},r.BitTreeDecoder.prototype.init=function(){r.initBitModels(this._models,1<<this._numBitLevels)},r.BitTreeDecoder.prototype.decode=function(e){for(var t=1,i=this._numBitLevels;i--;)t=t<<1|e.decodeBit(this._models,t);return t-(1<<this._numBitLevels)},r.BitTreeDecoder.prototype.reverseDecode=function(e){for(var t,i=1,r=0,s=0;s<this._numBitLevels;++s)i=i<<1|(t=e.decodeBit(this._models,i)),r|=t<<s;return r},r.reverseDecode2=function(e,t,i,r){for(var s,n=1,o=0,a=0;a<r;++a)n=n<<1|(s=i.decodeBit(e,t+n)),o|=s<<a;return o},r.LenDecoder=function(){this._choice=[],this._lowCoder=[],this._midCoder=[],this._highCoder=new r.BitTreeDecoder(8),this._numPosStates=0},r.LenDecoder.prototype.create=function(e){for(;this._numPosStates<e;++this._numPosStates)this._lowCoder[this._numPosStates]=new r.BitTreeDecoder(3),this._midCoder[this._numPosStates]=new r.BitTreeDecoder(3)},r.LenDecoder.prototype.init=function(){var e=this._numPosStates;for(r.initBitModels(this._choice,2);e--;)this._lowCoder[e].init(),this._midCoder[e].init();this._highCoder.init()},r.LenDecoder.prototype.decode=function(e,t){return 0===e.decodeBit(this._choice,0)?this._lowCoder[t].decode(e):0===e.decodeBit(this._choice,1)?8+this._midCoder[t].decode(e):16+this._highCoder.decode(e)},r.Decoder2=function(){this._decoders=[]},r.Decoder2.prototype.init=function(){r.initBitModels(this._decoders,768)},r.Decoder2.prototype.decodeNormal=function(e){var t=1;do{t=t<<1|e.decodeBit(this._decoders,t)}while(t<256);return 255&t},r.Decoder2.prototype.decodeWithMatchByte=function(e,t){var i,r,s=1;do{if(i=t>>7&1,t<<=1,s=s<<1|(r=e.decodeBit(this._decoders,(1+i<<8)+s)),i!==r){for(;s<256;)s=s<<1|e.decodeBit(this._decoders,s);break}}while(s<256);return 255&s},r.LiteralDecoder=function(){},r.LiteralDecoder.prototype.create=function(e,t){var i;if(!this._coders||this._numPrevBits!==t||this._numPosBits!==e)for(this._numPosBits=e,this._posMask=(1<<e)-1,this._numPrevBits=t,this._coders=[],i=1<<this._numPrevBits+this._numPosBits;i--;)this._coders[i]=new r.Decoder2},r.LiteralDecoder.prototype.init=function(){for(var e=1<<this._numPrevBits+this._numPosBits;e--;)this._coders[e].init()},r.LiteralDecoder.prototype.getDecoder=function(e,t){return this._coders[((e&this._posMask)<<this._numPrevBits)+((255&t)>>>8-this._numPrevBits)]},r.Decoder=function(){this._outWindow=new r.OutWindow,this._rangeDecoder=new r.RangeDecoder,this._isMatchDecoders=[],this._isRepDecoders=[],this._isRepG0Decoders=[],this._isRepG1Decoders=[],this._isRepG2Decoders=[],this._isRep0LongDecoders=[],this._posSlotDecoder=[],this._posDecoders=[],this._posAlignDecoder=new r.BitTreeDecoder(4),this._lenDecoder=new r.LenDecoder,this._repLenDecoder=new r.LenDecoder,this._literalDecoder=new r.LiteralDecoder,this._dictionarySize=-1,this._dictionarySizeCheck=-1,this._posSlotDecoder[0]=new r.BitTreeDecoder(6),this._posSlotDecoder[1]=new r.BitTreeDecoder(6),this._posSlotDecoder[2]=new r.BitTreeDecoder(6),this._posSlotDecoder[3]=new r.BitTreeDecoder(6)},r.Decoder.prototype.setDictionarySize=function(e){return!(e<0)&&(this._dictionarySize!==e&&(this._dictionarySize=e,this._dictionarySizeCheck=Math.max(this._dictionarySize,1),this._outWindow.create(Math.max(this._dictionarySizeCheck,4096))),!0)},r.Decoder.prototype.setLcLpPb=function(e,t,i){var r=1<<i;return!(e>8||t>4||i>4)&&(this._literalDecoder.create(t,e),this._lenDecoder.create(r),this._repLenDecoder.create(r),this._posStateMask=r-1,!0)},r.Decoder.prototype.init=function(){var e=4;for(this._outWindow.init(!1),r.initBitModels(this._isMatchDecoders,192),r.initBitModels(this._isRep0LongDecoders,192),r.initBitModels(this._isRepDecoders,12),r.initBitModels(this._isRepG0Decoders,12),r.initBitModels(this._isRepG1Decoders,12),r.initBitModels(this._isRepG2Decoders,12),r.initBitModels(this._posDecoders,114),this._literalDecoder.init();e--;)this._posSlotDecoder[e].init();this._lenDecoder.init(),this._repLenDecoder.init(),this._posAlignDecoder.init(),this._rangeDecoder.init()},r.Decoder.prototype.decode=function(e,t,i){var s,n,o,a,h,l,d=0,c=0,u=0,p=0,f=0,m=0,g=0;for(this._rangeDecoder.setStream(e),this._outWindow.setStream(t),this.init();i<0||m<i;)if(s=m&this._posStateMask,0===this._rangeDecoder.decodeBit(this._isMatchDecoders,(d<<4)+s))n=this._literalDecoder.getDecoder(m++,g),g=d>=7?n.decodeWithMatchByte(this._rangeDecoder,this._outWindow.getByte(c)):n.decodeNormal(this._rangeDecoder),this._outWindow.putByte(g),d=d<4?0:d-(d<10?3:6);else{if(1===this._rangeDecoder.decodeBit(this._isRepDecoders,d))o=0,0===this._rangeDecoder.decodeBit(this._isRepG0Decoders,d)?0===this._rangeDecoder.decodeBit(this._isRep0LongDecoders,(d<<4)+s)&&(d=d<7?9:11,o=1):(0===this._rangeDecoder.decodeBit(this._isRepG1Decoders,d)?a=u:(0===this._rangeDecoder.decodeBit(this._isRepG2Decoders,d)?a=p:(a=f,f=p),p=u),u=c,c=a),0===o&&(o=2+this._repLenDecoder.decode(this._rangeDecoder,s),d=d<7?8:11);else if(f=p,p=u,u=c,o=2+this._lenDecoder.decode(this._rangeDecoder,s),d=d<7?7:10,(h=this._posSlotDecoder[o<=5?o-2:3].decode(this._rangeDecoder))>=4){if(c=(2|1&h)<<(l=(h>>1)-1),h<14)c+=r.reverseDecode2(this._posDecoders,c-h-1,this._rangeDecoder,l);else if(c+=this._rangeDecoder.decodeDirectBits(l-4)<<4,(c+=this._posAlignDecoder.reverseDecode(this._rangeDecoder))<0){if(-1===c)break;return!1}}else c=h;if(c>=m||c>=this._dictionarySizeCheck)return!1;this._outWindow.copyBlock(c,o),m+=o,g=this._outWindow.getByte(0)}return this._outWindow.flush(),this._outWindow.releaseStream(),this._rangeDecoder.releaseStream(),!0},r.Decoder.prototype.setDecoderProperties=function(e){var t,i,r,s,n;return!(e.size<5)&&(i=(t=e.readByte())%9,r=(t=~~(t/9))%5,s=~~(t/5),!!this.setLcLpPb(i,r,s)&&(n=e.readByte(),n|=e.readByte()<<8,n|=e.readByte()<<16,n+=16777216*e.readByte(),this.setDictionarySize(n)))},r.decompress=function(e,t,i,s){var n=new r.Decoder;if(!n.setDecoderProperties(e))throw"Incorrect stream properties";if(!n.decode(t,i,s))throw"Error in data stream";return!0}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(4),s=i(3),n=i(0),o=i(15),a=i(16);let h="\nvarying vec3 vNormal;\nvarying vec3 vViewDir;\n\n#ifdef USE_MAP\nvarying vec2 vUv;\n#endif\n\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n    vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n\n    vViewDir = cameraPosition - worldPosition.xyz;\n    vNormal = mat3(modelMatrix) * normal;\n\n#ifdef USE_MAP\n    vUv = uv;\n#endif\n}\n",l="\n#define saturate(a) clamp(a, 0.0, 1.0)\n\nvarying vec3 vNormal;\nvarying vec3 vViewDir;\n\n#ifdef USE_MAP\nuniform sampler2D map;\nvarying vec2 vUv;\n#endif\n\nuniform sampler2D beckmannMap;\n\nuniform vec3 diffuse;\nuniform vec3 specular;\nuniform vec3 ambient;\nuniform vec3 wrapRGB;\n\nuniform float opacity;\nuniform float roughness;\nuniform float brightness;\n\nstruct DirectionalLight {\n    vec3 color;\n    vec3 direction;\n};\n\nstruct ReflectedLight {\n    vec3 diffuse;\n    vec3 specular;\n};\n\n#if NUM_DIR_LIGHTS > 0\nuniform DirectionalLight directionalLights[NUM_DIR_LIGHTS];\n#endif\n\n#ifdef USE_BUMPMAP\nuniform sampler2D bumpMap;\nuniform float bumpScale;\n\n// Bump Mapping Unparametrized Surfaces on the GPU by Morten S. Mikkelsen\n// http://api.unrealengine.com/attachments/Engine/Rendering/LightingAndShadows/BumpMappingWithoutTangentSpace/mm_sfgrad_bump.pdf\n\n// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\nvec2 dHdxy_fwd() {\n    vec2 dSTdx = dFdx( vUv );\n    vec2 dSTdy = dFdy( vUv );\n\n    float Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n    float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n    float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n    \n    return vec2( dBx, dBy );\n}\n\nvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n    // Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\n\n    vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n    vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n    vec3 vN = surf_norm;\t\t// normalized\n\n    vec3 R1 = cross( vSigmaY, vN );\n    vec3 R2 = cross( vN, vSigmaX );\n\n    float fDet = dot( vSigmaX, R1 );\n\n    fDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n    vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n    return normalize( abs( fDet ) * surf_norm - vGrad );\n}\n#endif\n\nfloat fresnelReflectance(vec3 H, vec3 V, float F0) {\n    float base = 1.0 - dot(V, H);\n    float exponential = pow(base, 5.0);\n    return exponential + F0 * (1.0 - exponential);\n}\n\n// Kelemen/Szirmay-Kalos specular BRDF\nfloat KS_Skin_Specular(\n    vec3 N, \t\t// Bumped surface normal\n    vec3 L, \t\t// Points to light\n    vec3 V,\t\t    // Points to eye\n    float m, \t    // Roughness\n    float rho_s \t// Specular brightness\n) {\n    float result = 0.0;\n    float ndotl = dot(N, L);\n\n    if (ndotl > 0.0) {\n        vec3 h = L + V; // Unnormalized half-way vector\n        vec3 H = normalize(h);\n\n        float ndoth = dot(N, H);\n\n        float PH = pow(2.0 * texture2D(beckmannMap, vec2(ndoth, m)).x, 10.0);\n\n        float F = fresnelReflectance(H, V, 0.028);\n        float frSpec = max(PH * F / dot(h, h), 0.0);\n\n        result = ndotl * rho_s * frSpec; // BRDF * dot(N,L) * rho_s\n    }\n    return result;\n}\n\nvoid main() {\n    vec3 normal = normalize(vNormal);\n    vec3 viewDir = normalize(vViewDir);\n    ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0));\n    vec4 diffuseColor = vec4(diffuse, opacity);\n\n#ifdef USE_MAP\n    vec4 texelColor = texture2D(map, vUv);\n    diffuseColor.rgb *= texelColor.rgb * texelColor.rgb;\n#endif\n\n#ifdef USE_BUMPMAP\n    normal = perturbNormalArb(-vViewDir, normal, dHdxy_fwd());\n#endif \n\n#if NUM_DIR_LIGHTS > 0\n    DirectionalLight directionalLight;\n    #pragma unroll_loop\n    for (int i = 0; i < NUM_DIR_LIGHTS; i++) {\n        directionalLight = directionalLights[i];\n        vec3 irradiance = directionalLight.color;\n\n        float dotNL = saturate(dot(normal, directionalLight.direction));\n        vec3 weight = mix(vec3(dotNL), vec3(dotNL * 0.5 + 0.5), wrapRGB);\n\n        vec3 specularColor = specular * KS_Skin_Specular(normal, directionalLight.direction, viewDir, roughness, brightness);\n\n        reflectedLight.diffuse += irradiance * diffuseColor.rgb * weight;\n        reflectedLight.specular += irradiance * specularColor;\n    }\n#endif\n\n    vec3 ambientColor = ambient * diffuseColor.rgb;\n    vec3 outgoingLight = reflectedLight.diffuse + reflectedLight.specular + ambientColor;\n    gl_FragColor = vec4(outgoingLight, diffuseColor.a);\n}\n",d="\nvarying vec2 vUv;\n\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    vUv = uv;\n}\n",c="\nvarying vec2 vUv;\n\nfloat PHBeckmann(float ndoth, float m) {\n    float alpha = acos(ndoth);\n    float ta = tan(alpha);\n\n    float val = 1.0 / (m * m * pow(ndoth, 4.0)) * exp(-(ta * ta) / (m * m));\n    return val;\n}\n\nfloat KSTextureCompute(vec2 tex) {\n    // Scale the value to fit within [0,1]  invert upon lookup.\n    return 0.5 * pow(PHBeckmann(tex.x, tex.y), 0.1);\n}\n\nvoid main() {\n    float x = KSTextureCompute(vUv);\n    gl_FragColor = vec4(x, x, x, 1.0);\n}\n";t.SkinMaterial=class extends r.Material{constructor(e){super({vertexShader:h,fragmentShader:l}),this.bumpScale=1,this.diffuse=new s.Color(15658734),this.specular=new s.Color(1118481),this.opacity=1,this.roughness=.15,this.brightness=.75,this.wrapRGB=new n.Vec3(.75,.375,.1875);let t=new a.RenderTarget({width:512});this.name=e.name,this.setTexture2D("map",e.url),this.setTexture2D("bumpMap",e.bumpUrl),this.beckmannMap=t.texture,this.bumpScale=void 0!==e.bumpScale?e.bumpScale:this.bumpScale,this.extensions.derivatives=!0,this.addPass(new o.Pass({vertexShader:d,fragmentShader:c,renderTarget:t,afterRender:e=>e.enabled=!1}))}}}])}));